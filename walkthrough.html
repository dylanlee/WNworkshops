<!DOCTYPE html>
<html lang="en"><head>
<script src="walkthrough_files/libs/clipboard/clipboard.min.js"></script>
<script src="walkthrough_files/libs/quarto-html/tabby.min.js"></script>
<script src="walkthrough_files/libs/quarto-html/popper.min.js"></script>
<script src="walkthrough_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="walkthrough_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="walkthrough_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="walkthrough_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="walkthrough_files/libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.3.340">

  <title>An introduction to Google Earth Engine</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="walkthrough_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="walkthrough_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #f8f8f2;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #f8f8f2; } /* Normal */
    code span.al { color: #f07178; background-color: #2a0f15; font-weight: bold; } /* Alert */
    code span.an { color: #d4d0ab; } /* Annotation */
    code span.at { color: #00e0e0; } /* Attribute */
    code span.bn { color: #d4d0ab; } /* BaseN */
    code span.bu { color: #abe338; } /* BuiltIn */
    code span.cf { color: #ffa07a; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #abe338; } /* Char */
    code span.cn { color: #ffd700; } /* Constant */
    code span.co { color: #f8f8f2; font-style: italic; } /* Comment */
    code span.cv { color: #ffd700; } /* CommentVar */
    code span.do { color: #f8f8f2; } /* Documentation */
    code span.dt { color: #ffa07a; } /* DataType */
    code span.dv { color: #d4d0ab; } /* DecVal */
    code span.er { color: #f07178; text-decoration: underline; } /* Error */
    code span.ex { color: #00e0e0; font-weight: bold; } /* Extension */
    code span.fl { color: #d4d0ab; } /* Float */
    code span.fu { color: #ffa07a; } /* Function */
    code span.im { color: #abe338; } /* Import */
    code span.in { color: #d4d0ab; } /* Information */
    code span.kw { color: #ffa07a; font-weight: bold; } /* Keyword */
    code span.op { color: #ffa07a; } /* Operator */
    code span.ot { color: #00e0e0; } /* Other */
    code span.pp { color: #dcc6e0; } /* Preprocessor */
    code span.re { color: #00e0e0; background-color: #f8f8f2; } /* RegionMarker */
    code span.sc { color: #abe338; } /* SpecialChar */
    code span.ss { color: #abe338; } /* SpecialString */
    code span.st { color: #abe338; } /* String */
    code span.va { color: #00e0e0; } /* Variable */
    code span.vs { color: #abe338; } /* VerbatimString */
    code span.wa { color: #dcc6e0; } /* Warning */
  </style>
  <link rel="stylesheet" href="walkthrough_files/libs/revealjs/dist/theme/quarto.css" id="theme">
  <link rel="stylesheet" href="walkthrough.css">
  <link href="walkthrough_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="walkthrough_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="walkthrough_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="walkthrough_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    margin-bottom: 0.5rem;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-dark">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-image="./Images/_MODIS_Pic.jpg" data-background-opacity="0.5" data-background-size="cover" class="quarto-title-block center">
  <h1 class="title">An introduction to Google Earth Engine</h1>

<div class="quarto-title-authors">
</div>

</section>
<section id="what-is-google-earth-engine" class="slide level2">
<h2>What is Google Earth Engine?</h2>

<img data-src="./Images/EarthEngineSplashPage.png" class="r-stretch"><aside class="notes">
<p>Google Earth Engine is a platform for geospatial analysis. It provides access to satellite imagery and other remote sensing data. Earth Engine simplifies the task of processing geospatial data.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="earth-engine-code-editor" class="slide level2">
<h2>Earth Engine Code Editor</h2>

<img data-src="./Images/EarthEngineEditor.png" class="r-stretch"><aside class="notes">
<p>The Earth Engine Code Editor is a web-based IDE for accessing the Earth Engine datasets and analysis library using javascript. We’re going to do a quick walkthrough of the editor and some of its capabilities.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="inserting-data-using-the-search-bar" class="slide level2">
<h2>Inserting data using the search bar</h2>

<img data-src="./Videos/SearchBar.gif" class="r-stretch quarto-figure-center"><aside class="notes">
<p>The search bar in Earth Engine Editor allows you to easily find and <em>import</em> datasets and satellite imagery for analysis. Here we’re importing landsat 8 reflectance data.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="browsing-library-reference" class="slide level2">
<h2>Browsing library reference</h2>

<img data-src="./Videos/docquery.gif" class="r-stretch quarto-figure-center"></section>
<section id="the-scripts-pane" class="slide level2">
<h2>The scripts pane</h2>

<img data-src="./Videos/openscript.gif" class="r-stretch quarto-figure-center"><aside class="notes">
<p>The scripts tab allows you to access your scripts.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="the-assets-pane" class="slide level2">
<h2>The assets pane</h2>

<img data-src="./Videos/ImportingAssets.gif" class="r-stretch quarto-figure-center"><aside class="notes">
<p>This tab allows you to upload your own geospatial data into the editor. Here we will upload a shape file from the US flood inundation map repostiory. verbally walk through: - uploading assets. Mention the task pane as place where uploading and downloading takes place - opening script to display vector fill map - importing assets. Show that asset shows up in script - run script then going to map to view asset</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="the-inspector" class="slide level2">
<h2>The inspector</h2>

<img data-src="./Videos/inspector.gif" class="r-stretch quarto-figure-center"><aside class="notes">
<p>The inspector allows you to examine the assets being used or produced by a script. - go over how the vertices of each of the polygons in the flood fill map can be accessed in the - go over examining the metadata fields of the flood</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="the-console" class="slide level2">
<h2>The console</h2>

<img data-src="./Videos/console.gif" class="r-stretch quarto-figure-center"><aside class="notes">
<p>The console is where you can send messages to from your program. The console is also where error messages appear.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="the-map-pane" class="slide level2">
<h2>The map pane</h2>

<img data-src="./Videos/MapPane.gif" class="r-stretch quarto-figure-center"><aside class="notes">
<ul>
<li>In the map pane you can draw points, lines, or polygons and have those geometries show up in your script.</li>
<li>The map pane also has the ability to add and remove layers.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="finding-locations-likely-to-be-inland-ports-using-earth-engine" class="slide level2">
<h2>Finding locations likely to be inland ports using Earth Engine</h2>
<p><img data-src="./Images/PortPic.png" style="width:70.0%"></p>
<p><img data-src="./Images/PortMap.png" style="width:70.0%"></p>
<aside class="notes">
<ul>
<li>The US has 12 major inland ports and over 100 smaller inland ports. Can we use Earth Engine to create a method that locates places likely to have a major port?</li>
<li>Let’s assume that ports will:
<ol type="1">
<li>Be located at the nexus of major rivers and highways. This seems like a fair assumption since you have to get the containers into and out the ship.</li>
<li>Be located in reasonably big cities.</li>
</ol></li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="viewing-highways" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Viewing highways</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource javascript number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><span id="cb1-1" class="hljs-ln-code"><a href="#cb1-1"></a><span class="co">// Load road data from US census bureau </span></span>
<span id="cb1-2" class="hljs-ln-code"><a href="#cb1-2"></a><span class="kw">var</span> roads <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"TIGER/2016/Roads"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<aside class="notes">
<p>This line loads the US census bereau’s 2016 TIGER dataset. This dataset is a collection of Features. Or a “FeatureCollection”. In google earth engine a feature is a data structure that represents a geographic object and properties associated with that object. FeatureCollections usually store vector data. Each object in a FeatureCollection typically contains geometry (point, line, polygon) and attributes associated with that geometry. In this case a road could be represented by a line and an attributes could be the road type and road name.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="viewing-highways-1" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Viewing highways</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource javascript number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><span id="cb2-1" class="hljs-ln-code"><a href="#cb2-1"></a><span class="co">// Load road data from US census bureau </span></span>
<span id="cb2-2" class="hljs-ln-code"><a href="#cb2-2"></a><span class="kw">var</span> roads <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"TIGER/2016/Roads"</span>)<span class="op">;</span></span>
<span id="cb2-3" class="hljs-ln-code"><a href="#cb2-3"></a></span>
<span id="cb2-4" class="hljs-ln-code"><a href="#cb2-4"></a><span class="co">// Select just interstates using the MTFCC code</span></span>
<span id="cb2-5" class="hljs-ln-code"><a href="#cb2-5"></a><span class="kw">var</span> interstates <span class="op">=</span> roads<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'mtfcc'</span><span class="op">,</span> <span class="st">'S1100'</span>))<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<aside class="notes">
<p>This next line filters the “roads” FeatureCollection by the ‘mtfcc’ property. Each road has a string associated with ‘mtfcc’ that tells us if it is a highway, interstate, local road etc. By using the string ‘S1100’ we can select just the interstates from the roads data. This allows us to create an “interstates” feature collection.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="viewing-highways-2" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Viewing highways</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource javascript number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><span id="cb3-1" class="hljs-ln-code"><a href="#cb3-1"></a><span class="co">// Load road data from US census bureau </span></span>
<span id="cb3-2" class="hljs-ln-code"><a href="#cb3-2"></a><span class="kw">var</span> roads <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"TIGER/2016/Roads"</span>)<span class="op">;</span></span>
<span id="cb3-3" class="hljs-ln-code"><a href="#cb3-3"></a></span>
<span id="cb3-4" class="hljs-ln-code"><a href="#cb3-4"></a><span class="co">// Select just interstates using the MTFCC code</span></span>
<span id="cb3-5" class="hljs-ln-code"><a href="#cb3-5"></a><span class="kw">var</span> interstates <span class="op">=</span> roads<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'mtfcc'</span><span class="op">,</span> <span class="st">'S1100'</span>))<span class="op">;</span></span>
<span id="cb3-6" class="hljs-ln-code"><a href="#cb3-6"></a></span>
<span id="cb3-7" class="hljs-ln-code"><a href="#cb3-7"></a><span class="co">// Center the map on the continental USA</span></span>
<span id="cb3-8" class="hljs-ln-code"><a href="#cb3-8"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">setCenter</span>(<span class="op">-</span><span class="fl">98.5833</span><span class="op">,</span> <span class="fl">39.8333</span><span class="op">,</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb3-9" class="hljs-ln-code"><a href="#cb3-9"></a></span>
<span id="cb3-10" class="hljs-ln-code"><a href="#cb3-10"></a><span class="co">// Display the filtered FeatureCollection</span></span>
<span id="cb3-11" class="hljs-ln-code"><a href="#cb3-11"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(interstates<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">'green'</span>}<span class="op">,</span> <span class="st">'Interstates'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="{notes}">
<p>These next two lines display the geometries in the “interstates” FeatureCollection that we have created. First we center the map pane on the US. Then we use the Map.addLayer method to plot all the geometries in “interstates” on the map as a layer called “Interstates”. We also choose to color the interstates data green.</p>
</div>
</section>
<section id="adding-streams" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Adding streams</h2>
<div class="sourceCode" id="cb4" data-code-line-numbers="4-6"><pre class="sourceCode numberSource javascript number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><span id="cb4-1" class="hljs-ln-code"><a href="#cb4-1"></a><span class="co">// Load road data from US census bureau </span></span>
<span id="cb4-2" class="hljs-ln-code"><a href="#cb4-2"></a><span class="kw">var</span> roads <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"TIGER/2016/Roads"</span>)<span class="op">;</span></span>
<span id="cb4-3" class="hljs-ln-code"><a href="#cb4-3"></a></span>
<span id="cb4-4" class="hljs-ln-code"><a href="#cb4-4"></a><span class="co">// Load the WWF HydroSHEDS Free Flowing Rivers Network v1 dataset</span></span>
<span id="cb4-5" class="hljs-ln-code"><a href="#cb4-5"></a><span class="kw">var</span> hydrosheds <span class="op">=</span> </span>
<span id="cb4-6" class="hljs-ln-code"><a href="#cb4-6"></a>ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"WWF/HydroSHEDS/v1/FreeFlowingRivers"</span>)<span class="op">;</span></span>
<span id="cb4-7" class="hljs-ln-code"><a href="#cb4-7"></a></span>
<span id="cb4-8" class="hljs-ln-code"><a href="#cb4-8"></a><span class="co">// Select just interstates using the MTFCC code</span></span>
<span id="cb4-9" class="hljs-ln-code"><a href="#cb4-9"></a><span class="kw">var</span> interstates <span class="op">=</span> roads<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'mtfcc'</span><span class="op">,</span> <span class="st">'S1100'</span>))<span class="op">;</span></span>
<span id="cb4-10" class="hljs-ln-code"><a href="#cb4-10"></a></span>
<span id="cb4-11" class="hljs-ln-code"><a href="#cb4-11"></a><span class="co">// Center the map on the continental USA</span></span>
<span id="cb4-12" class="hljs-ln-code"><a href="#cb4-12"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">setCenter</span>(<span class="op">-</span><span class="fl">98.5833</span><span class="op">,</span> <span class="fl">39.8333</span><span class="op">,</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb4-13" class="hljs-ln-code"><a href="#cb4-13"></a></span>
<span id="cb4-14" class="hljs-ln-code"><a href="#cb4-14"></a><span class="co">// Display the filtered FeatureCollection</span></span>
<span id="cb4-15" class="hljs-ln-code"><a href="#cb4-15"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(interstates<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">'green'</span>}<span class="op">,</span> <span class="st">'Interstates'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="{notes}">
<p>To incorporate stream data we need to add another FeatureCollection that has the flow-lines of the nations streams. We’re going to use the hydrosheds database because it is the dataset of river reaches that is included in the Earth Engine Catalog.</p>
</div>
</section>
<section id="adding-streams-1" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Adding streams</h2>
<div class="sourceCode" id="cb5" data-code-line-numbers="4-6,11-14"><pre class="sourceCode numberSource javascript number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><span id="cb5-1" class="hljs-ln-code"><a href="#cb5-1"></a><span class="co">// Load road data from US census bureau </span></span>
<span id="cb5-2" class="hljs-ln-code"><a href="#cb5-2"></a><span class="kw">var</span> roads <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"TIGER/2016/Roads"</span>)<span class="op">;</span></span>
<span id="cb5-3" class="hljs-ln-code"><a href="#cb5-3"></a></span>
<span id="cb5-4" class="hljs-ln-code"><a href="#cb5-4"></a><span class="co">// Load the WWF HydroSHEDS Free Flowing Rivers Network v1 dataset</span></span>
<span id="cb5-5" class="hljs-ln-code"><a href="#cb5-5"></a><span class="kw">var</span> hydrosheds <span class="op">=</span></span>
<span id="cb5-6" class="hljs-ln-code"><a href="#cb5-6"></a>ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"WWF/HydroSHEDS/v1/FreeFlowingRivers"</span>)<span class="op">;</span></span>
<span id="cb5-7" class="hljs-ln-code"><a href="#cb5-7"></a></span>
<span id="cb5-8" class="hljs-ln-code"><a href="#cb5-8"></a><span class="co">// Select just interstates using the MTFCC code</span></span>
<span id="cb5-9" class="hljs-ln-code"><a href="#cb5-9"></a><span class="kw">var</span> interstates <span class="op">=</span> roads<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'mtfcc'</span><span class="op">,</span> <span class="st">'S1100'</span>))<span class="op">;</span></span>
<span id="cb5-10" class="hljs-ln-code"><a href="#cb5-10"></a></span>
<span id="cb5-11" class="hljs-ln-code"><a href="#cb5-11"></a><span class="co">// Filter out streams with an order less than 4</span></span>
<span id="cb5-12" class="hljs-ln-code"><a href="#cb5-12"></a><span class="kw">var</span> filteredStreams <span class="op">=</span> </span>
<span id="cb5-13" class="hljs-ln-code"><a href="#cb5-13"></a>      hydrosheds<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lte</span>(<span class="st">'RIV_ORD'</span><span class="op">,</span> <span class="dv">4</span>))</span>
<span id="cb5-14" class="hljs-ln-code"><a href="#cb5-14"></a>                <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'COUNTRY'</span><span class="op">,</span><span class="st">'United States'</span>))<span class="op">;</span></span>
<span id="cb5-15" class="hljs-ln-code"><a href="#cb5-15"></a></span>
<span id="cb5-16" class="hljs-ln-code"><a href="#cb5-16"></a><span class="co">// Center the map on the continental USA</span></span>
<span id="cb5-17" class="hljs-ln-code"><a href="#cb5-17"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">setCenter</span>(<span class="op">-</span><span class="fl">98.5833</span><span class="op">,</span> <span class="fl">39.8333</span><span class="op">,</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb5-18" class="hljs-ln-code"><a href="#cb5-18"></a></span>
<span id="cb5-19" class="hljs-ln-code"><a href="#cb5-19"></a><span class="co">// Display the filtered FeatureCollection</span></span>
<span id="cb5-20" class="hljs-ln-code"><a href="#cb5-20"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(interstates<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">'green'</span>}<span class="op">,</span> <span class="st">'Interstates'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="{notes}">
<p>The HydroSHEDS dataset includes many small streams and is a global dataset. We can create a new FeatureCollection that is just the large streams in the United States. To do this we apply two filters to the dataset. One “ee.Filter.eq” searches through the ‘COUNTRY’ property of the feature collection and removes features where ‘COUNTRY’ isn’t equal to “United States”. The other filter “EE.Filter.lte” searches through the “RIV_ORD” property of all the features and only keeps features with a river order less than or equal to 4. Here river order is assocated with the average discharge flowing through the streams with larger river order numbers equating to more discharge.</p>
</div>
</section>
<section id="adding-streams-2" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Adding streams</h2>
<div class="sourceCode" id="cb6" data-code-line-numbers="22-29"><pre class="sourceCode numberSource javascript number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><span id="cb6-1" class="hljs-ln-code"><a href="#cb6-1"></a><span class="co">// Load road data from US census bureau </span></span>
<span id="cb6-2" class="hljs-ln-code"><a href="#cb6-2"></a><span class="kw">var</span> roads <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"TIGER/2016/Roads"</span>)<span class="op">;</span></span>
<span id="cb6-3" class="hljs-ln-code"><a href="#cb6-3"></a></span>
<span id="cb6-4" class="hljs-ln-code"><a href="#cb6-4"></a><span class="co">// Load the WWF HydroSHEDS Free Flowing Rivers Network v1 dataset</span></span>
<span id="cb6-5" class="hljs-ln-code"><a href="#cb6-5"></a><span class="kw">var</span> hydrosheds <span class="op">=</span></span>
<span id="cb6-6" class="hljs-ln-code"><a href="#cb6-6"></a>ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"WWF/HydroSHEDS/v1/FreeFlowingRivers"</span>)<span class="op">;</span></span>
<span id="cb6-7" class="hljs-ln-code"><a href="#cb6-7"></a></span>
<span id="cb6-8" class="hljs-ln-code"><a href="#cb6-8"></a><span class="co">// Select just interstates using the MTFCC code</span></span>
<span id="cb6-9" class="hljs-ln-code"><a href="#cb6-9"></a><span class="kw">var</span> interstates <span class="op">=</span> roads<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'mtfcc'</span><span class="op">,</span> <span class="st">'S1100'</span>))<span class="op">;</span></span>
<span id="cb6-10" class="hljs-ln-code"><a href="#cb6-10"></a></span>
<span id="cb6-11" class="hljs-ln-code"><a href="#cb6-11"></a><span class="co">// Filter out streams with an order less than 4</span></span>
<span id="cb6-12" class="hljs-ln-code"><a href="#cb6-12"></a><span class="kw">var</span> filteredStreams <span class="op">=</span> </span>
<span id="cb6-13" class="hljs-ln-code"><a href="#cb6-13"></a>      hydrosheds<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lte</span>(<span class="st">'RIV_ORD'</span><span class="op">,</span> <span class="dv">4</span>))</span>
<span id="cb6-14" class="hljs-ln-code"><a href="#cb6-14"></a>                <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'COUNTRY'</span><span class="op">,</span><span class="st">'United States'</span>))<span class="op">;</span></span>
<span id="cb6-15" class="hljs-ln-code"><a href="#cb6-15"></a></span>
<span id="cb6-16" class="hljs-ln-code"><a href="#cb6-16"></a><span class="co">// Center the map on the continental USA</span></span>
<span id="cb6-17" class="hljs-ln-code"><a href="#cb6-17"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">setCenter</span>(<span class="op">-</span><span class="fl">98.5833</span><span class="op">,</span> <span class="fl">39.8333</span><span class="op">,</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb6-18" class="hljs-ln-code"><a href="#cb6-18"></a></span>
<span id="cb6-19" class="hljs-ln-code"><a href="#cb6-19"></a><span class="co">// Display the filtered FeatureCollection</span></span>
<span id="cb6-20" class="hljs-ln-code"><a href="#cb6-20"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(interstates<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">'green'</span>}<span class="op">,</span> <span class="st">'Interstates'</span>)<span class="op">;</span></span>
<span id="cb6-21" class="hljs-ln-code"><a href="#cb6-21"></a></span>
<span id="cb6-22" class="hljs-ln-code"><a href="#cb6-22"></a><span class="co">// Set visualization parameters</span></span>
<span id="cb6-23" class="hljs-ln-code"><a href="#cb6-23"></a><span class="kw">var</span> streamsVis <span class="op">=</span> {</span>
<span id="cb6-24" class="hljs-ln-code"><a href="#cb6-24"></a>  <span class="dt">color</span><span class="op">:</span> <span class="st">'blue'</span><span class="op">,</span></span>
<span id="cb6-25" class="hljs-ln-code"><a href="#cb6-25"></a>  <span class="dt">width</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb6-26" class="hljs-ln-code"><a href="#cb6-26"></a>}<span class="op">;</span></span>
<span id="cb6-27" class="hljs-ln-code"><a href="#cb6-27"></a></span>
<span id="cb6-28" class="hljs-ln-code"><a href="#cb6-28"></a><span class="co">// Add the filtered streams to the map</span></span>
<span id="cb6-29" class="hljs-ln-code"><a href="#cb6-29"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(filteredStreams<span class="op">,</span> streamsVis<span class="op">,</span> <span class="st">'Filtered Streams'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="{notes}">
<p>Now that we’ve filtered out all the small streams lets visualize what’s left. To do that we first create an object called “streamsVis”. This allows us to assign all the visualization parameters that we will use to a single object so that we don’t have to list them all in the second argument of the “Map.addLayer” method. This time instead of setting just the color of the geometries in the layer we also set the line width that the geometries will be displayed with.</p>
</div>
</section>
<section id="finding-intersection-points" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Finding intersection points</h2>
<div class="sourceCode" id="cb7" data-code-line-numbers="16-27"><pre class="sourceCode numberSource javascript number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><span id="cb7-1" class="hljs-ln-code"><a href="#cb7-1"></a><span class="co">// Load road data from US census bureau </span></span>
<span id="cb7-2" class="hljs-ln-code"><a href="#cb7-2"></a><span class="kw">var</span> roads <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"TIGER/2016/Roads"</span>)<span class="op">;</span></span>
<span id="cb7-3" class="hljs-ln-code"><a href="#cb7-3"></a></span>
<span id="cb7-4" class="hljs-ln-code"><a href="#cb7-4"></a><span class="co">// Load the WWF HydroSHEDS Free Flowing Rivers Network v1 dataset</span></span>
<span id="cb7-5" class="hljs-ln-code"><a href="#cb7-5"></a><span class="kw">var</span> hydrosheds <span class="op">=</span></span>
<span id="cb7-6" class="hljs-ln-code"><a href="#cb7-6"></a>ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"WWF/HydroSHEDS/v1/FreeFlowingRivers"</span>)<span class="op">;</span></span>
<span id="cb7-7" class="hljs-ln-code"><a href="#cb7-7"></a></span>
<span id="cb7-8" class="hljs-ln-code"><a href="#cb7-8"></a><span class="co">// Select just interstates using the MTFCC code</span></span>
<span id="cb7-9" class="hljs-ln-code"><a href="#cb7-9"></a><span class="kw">var</span> interstates <span class="op">=</span> roads<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'mtfcc'</span><span class="op">,</span> <span class="st">'S1100'</span>))<span class="op">;</span></span>
<span id="cb7-10" class="hljs-ln-code"><a href="#cb7-10"></a></span>
<span id="cb7-11" class="hljs-ln-code"><a href="#cb7-11"></a><span class="co">// Filter out streams with an order less than 4</span></span>
<span id="cb7-12" class="hljs-ln-code"><a href="#cb7-12"></a><span class="kw">var</span> filteredStreams <span class="op">=</span> </span>
<span id="cb7-13" class="hljs-ln-code"><a href="#cb7-13"></a>      hydrosheds<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lte</span>(<span class="st">'RIV_ORD'</span><span class="op">,</span> <span class="dv">4</span>))</span>
<span id="cb7-14" class="hljs-ln-code"><a href="#cb7-14"></a>                <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'COUNTRY'</span><span class="op">,</span><span class="st">'United States'</span>))<span class="op">;</span></span>
<span id="cb7-15" class="hljs-ln-code"><a href="#cb7-15"></a></span>
<span id="cb7-16" class="hljs-ln-code"><a href="#cb7-16"></a><span class="co">// Perform a spatial join between filteredStreams</span></span>
<span id="cb7-17" class="hljs-ln-code"><a href="#cb7-17"></a><span class="co">// and interstates FeatureCollections</span></span>
<span id="cb7-18" class="hljs-ln-code"><a href="#cb7-18"></a><span class="kw">var</span> join <span class="op">=</span> ee<span class="op">.</span><span class="at">Join</span><span class="op">.</span><span class="fu">simple</span>()<span class="op">;</span></span>
<span id="cb7-19" class="hljs-ln-code"><a href="#cb7-19"></a><span class="kw">var</span> filter <span class="op">=</span> ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">intersects</span>({</span>
<span id="cb7-20" class="hljs-ln-code"><a href="#cb7-20"></a>  <span class="dt">leftField</span><span class="op">:</span> <span class="st">'.geo'</span><span class="op">,</span></span>
<span id="cb7-21" class="hljs-ln-code"><a href="#cb7-21"></a>  <span class="dt">rightField</span><span class="op">:</span> <span class="st">'.geo'</span></span>
<span id="cb7-22" class="hljs-ln-code"><a href="#cb7-22"></a>})<span class="op">;</span></span>
<span id="cb7-23" class="hljs-ln-code"><a href="#cb7-23"></a></span>
<span id="cb7-24" class="hljs-ln-code"><a href="#cb7-24"></a><span class="kw">var</span> intersectionLines <span class="op">=</span> join<span class="op">.</span><span class="fu">apply</span>(</span>
<span id="cb7-25" class="hljs-ln-code"><a href="#cb7-25"></a>                              filteredStreams<span class="op">,</span> </span>
<span id="cb7-26" class="hljs-ln-code"><a href="#cb7-26"></a>                              interstates<span class="op">,</span></span>
<span id="cb7-27" class="hljs-ln-code"><a href="#cb7-27"></a>                              filter)<span class="op">;</span></span>
<span id="cb7-28" class="hljs-ln-code"><a href="#cb7-28"></a></span>
<span id="cb7-29" class="hljs-ln-code"><a href="#cb7-29"></a><span class="co">// Center the map on the continental USA</span></span>
<span id="cb7-30" class="hljs-ln-code"><a href="#cb7-30"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">setCenter</span>(<span class="op">-</span><span class="fl">98.5833</span><span class="op">,</span> <span class="fl">39.8333</span><span class="op">,</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb7-31" class="hljs-ln-code"><a href="#cb7-31"></a></span>
<span id="cb7-32" class="hljs-ln-code"><a href="#cb7-32"></a><span class="co">// Display the filtered FeatureCollection</span></span>
<span id="cb7-33" class="hljs-ln-code"><a href="#cb7-33"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(interstates<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">'green'</span>}<span class="op">,</span> <span class="st">'Interstates'</span>)<span class="op">;</span></span>
<span id="cb7-34" class="hljs-ln-code"><a href="#cb7-34"></a></span>
<span id="cb7-35" class="hljs-ln-code"><a href="#cb7-35"></a><span class="co">// Set visualization parameters</span></span>
<span id="cb7-36" class="hljs-ln-code"><a href="#cb7-36"></a><span class="kw">var</span> streamsVis <span class="op">=</span> {</span>
<span id="cb7-37" class="hljs-ln-code"><a href="#cb7-37"></a>  <span class="dt">color</span><span class="op">:</span> <span class="st">'blue'</span><span class="op">,</span></span>
<span id="cb7-38" class="hljs-ln-code"><a href="#cb7-38"></a>  <span class="dt">width</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb7-39" class="hljs-ln-code"><a href="#cb7-39"></a>}<span class="op">;</span></span>
<span id="cb7-40" class="hljs-ln-code"><a href="#cb7-40"></a></span>
<span id="cb7-41" class="hljs-ln-code"><a href="#cb7-41"></a><span class="co">// Add the filtered streams to the map</span></span>
<span id="cb7-42" class="hljs-ln-code"><a href="#cb7-42"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(filteredStreams<span class="op">,</span> streamsVis<span class="op">,</span> <span class="st">'Filtered Streams'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="{notes}">

</div>
</section>
<section id="finding-intersection-points-1" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Finding intersection points</h2>
<div class="sourceCode" id="cb8" data-code-line-numbers="29-41"><pre class="sourceCode numberSource javascript number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><span id="cb8-1" class="hljs-ln-code"><a href="#cb8-1"></a><span class="co">// Load road data from US census bureau </span></span>
<span id="cb8-2" class="hljs-ln-code"><a href="#cb8-2"></a><span class="kw">var</span> roads <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"TIGER/2016/Roads"</span>)<span class="op">;</span></span>
<span id="cb8-3" class="hljs-ln-code"><a href="#cb8-3"></a></span>
<span id="cb8-4" class="hljs-ln-code"><a href="#cb8-4"></a><span class="co">// Load the WWF HydroSHEDS Free Flowing Rivers Network v1 dataset</span></span>
<span id="cb8-5" class="hljs-ln-code"><a href="#cb8-5"></a><span class="kw">var</span> hydrosheds <span class="op">=</span></span>
<span id="cb8-6" class="hljs-ln-code"><a href="#cb8-6"></a>ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"WWF/HydroSHEDS/v1/FreeFlowingRivers"</span>)<span class="op">;</span></span>
<span id="cb8-7" class="hljs-ln-code"><a href="#cb8-7"></a></span>
<span id="cb8-8" class="hljs-ln-code"><a href="#cb8-8"></a><span class="co">// Select just interstates using the MTFCC code</span></span>
<span id="cb8-9" class="hljs-ln-code"><a href="#cb8-9"></a><span class="kw">var</span> interstates <span class="op">=</span> roads<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'mtfcc'</span><span class="op">,</span> <span class="st">'S1100'</span>))<span class="op">;</span></span>
<span id="cb8-10" class="hljs-ln-code"><a href="#cb8-10"></a></span>
<span id="cb8-11" class="hljs-ln-code"><a href="#cb8-11"></a><span class="co">// Filter out streams with an order less than 4</span></span>
<span id="cb8-12" class="hljs-ln-code"><a href="#cb8-12"></a><span class="kw">var</span> filteredStreams <span class="op">=</span> </span>
<span id="cb8-13" class="hljs-ln-code"><a href="#cb8-13"></a>      hydrosheds<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lte</span>(<span class="st">'RIV_ORD'</span><span class="op">,</span> <span class="dv">4</span>))</span>
<span id="cb8-14" class="hljs-ln-code"><a href="#cb8-14"></a>                <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'COUNTRY'</span><span class="op">,</span><span class="st">'United States'</span>))<span class="op">;</span></span>
<span id="cb8-15" class="hljs-ln-code"><a href="#cb8-15"></a></span>
<span id="cb8-16" class="hljs-ln-code"><a href="#cb8-16"></a><span class="co">// Perform a spatial join between filteredStreams</span></span>
<span id="cb8-17" class="hljs-ln-code"><a href="#cb8-17"></a><span class="co">// and interstates FeatureCollections</span></span>
<span id="cb8-18" class="hljs-ln-code"><a href="#cb8-18"></a><span class="kw">var</span> join <span class="op">=</span> ee<span class="op">.</span><span class="at">Join</span><span class="op">.</span><span class="fu">simple</span>()<span class="op">;</span></span>
<span id="cb8-19" class="hljs-ln-code"><a href="#cb8-19"></a><span class="kw">var</span> filter <span class="op">=</span> ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">intersects</span>({</span>
<span id="cb8-20" class="hljs-ln-code"><a href="#cb8-20"></a>  <span class="dt">leftField</span><span class="op">:</span> <span class="st">'.geo'</span><span class="op">,</span></span>
<span id="cb8-21" class="hljs-ln-code"><a href="#cb8-21"></a>  <span class="dt">rightField</span><span class="op">:</span> <span class="st">'.geo'</span></span>
<span id="cb8-22" class="hljs-ln-code"><a href="#cb8-22"></a>})<span class="op">;</span></span>
<span id="cb8-23" class="hljs-ln-code"><a href="#cb8-23"></a></span>
<span id="cb8-24" class="hljs-ln-code"><a href="#cb8-24"></a><span class="kw">var</span> intersectionLines <span class="op">=</span> join<span class="op">.</span><span class="fu">apply</span>(</span>
<span id="cb8-25" class="hljs-ln-code"><a href="#cb8-25"></a>                              filteredStreams<span class="op">,</span> </span>
<span id="cb8-26" class="hljs-ln-code"><a href="#cb8-26"></a>                              interstates<span class="op">,</span></span>
<span id="cb8-27" class="hljs-ln-code"><a href="#cb8-27"></a>                              filter)<span class="op">;</span></span>
<span id="cb8-28" class="hljs-ln-code"><a href="#cb8-28"></a></span>
<span id="cb8-29" class="hljs-ln-code"><a href="#cb8-29"></a><span class="co">// Sort by a random number and select the first N features</span></span>
<span id="cb8-30" class="hljs-ln-code"><a href="#cb8-30"></a><span class="kw">var</span> selectedLines <span class="op">=</span> intersectionLines<span class="op">.</span><span class="fu">sort</span>(<span class="st">'random'</span>)<span class="op">.</span><span class="fu">limit</span>(<span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb8-31" class="hljs-ln-code"><a href="#cb8-31"></a></span>
<span id="cb8-32" class="hljs-ln-code"><a href="#cb8-32"></a><span class="co">// Function to convert line geometry to a point </span></span>
<span id="cb8-33" class="hljs-ln-code"><a href="#cb8-33"></a><span class="kw">var</span> lineToPoint <span class="op">=</span> <span class="kw">function</span>(feature) {</span>
<span id="cb8-34" class="hljs-ln-code"><a href="#cb8-34"></a>  <span class="co">// Get the geometry</span></span>
<span id="cb8-35" class="hljs-ln-code"><a href="#cb8-35"></a>  <span class="kw">var</span> geom <span class="op">=</span> feature<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb8-36" class="hljs-ln-code"><a href="#cb8-36"></a>  <span class="co">// Get the centroid of the geometry</span></span>
<span id="cb8-37" class="hljs-ln-code"><a href="#cb8-37"></a>  <span class="kw">var</span> centroid <span class="op">=</span> geom<span class="op">.</span><span class="fu">centroid</span>()<span class="op">;</span></span>
<span id="cb8-38" class="hljs-ln-code"><a href="#cb8-38"></a>  <span class="co">// Create a new point feature</span></span>
<span id="cb8-39" class="hljs-ln-code"><a href="#cb8-39"></a>  <span class="kw">var</span> pointFeature <span class="op">=</span> ee<span class="op">.</span><span class="fu">Feature</span>(centroid<span class="op">,</span> feature<span class="op">.</span><span class="fu">toDictionary</span>())<span class="op">;</span></span>
<span id="cb8-40" class="hljs-ln-code"><a href="#cb8-40"></a>  <span class="cf">return</span> pointFeature<span class="op">;</span></span>
<span id="cb8-41" class="hljs-ln-code"><a href="#cb8-41"></a>}<span class="op">;</span></span>
<span id="cb8-42" class="hljs-ln-code"><a href="#cb8-42"></a></span>
<span id="cb8-43" class="hljs-ln-code"><a href="#cb8-43"></a><span class="co">// Center the map on the continental USA</span></span>
<span id="cb8-44" class="hljs-ln-code"><a href="#cb8-44"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">setCenter</span>(<span class="op">-</span><span class="fl">98.5833</span><span class="op">,</span> <span class="fl">39.8333</span><span class="op">,</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb8-45" class="hljs-ln-code"><a href="#cb8-45"></a></span>
<span id="cb8-46" class="hljs-ln-code"><a href="#cb8-46"></a><span class="co">// Display the filtered FeatureCollection</span></span>
<span id="cb8-47" class="hljs-ln-code"><a href="#cb8-47"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(interstates<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">'green'</span>}<span class="op">,</span> <span class="st">'Interstates'</span>)<span class="op">;</span></span>
<span id="cb8-48" class="hljs-ln-code"><a href="#cb8-48"></a></span>
<span id="cb8-49" class="hljs-ln-code"><a href="#cb8-49"></a><span class="co">// Set visualization parameters</span></span>
<span id="cb8-50" class="hljs-ln-code"><a href="#cb8-50"></a><span class="kw">var</span> streamsVis <span class="op">=</span> {</span>
<span id="cb8-51" class="hljs-ln-code"><a href="#cb8-51"></a>  <span class="dt">color</span><span class="op">:</span> <span class="st">'blue'</span><span class="op">,</span></span>
<span id="cb8-52" class="hljs-ln-code"><a href="#cb8-52"></a>  <span class="dt">width</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb8-53" class="hljs-ln-code"><a href="#cb8-53"></a>}<span class="op">;</span></span>
<span id="cb8-54" class="hljs-ln-code"><a href="#cb8-54"></a></span>
<span id="cb8-55" class="hljs-ln-code"><a href="#cb8-55"></a><span class="co">// Add the filtered streams to the map</span></span>
<span id="cb8-56" class="hljs-ln-code"><a href="#cb8-56"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(filteredStreams<span class="op">,</span> streamsVis<span class="op">,</span> <span class="st">'Filtered Streams'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="finding-intersection-points-2" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Finding intersection points</h2>
<div class="sourceCode" id="cb9" data-code-line-numbers="43-49"><pre class="sourceCode numberSource javascript number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><span id="cb9-1" class="hljs-ln-code"><a href="#cb9-1"></a><span class="co">// Load road data from US census bureau </span></span>
<span id="cb9-2" class="hljs-ln-code"><a href="#cb9-2"></a><span class="kw">var</span> roads <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"TIGER/2016/Roads"</span>)<span class="op">;</span></span>
<span id="cb9-3" class="hljs-ln-code"><a href="#cb9-3"></a></span>
<span id="cb9-4" class="hljs-ln-code"><a href="#cb9-4"></a><span class="co">// Load the WWF HydroSHEDS Free Flowing Rivers Network v1 dataset</span></span>
<span id="cb9-5" class="hljs-ln-code"><a href="#cb9-5"></a><span class="kw">var</span> hydrosheds <span class="op">=</span></span>
<span id="cb9-6" class="hljs-ln-code"><a href="#cb9-6"></a>ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"WWF/HydroSHEDS/v1/FreeFlowingRivers"</span>)<span class="op">;</span></span>
<span id="cb9-7" class="hljs-ln-code"><a href="#cb9-7"></a></span>
<span id="cb9-8" class="hljs-ln-code"><a href="#cb9-8"></a><span class="co">// Select just interstates using the MTFCC code</span></span>
<span id="cb9-9" class="hljs-ln-code"><a href="#cb9-9"></a><span class="kw">var</span> interstates <span class="op">=</span> roads<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'mtfcc'</span><span class="op">,</span> <span class="st">'S1100'</span>))<span class="op">;</span></span>
<span id="cb9-10" class="hljs-ln-code"><a href="#cb9-10"></a></span>
<span id="cb9-11" class="hljs-ln-code"><a href="#cb9-11"></a><span class="co">// Filter out streams with an order less than 4</span></span>
<span id="cb9-12" class="hljs-ln-code"><a href="#cb9-12"></a><span class="kw">var</span> filteredStreams <span class="op">=</span> </span>
<span id="cb9-13" class="hljs-ln-code"><a href="#cb9-13"></a>      hydrosheds<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lte</span>(<span class="st">'RIV_ORD'</span><span class="op">,</span> <span class="dv">4</span>))</span>
<span id="cb9-14" class="hljs-ln-code"><a href="#cb9-14"></a>                <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'COUNTRY'</span><span class="op">,</span><span class="st">'United States'</span>))<span class="op">;</span></span>
<span id="cb9-15" class="hljs-ln-code"><a href="#cb9-15"></a></span>
<span id="cb9-16" class="hljs-ln-code"><a href="#cb9-16"></a><span class="co">// Perform a spatial join between filteredStreams</span></span>
<span id="cb9-17" class="hljs-ln-code"><a href="#cb9-17"></a><span class="co">// and interstates FeatureCollections</span></span>
<span id="cb9-18" class="hljs-ln-code"><a href="#cb9-18"></a><span class="kw">var</span> join <span class="op">=</span> ee<span class="op">.</span><span class="at">Join</span><span class="op">.</span><span class="fu">simple</span>()<span class="op">;</span></span>
<span id="cb9-19" class="hljs-ln-code"><a href="#cb9-19"></a><span class="kw">var</span> filter <span class="op">=</span> ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">intersects</span>({</span>
<span id="cb9-20" class="hljs-ln-code"><a href="#cb9-20"></a>  <span class="dt">leftField</span><span class="op">:</span> <span class="st">'.geo'</span><span class="op">,</span></span>
<span id="cb9-21" class="hljs-ln-code"><a href="#cb9-21"></a>  <span class="dt">rightField</span><span class="op">:</span> <span class="st">'.geo'</span></span>
<span id="cb9-22" class="hljs-ln-code"><a href="#cb9-22"></a>})<span class="op">;</span></span>
<span id="cb9-23" class="hljs-ln-code"><a href="#cb9-23"></a></span>
<span id="cb9-24" class="hljs-ln-code"><a href="#cb9-24"></a><span class="kw">var</span> intersectionLines <span class="op">=</span> join<span class="op">.</span><span class="fu">apply</span>(</span>
<span id="cb9-25" class="hljs-ln-code"><a href="#cb9-25"></a>                              filteredStreams<span class="op">,</span> </span>
<span id="cb9-26" class="hljs-ln-code"><a href="#cb9-26"></a>                              interstates<span class="op">,</span></span>
<span id="cb9-27" class="hljs-ln-code"><a href="#cb9-27"></a>                              filter)<span class="op">;</span></span>
<span id="cb9-28" class="hljs-ln-code"><a href="#cb9-28"></a></span>
<span id="cb9-29" class="hljs-ln-code"><a href="#cb9-29"></a><span class="co">// Sort by a random number and select the first N features</span></span>
<span id="cb9-30" class="hljs-ln-code"><a href="#cb9-30"></a><span class="kw">var</span> selectedLines <span class="op">=</span> intersectionLines<span class="op">.</span><span class="fu">sort</span>(<span class="st">'random'</span>)<span class="op">.</span><span class="fu">limit</span>(<span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb9-31" class="hljs-ln-code"><a href="#cb9-31"></a></span>
<span id="cb9-32" class="hljs-ln-code"><a href="#cb9-32"></a><span class="co">// Function to convert line geometry to a point </span></span>
<span id="cb9-33" class="hljs-ln-code"><a href="#cb9-33"></a><span class="kw">var</span> lineToPoint <span class="op">=</span> <span class="kw">function</span>(feature) {</span>
<span id="cb9-34" class="hljs-ln-code"><a href="#cb9-34"></a>  <span class="co">// Get the geometry</span></span>
<span id="cb9-35" class="hljs-ln-code"><a href="#cb9-35"></a>  <span class="kw">var</span> geom <span class="op">=</span> feature<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb9-36" class="hljs-ln-code"><a href="#cb9-36"></a>  <span class="co">// Get the centroid of the geometry</span></span>
<span id="cb9-37" class="hljs-ln-code"><a href="#cb9-37"></a>  <span class="kw">var</span> centroid <span class="op">=</span> geom<span class="op">.</span><span class="fu">centroid</span>()<span class="op">;</span></span>
<span id="cb9-38" class="hljs-ln-code"><a href="#cb9-38"></a>  <span class="co">// Create a new point feature</span></span>
<span id="cb9-39" class="hljs-ln-code"><a href="#cb9-39"></a>  <span class="kw">var</span> pointFeature <span class="op">=</span> ee<span class="op">.</span><span class="fu">Feature</span>(centroid<span class="op">,</span> feature<span class="op">.</span><span class="fu">toDictionary</span>())<span class="op">;</span></span>
<span id="cb9-40" class="hljs-ln-code"><a href="#cb9-40"></a>  <span class="cf">return</span> pointFeature<span class="op">;</span></span>
<span id="cb9-41" class="hljs-ln-code"><a href="#cb9-41"></a>}<span class="op">;</span></span>
<span id="cb9-42" class="hljs-ln-code"><a href="#cb9-42"></a></span>
<span id="cb9-43" class="hljs-ln-code"><a href="#cb9-43"></a><span class="co">// Apply the lineToPoint function to each element</span></span>
<span id="cb9-44" class="hljs-ln-code"><a href="#cb9-44"></a><span class="co">// in intersectionPoints</span></span>
<span id="cb9-45" class="hljs-ln-code"><a href="#cb9-45"></a><span class="kw">var</span> intersectionPoints <span class="op">=</span> selectedLines<span class="op">.</span><span class="fu">map</span>(lineToPoint)<span class="op">;</span></span>
<span id="cb9-46" class="hljs-ln-code"><a href="#cb9-46"></a></span>
<span id="cb9-47" class="hljs-ln-code"><a href="#cb9-47"></a><span class="co">// Convert the intersectionPoints FeatureCollection to a List</span></span>
<span id="cb9-48" class="hljs-ln-code"><a href="#cb9-48"></a><span class="kw">var</span> pointsList <span class="op">=</span> intersectionPoints</span>
<span id="cb9-49" class="hljs-ln-code"><a href="#cb9-49"></a>                              <span class="op">.</span><span class="fu">toList</span>(intersectionPoints<span class="op">.</span><span class="fu">size</span>())<span class="op">;</span></span>
<span id="cb9-50" class="hljs-ln-code"><a href="#cb9-50"></a></span>
<span id="cb9-51" class="hljs-ln-code"><a href="#cb9-51"></a><span class="co">// Center the map on the continental USA</span></span>
<span id="cb9-52" class="hljs-ln-code"><a href="#cb9-52"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">setCenter</span>(<span class="op">-</span><span class="fl">98.5833</span><span class="op">,</span> <span class="fl">39.8333</span><span class="op">,</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb9-53" class="hljs-ln-code"><a href="#cb9-53"></a></span>
<span id="cb9-54" class="hljs-ln-code"><a href="#cb9-54"></a><span class="co">// Display the filtered FeatureCollection</span></span>
<span id="cb9-55" class="hljs-ln-code"><a href="#cb9-55"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(interstates<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">'green'</span>}<span class="op">,</span> <span class="st">'Interstates'</span>)<span class="op">;</span></span>
<span id="cb9-56" class="hljs-ln-code"><a href="#cb9-56"></a></span>
<span id="cb9-57" class="hljs-ln-code"><a href="#cb9-57"></a><span class="co">// Set visualization parameters</span></span>
<span id="cb9-58" class="hljs-ln-code"><a href="#cb9-58"></a><span class="kw">var</span> streamsVis <span class="op">=</span> {</span>
<span id="cb9-59" class="hljs-ln-code"><a href="#cb9-59"></a>  <span class="dt">color</span><span class="op">:</span> <span class="st">'blue'</span><span class="op">,</span></span>
<span id="cb9-60" class="hljs-ln-code"><a href="#cb9-60"></a>  <span class="dt">width</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb9-61" class="hljs-ln-code"><a href="#cb9-61"></a>}<span class="op">;</span></span>
<span id="cb9-62" class="hljs-ln-code"><a href="#cb9-62"></a></span>
<span id="cb9-63" class="hljs-ln-code"><a href="#cb9-63"></a><span class="co">// Add the filtered streams to the map</span></span>
<span id="cb9-64" class="hljs-ln-code"><a href="#cb9-64"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(filteredStreams<span class="op">,</span> streamsVis<span class="op">,</span> <span class="st">'Filtered Streams'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="viewing-intersection-points" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Viewing intersection points</h2>
<div class="sourceCode" id="cb10" data-code-line-numbers="66-71"><pre class="sourceCode numberSource javascript number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><span id="cb10-1" class="hljs-ln-code"><a href="#cb10-1"></a><span class="co">// Load road data from US census bureau </span></span>
<span id="cb10-2" class="hljs-ln-code"><a href="#cb10-2"></a><span class="kw">var</span> roads <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"TIGER/2016/Roads"</span>)<span class="op">;</span></span>
<span id="cb10-3" class="hljs-ln-code"><a href="#cb10-3"></a></span>
<span id="cb10-4" class="hljs-ln-code"><a href="#cb10-4"></a><span class="co">// Load the WWF HydroSHEDS Free Flowing Rivers Network v1 dataset</span></span>
<span id="cb10-5" class="hljs-ln-code"><a href="#cb10-5"></a><span class="kw">var</span> hydrosheds <span class="op">=</span></span>
<span id="cb10-6" class="hljs-ln-code"><a href="#cb10-6"></a>ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"WWF/HydroSHEDS/v1/FreeFlowingRivers"</span>)<span class="op">;</span></span>
<span id="cb10-7" class="hljs-ln-code"><a href="#cb10-7"></a></span>
<span id="cb10-8" class="hljs-ln-code"><a href="#cb10-8"></a><span class="co">// Select just interstates using the MTFCC code</span></span>
<span id="cb10-9" class="hljs-ln-code"><a href="#cb10-9"></a><span class="kw">var</span> interstates <span class="op">=</span> roads<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'mtfcc'</span><span class="op">,</span> <span class="st">'S1100'</span>))<span class="op">;</span></span>
<span id="cb10-10" class="hljs-ln-code"><a href="#cb10-10"></a></span>
<span id="cb10-11" class="hljs-ln-code"><a href="#cb10-11"></a><span class="co">// Filter out streams with an order less than 4</span></span>
<span id="cb10-12" class="hljs-ln-code"><a href="#cb10-12"></a><span class="kw">var</span> filteredStreams <span class="op">=</span> </span>
<span id="cb10-13" class="hljs-ln-code"><a href="#cb10-13"></a>      hydrosheds<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lte</span>(<span class="st">'RIV_ORD'</span><span class="op">,</span> <span class="dv">4</span>))</span>
<span id="cb10-14" class="hljs-ln-code"><a href="#cb10-14"></a>                <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'COUNTRY'</span><span class="op">,</span><span class="st">'United States'</span>))<span class="op">;</span></span>
<span id="cb10-15" class="hljs-ln-code"><a href="#cb10-15"></a></span>
<span id="cb10-16" class="hljs-ln-code"><a href="#cb10-16"></a><span class="co">// Perform a spatial join between filteredStreams</span></span>
<span id="cb10-17" class="hljs-ln-code"><a href="#cb10-17"></a><span class="co">// and interstates FeatureCollections</span></span>
<span id="cb10-18" class="hljs-ln-code"><a href="#cb10-18"></a><span class="kw">var</span> join <span class="op">=</span> ee<span class="op">.</span><span class="at">Join</span><span class="op">.</span><span class="fu">simple</span>()<span class="op">;</span></span>
<span id="cb10-19" class="hljs-ln-code"><a href="#cb10-19"></a><span class="kw">var</span> filter <span class="op">=</span> ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">intersects</span>({</span>
<span id="cb10-20" class="hljs-ln-code"><a href="#cb10-20"></a>  <span class="dt">leftField</span><span class="op">:</span> <span class="st">'.geo'</span><span class="op">,</span></span>
<span id="cb10-21" class="hljs-ln-code"><a href="#cb10-21"></a>  <span class="dt">rightField</span><span class="op">:</span> <span class="st">'.geo'</span></span>
<span id="cb10-22" class="hljs-ln-code"><a href="#cb10-22"></a>})<span class="op">;</span></span>
<span id="cb10-23" class="hljs-ln-code"><a href="#cb10-23"></a></span>
<span id="cb10-24" class="hljs-ln-code"><a href="#cb10-24"></a><span class="kw">var</span> intersectionLines <span class="op">=</span> join<span class="op">.</span><span class="fu">apply</span>(</span>
<span id="cb10-25" class="hljs-ln-code"><a href="#cb10-25"></a>                              filteredStreams<span class="op">,</span> </span>
<span id="cb10-26" class="hljs-ln-code"><a href="#cb10-26"></a>                              interstates<span class="op">,</span></span>
<span id="cb10-27" class="hljs-ln-code"><a href="#cb10-27"></a>                              filter)<span class="op">;</span></span>
<span id="cb10-28" class="hljs-ln-code"><a href="#cb10-28"></a></span>
<span id="cb10-29" class="hljs-ln-code"><a href="#cb10-29"></a><span class="co">// Sort by a random number and select the first N features</span></span>
<span id="cb10-30" class="hljs-ln-code"><a href="#cb10-30"></a><span class="kw">var</span> selectedLines <span class="op">=</span> intersectionLines<span class="op">.</span><span class="fu">sort</span>(<span class="st">'random'</span>)<span class="op">.</span><span class="fu">limit</span>(<span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb10-31" class="hljs-ln-code"><a href="#cb10-31"></a></span>
<span id="cb10-32" class="hljs-ln-code"><a href="#cb10-32"></a><span class="co">// Function to convert line geometry to a point </span></span>
<span id="cb10-33" class="hljs-ln-code"><a href="#cb10-33"></a><span class="kw">var</span> lineToPoint <span class="op">=</span> <span class="kw">function</span>(feature) {</span>
<span id="cb10-34" class="hljs-ln-code"><a href="#cb10-34"></a>  <span class="co">// Get the geometry</span></span>
<span id="cb10-35" class="hljs-ln-code"><a href="#cb10-35"></a>  <span class="kw">var</span> geom <span class="op">=</span> feature<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb10-36" class="hljs-ln-code"><a href="#cb10-36"></a>  <span class="co">// Get the centroid of the geometry</span></span>
<span id="cb10-37" class="hljs-ln-code"><a href="#cb10-37"></a>  <span class="kw">var</span> centroid <span class="op">=</span> geom<span class="op">.</span><span class="fu">centroid</span>()<span class="op">;</span></span>
<span id="cb10-38" class="hljs-ln-code"><a href="#cb10-38"></a>  <span class="co">// Create a new point feature</span></span>
<span id="cb10-39" class="hljs-ln-code"><a href="#cb10-39"></a>  <span class="kw">var</span> pointFeature <span class="op">=</span> ee<span class="op">.</span><span class="fu">Feature</span>(centroid<span class="op">,</span> feature<span class="op">.</span><span class="fu">toDictionary</span>())<span class="op">;</span></span>
<span id="cb10-40" class="hljs-ln-code"><a href="#cb10-40"></a>  <span class="cf">return</span> pointFeature<span class="op">;</span></span>
<span id="cb10-41" class="hljs-ln-code"><a href="#cb10-41"></a>}<span class="op">;</span></span>
<span id="cb10-42" class="hljs-ln-code"><a href="#cb10-42"></a></span>
<span id="cb10-43" class="hljs-ln-code"><a href="#cb10-43"></a><span class="co">// Apply the lineToPoint function to each element</span></span>
<span id="cb10-44" class="hljs-ln-code"><a href="#cb10-44"></a><span class="co">// in intersectionPoints</span></span>
<span id="cb10-45" class="hljs-ln-code"><a href="#cb10-45"></a><span class="kw">var</span> intersectionPoints <span class="op">=</span> selectedLines<span class="op">.</span><span class="fu">map</span>(lineToPoint)<span class="op">;</span></span>
<span id="cb10-46" class="hljs-ln-code"><a href="#cb10-46"></a></span>
<span id="cb10-47" class="hljs-ln-code"><a href="#cb10-47"></a><span class="co">// Convert the intersectionPoints FeatureCollection to a List</span></span>
<span id="cb10-48" class="hljs-ln-code"><a href="#cb10-48"></a><span class="kw">var</span> pointsList <span class="op">=</span> intersectionPoints</span>
<span id="cb10-49" class="hljs-ln-code"><a href="#cb10-49"></a>                              <span class="op">.</span><span class="fu">toList</span>(intersectionPoints<span class="op">.</span><span class="fu">size</span>())<span class="op">;</span></span>
<span id="cb10-50" class="hljs-ln-code"><a href="#cb10-50"></a></span>
<span id="cb10-51" class="hljs-ln-code"><a href="#cb10-51"></a><span class="co">// Center the map on the continental USA</span></span>
<span id="cb10-52" class="hljs-ln-code"><a href="#cb10-52"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">setCenter</span>(<span class="op">-</span><span class="fl">98.5833</span><span class="op">,</span> <span class="fl">39.8333</span><span class="op">,</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb10-53" class="hljs-ln-code"><a href="#cb10-53"></a></span>
<span id="cb10-54" class="hljs-ln-code"><a href="#cb10-54"></a><span class="co">// Display the filtered FeatureCollection</span></span>
<span id="cb10-55" class="hljs-ln-code"><a href="#cb10-55"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(interstates<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">'green'</span>}<span class="op">,</span> <span class="st">'Interstates'</span>)<span class="op">;</span></span>
<span id="cb10-56" class="hljs-ln-code"><a href="#cb10-56"></a></span>
<span id="cb10-57" class="hljs-ln-code"><a href="#cb10-57"></a><span class="co">// Set visualization parameters</span></span>
<span id="cb10-58" class="hljs-ln-code"><a href="#cb10-58"></a><span class="kw">var</span> streamsVis <span class="op">=</span> {</span>
<span id="cb10-59" class="hljs-ln-code"><a href="#cb10-59"></a>  <span class="dt">color</span><span class="op">:</span> <span class="st">'blue'</span><span class="op">,</span></span>
<span id="cb10-60" class="hljs-ln-code"><a href="#cb10-60"></a>  <span class="dt">width</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb10-61" class="hljs-ln-code"><a href="#cb10-61"></a>}<span class="op">;</span></span>
<span id="cb10-62" class="hljs-ln-code"><a href="#cb10-62"></a></span>
<span id="cb10-63" class="hljs-ln-code"><a href="#cb10-63"></a><span class="co">// Add the filtered streams to the map</span></span>
<span id="cb10-64" class="hljs-ln-code"><a href="#cb10-64"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(filteredStreams<span class="op">,</span> streamsVis<span class="op">,</span> <span class="st">'Filtered Streams'</span>)<span class="op">;</span></span>
<span id="cb10-65" class="hljs-ln-code"><a href="#cb10-65"></a></span>
<span id="cb10-66" class="hljs-ln-code"><a href="#cb10-66"></a><span class="co">// Add the filtered intersection points to the map</span></span>
<span id="cb10-67" class="hljs-ln-code"><a href="#cb10-67"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(</span>
<span id="cb10-68" class="hljs-ln-code"><a href="#cb10-68"></a>             intersectionPoints<span class="op">,</span></span>
<span id="cb10-69" class="hljs-ln-code"><a href="#cb10-69"></a>             {<span class="dt">color</span><span class="op">:</span> <span class="st">'yellow'</span><span class="op">,</span><span class="dt">pointSize</span><span class="op">:</span> <span class="dv">10</span>}<span class="op">,</span></span>
<span id="cb10-70" class="hljs-ln-code"><a href="#cb10-70"></a>             <span class="st">'Filtered Intersection Points'</span></span>
<span id="cb10-71" class="hljs-ln-code"><a href="#cb10-71"></a>             )<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="bringing-in-population-density" class="slide level2">
<h2>Bringing in population density</h2>

<img data-src="./Images/AlabamaDens.png" class="r-stretch"><p>Going to add the following line:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb11-1"><a href="#cb11-1"></a><span class="co">// Load the population density data</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="kw">var</span> popDens <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">"CIESIN/GPWv411/GPW_Population_Density"</span>)<span class="op">;</span></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="co">//Take the 1st population density map within the given date arange</span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="kw">var</span> popDensYear <span class="op">=</span> popDens<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">'2010-01-01'</span><span class="op">,</span> <span class="st">'2019-12-31'</span>))<span class="op">.</span><span class="fu">first</span>()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<aside class="notes">
<p>Talk about how population density is a raster map where previously have used mostly vectors</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="sampling-population-densities" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Sampling population densities</h2>
<div class="sourceCode" id="cb12" data-code-line-numbers="57-67"><pre class="sourceCode numberSource javascript number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><span id="cb12-1" class="hljs-ln-code"><a href="#cb12-1"></a><span class="co">// Load road data from US census bureau </span></span>
<span id="cb12-2" class="hljs-ln-code"><a href="#cb12-2"></a><span class="kw">var</span> roads <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"TIGER/2016/Roads"</span>)<span class="op">;</span></span>
<span id="cb12-3" class="hljs-ln-code"><a href="#cb12-3"></a></span>
<span id="cb12-4" class="hljs-ln-code"><a href="#cb12-4"></a><span class="co">// Load the WWF HydroSHEDS Free Flowing Rivers Network v1 dataset</span></span>
<span id="cb12-5" class="hljs-ln-code"><a href="#cb12-5"></a><span class="kw">var</span> hydrosheds <span class="op">=</span></span>
<span id="cb12-6" class="hljs-ln-code"><a href="#cb12-6"></a>ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"WWF/HydroSHEDS/v1/FreeFlowingRivers"</span>)<span class="op">;</span></span>
<span id="cb12-7" class="hljs-ln-code"><a href="#cb12-7"></a></span>
<span id="cb12-8" class="hljs-ln-code"><a href="#cb12-8"></a><span class="co">// Load the population density data</span></span>
<span id="cb12-9" class="hljs-ln-code"><a href="#cb12-9"></a><span class="kw">var</span> popDens <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">"CIESIN/GPWv411/GPW_Population_Density"</span>)<span class="op">;</span></span>
<span id="cb12-10" class="hljs-ln-code"><a href="#cb12-10"></a></span>
<span id="cb12-11" class="hljs-ln-code"><a href="#cb12-11"></a><span class="co">// Select just interstates using the MTFCC code</span></span>
<span id="cb12-12" class="hljs-ln-code"><a href="#cb12-12"></a><span class="kw">var</span> interstates <span class="op">=</span> roads<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'mtfcc'</span><span class="op">,</span> <span class="st">'S1100'</span>))<span class="op">;</span></span>
<span id="cb12-13" class="hljs-ln-code"><a href="#cb12-13"></a></span>
<span id="cb12-14" class="hljs-ln-code"><a href="#cb12-14"></a><span class="co">// Filter out streams with an order less than 4</span></span>
<span id="cb12-15" class="hljs-ln-code"><a href="#cb12-15"></a><span class="kw">var</span> filteredStreams <span class="op">=</span> </span>
<span id="cb12-16" class="hljs-ln-code"><a href="#cb12-16"></a>      hydrosheds<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lte</span>(<span class="st">'RIV_ORD'</span><span class="op">,</span> <span class="dv">4</span>))</span>
<span id="cb12-17" class="hljs-ln-code"><a href="#cb12-17"></a>                <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'COUNTRY'</span><span class="op">,</span><span class="st">'United States'</span>))<span class="op">;</span></span>
<span id="cb12-18" class="hljs-ln-code"><a href="#cb12-18"></a></span>
<span id="cb12-19" class="hljs-ln-code"><a href="#cb12-19"></a><span class="co">//Take the 1st population density map within the given date arange</span></span>
<span id="cb12-20" class="hljs-ln-code"><a href="#cb12-20"></a><span class="kw">var</span> popDensYear <span class="op">=</span> popDens<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">'2010-01-01'</span><span class="op">,</span> <span class="st">'2019-12-31'</span>))<span class="op">.</span><span class="fu">first</span>()<span class="op">;</span></span>
<span id="cb12-21" class="hljs-ln-code"><a href="#cb12-21"></a></span>
<span id="cb12-22" class="hljs-ln-code"><a href="#cb12-22"></a><span class="co">// Perform a spatial join between filteredStreams</span></span>
<span id="cb12-23" class="hljs-ln-code"><a href="#cb12-23"></a><span class="co">// and interstates FeatureCollections</span></span>
<span id="cb12-24" class="hljs-ln-code"><a href="#cb12-24"></a><span class="kw">var</span> join <span class="op">=</span> ee<span class="op">.</span><span class="at">Join</span><span class="op">.</span><span class="fu">simple</span>()<span class="op">;</span></span>
<span id="cb12-25" class="hljs-ln-code"><a href="#cb12-25"></a><span class="kw">var</span> filter <span class="op">=</span> ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">intersects</span>({</span>
<span id="cb12-26" class="hljs-ln-code"><a href="#cb12-26"></a>  <span class="dt">leftField</span><span class="op">:</span> <span class="st">'.geo'</span><span class="op">,</span></span>
<span id="cb12-27" class="hljs-ln-code"><a href="#cb12-27"></a>  <span class="dt">rightField</span><span class="op">:</span> <span class="st">'.geo'</span></span>
<span id="cb12-28" class="hljs-ln-code"><a href="#cb12-28"></a>})<span class="op">;</span></span>
<span id="cb12-29" class="hljs-ln-code"><a href="#cb12-29"></a></span>
<span id="cb12-30" class="hljs-ln-code"><a href="#cb12-30"></a><span class="kw">var</span> intersectionLines <span class="op">=</span> join<span class="op">.</span><span class="fu">apply</span>(</span>
<span id="cb12-31" class="hljs-ln-code"><a href="#cb12-31"></a>                              filteredStreams<span class="op">,</span> </span>
<span id="cb12-32" class="hljs-ln-code"><a href="#cb12-32"></a>                              interstates<span class="op">,</span></span>
<span id="cb12-33" class="hljs-ln-code"><a href="#cb12-33"></a>                              filter)<span class="op">;</span></span>
<span id="cb12-34" class="hljs-ln-code"><a href="#cb12-34"></a></span>
<span id="cb12-35" class="hljs-ln-code"><a href="#cb12-35"></a><span class="co">// Sort by a random number and select the first N features</span></span>
<span id="cb12-36" class="hljs-ln-code"><a href="#cb12-36"></a><span class="kw">var</span> selectedLines <span class="op">=</span> intersectionLines<span class="op">.</span><span class="fu">sort</span>(<span class="st">'random'</span>)<span class="op">.</span><span class="fu">limit</span>(<span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb12-37" class="hljs-ln-code"><a href="#cb12-37"></a></span>
<span id="cb12-38" class="hljs-ln-code"><a href="#cb12-38"></a><span class="co">// Function to convert line geometry to a point </span></span>
<span id="cb12-39" class="hljs-ln-code"><a href="#cb12-39"></a><span class="kw">var</span> lineToPoint <span class="op">=</span> <span class="kw">function</span>(feature) {</span>
<span id="cb12-40" class="hljs-ln-code"><a href="#cb12-40"></a>  <span class="co">// Get the geometry</span></span>
<span id="cb12-41" class="hljs-ln-code"><a href="#cb12-41"></a>  <span class="kw">var</span> geom <span class="op">=</span> feature<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb12-42" class="hljs-ln-code"><a href="#cb12-42"></a>  <span class="co">// Get the centroid of the geometry</span></span>
<span id="cb12-43" class="hljs-ln-code"><a href="#cb12-43"></a>  <span class="kw">var</span> centroid <span class="op">=</span> geom<span class="op">.</span><span class="fu">centroid</span>()<span class="op">;</span></span>
<span id="cb12-44" class="hljs-ln-code"><a href="#cb12-44"></a>  <span class="co">// Create a new point feature</span></span>
<span id="cb12-45" class="hljs-ln-code"><a href="#cb12-45"></a>  <span class="kw">var</span> pointFeature <span class="op">=</span> ee<span class="op">.</span><span class="fu">Feature</span>(centroid<span class="op">,</span> feature<span class="op">.</span><span class="fu">toDictionary</span>())<span class="op">;</span></span>
<span id="cb12-46" class="hljs-ln-code"><a href="#cb12-46"></a>  <span class="cf">return</span> pointFeature<span class="op">;</span></span>
<span id="cb12-47" class="hljs-ln-code"><a href="#cb12-47"></a>}<span class="op">;</span></span>
<span id="cb12-48" class="hljs-ln-code"><a href="#cb12-48"></a></span>
<span id="cb12-49" class="hljs-ln-code"><a href="#cb12-49"></a><span class="co">// Apply the lineToPoint function to each element</span></span>
<span id="cb12-50" class="hljs-ln-code"><a href="#cb12-50"></a><span class="co">// in intersectionPoints</span></span>
<span id="cb12-51" class="hljs-ln-code"><a href="#cb12-51"></a><span class="kw">var</span> intersectionPoints <span class="op">=</span> selectedLines<span class="op">.</span><span class="fu">map</span>(lineToPoint)<span class="op">;</span></span>
<span id="cb12-52" class="hljs-ln-code"><a href="#cb12-52"></a></span>
<span id="cb12-53" class="hljs-ln-code"><a href="#cb12-53"></a><span class="co">// Convert the intersectionPoints FeatureCollection to a List</span></span>
<span id="cb12-54" class="hljs-ln-code"><a href="#cb12-54"></a><span class="kw">var</span> pointsList <span class="op">=</span> intersectionPoints</span>
<span id="cb12-55" class="hljs-ln-code"><a href="#cb12-55"></a>                              <span class="op">.</span><span class="fu">toList</span>(intersectionPoints<span class="op">.</span><span class="fu">size</span>())<span class="op">;</span></span>
<span id="cb12-56" class="hljs-ln-code"><a href="#cb12-56"></a></span>
<span id="cb12-57" class="hljs-ln-code"><a href="#cb12-57"></a><span class="co">// Function to buffer a point and set an ID</span></span>
<span id="cb12-58" class="hljs-ln-code"><a href="#cb12-58"></a><span class="kw">var</span> bufferAndSetID <span class="op">=</span> <span class="kw">function</span>(index) {</span>
<span id="cb12-59" class="hljs-ln-code"><a href="#cb12-59"></a>  <span class="co">// Get the point</span></span>
<span id="cb12-60" class="hljs-ln-code"><a href="#cb12-60"></a>  <span class="kw">var</span> point <span class="op">=</span> ee<span class="op">.</span><span class="fu">Feature</span>(pointsList<span class="op">.</span><span class="fu">get</span>(index))<span class="op">;</span></span>
<span id="cb12-61" class="hljs-ln-code"><a href="#cb12-61"></a>  <span class="co">// Buffer the point</span></span>
<span id="cb12-62" class="hljs-ln-code"><a href="#cb12-62"></a>  <span class="kw">var</span> bufferedPoint <span class="op">=</span> point<span class="op">.</span><span class="fu">buffer</span>(<span class="dv">10000</span>)<span class="op">;</span></span>
<span id="cb12-63" class="hljs-ln-code"><a href="#cb12-63"></a>  <span class="co">// Set the ID</span></span>
<span id="cb12-64" class="hljs-ln-code"><a href="#cb12-64"></a>  <span class="kw">var</span> bufferedPointWithID <span class="op">=</span> bufferedPoint<span class="op">.</span><span class="fu">set</span>(<span class="st">'ID'</span><span class="op">,</span> index)<span class="op">;</span></span>
<span id="cb12-65" class="hljs-ln-code"><a href="#cb12-65"></a>  <span class="co">// Return the buffered point with ID</span></span>
<span id="cb12-66" class="hljs-ln-code"><a href="#cb12-66"></a>  <span class="cf">return</span> bufferedPointWithID<span class="op">;</span></span>
<span id="cb12-67" class="hljs-ln-code"><a href="#cb12-67"></a>}<span class="op">;</span></span>
<span id="cb12-68" class="hljs-ln-code"><a href="#cb12-68"></a></span>
<span id="cb12-69" class="hljs-ln-code"><a href="#cb12-69"></a><span class="co">// Center the map on the continental USA</span></span>
<span id="cb12-70" class="hljs-ln-code"><a href="#cb12-70"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">setCenter</span>(<span class="op">-</span><span class="fl">98.5833</span><span class="op">,</span> <span class="fl">39.8333</span><span class="op">,</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb12-71" class="hljs-ln-code"><a href="#cb12-71"></a></span>
<span id="cb12-72" class="hljs-ln-code"><a href="#cb12-72"></a><span class="co">// Display the filtered FeatureCollection</span></span>
<span id="cb12-73" class="hljs-ln-code"><a href="#cb12-73"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(interstates<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">'green'</span>}<span class="op">,</span> <span class="st">'Interstates'</span>)<span class="op">;</span></span>
<span id="cb12-74" class="hljs-ln-code"><a href="#cb12-74"></a></span>
<span id="cb12-75" class="hljs-ln-code"><a href="#cb12-75"></a><span class="co">// Set visualization parameters</span></span>
<span id="cb12-76" class="hljs-ln-code"><a href="#cb12-76"></a><span class="kw">var</span> streamsVis <span class="op">=</span> {</span>
<span id="cb12-77" class="hljs-ln-code"><a href="#cb12-77"></a>  <span class="dt">color</span><span class="op">:</span> <span class="st">'blue'</span><span class="op">,</span></span>
<span id="cb12-78" class="hljs-ln-code"><a href="#cb12-78"></a>  <span class="dt">width</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb12-79" class="hljs-ln-code"><a href="#cb12-79"></a>}<span class="op">;</span></span>
<span id="cb12-80" class="hljs-ln-code"><a href="#cb12-80"></a></span>
<span id="cb12-81" class="hljs-ln-code"><a href="#cb12-81"></a><span class="co">// Add the filtered streams to the map</span></span>
<span id="cb12-82" class="hljs-ln-code"><a href="#cb12-82"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(filteredStreams<span class="op">,</span> streamsVis<span class="op">,</span> <span class="st">'Filtered Streams'</span>)<span class="op">;</span></span>
<span id="cb12-83" class="hljs-ln-code"><a href="#cb12-83"></a></span>
<span id="cb12-84" class="hljs-ln-code"><a href="#cb12-84"></a><span class="co">// Add the filtered intersection points to the map</span></span>
<span id="cb12-85" class="hljs-ln-code"><a href="#cb12-85"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(</span>
<span id="cb12-86" class="hljs-ln-code"><a href="#cb12-86"></a>             intersectionPoints<span class="op">,</span></span>
<span id="cb12-87" class="hljs-ln-code"><a href="#cb12-87"></a>             {<span class="dt">color</span><span class="op">:</span> <span class="st">'yellow'</span><span class="op">,</span><span class="dt">pointSize</span><span class="op">:</span> <span class="dv">10</span>}<span class="op">,</span></span>
<span id="cb12-88" class="hljs-ln-code"><a href="#cb12-88"></a>             <span class="st">'Filtered Intersection Points'</span></span>
<span id="cb12-89" class="hljs-ln-code"><a href="#cb12-89"></a>             )<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="sampling-population-densities-1" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Sampling population densities</h2>
<div class="sourceCode" id="cb13" data-code-line-numbers="69-77"><pre class="sourceCode numberSource javascript number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><span id="cb13-1" class="hljs-ln-code"><a href="#cb13-1"></a><span class="co">// Load road data from US census bureau </span></span>
<span id="cb13-2" class="hljs-ln-code"><a href="#cb13-2"></a><span class="kw">var</span> roads <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"TIGER/2016/Roads"</span>)<span class="op">;</span></span>
<span id="cb13-3" class="hljs-ln-code"><a href="#cb13-3"></a></span>
<span id="cb13-4" class="hljs-ln-code"><a href="#cb13-4"></a><span class="co">// Load the WWF HydroSHEDS Free Flowing Rivers Network v1 dataset</span></span>
<span id="cb13-5" class="hljs-ln-code"><a href="#cb13-5"></a><span class="kw">var</span> hydrosheds <span class="op">=</span></span>
<span id="cb13-6" class="hljs-ln-code"><a href="#cb13-6"></a>ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"WWF/HydroSHEDS/v1/FreeFlowingRivers"</span>)<span class="op">;</span></span>
<span id="cb13-7" class="hljs-ln-code"><a href="#cb13-7"></a></span>
<span id="cb13-8" class="hljs-ln-code"><a href="#cb13-8"></a><span class="co">// Load the population density data</span></span>
<span id="cb13-9" class="hljs-ln-code"><a href="#cb13-9"></a><span class="kw">var</span> popDens <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">"CIESIN/GPWv411/GPW_Population_Density"</span>)<span class="op">;</span></span>
<span id="cb13-10" class="hljs-ln-code"><a href="#cb13-10"></a></span>
<span id="cb13-11" class="hljs-ln-code"><a href="#cb13-11"></a><span class="co">// Select just interstates using the MTFCC code</span></span>
<span id="cb13-12" class="hljs-ln-code"><a href="#cb13-12"></a><span class="kw">var</span> interstates <span class="op">=</span> roads<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'mtfcc'</span><span class="op">,</span> <span class="st">'S1100'</span>))<span class="op">;</span></span>
<span id="cb13-13" class="hljs-ln-code"><a href="#cb13-13"></a></span>
<span id="cb13-14" class="hljs-ln-code"><a href="#cb13-14"></a><span class="co">// Filter out streams with an order less than 4</span></span>
<span id="cb13-15" class="hljs-ln-code"><a href="#cb13-15"></a><span class="kw">var</span> filteredStreams <span class="op">=</span> </span>
<span id="cb13-16" class="hljs-ln-code"><a href="#cb13-16"></a>      hydrosheds<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lte</span>(<span class="st">'RIV_ORD'</span><span class="op">,</span> <span class="dv">4</span>))</span>
<span id="cb13-17" class="hljs-ln-code"><a href="#cb13-17"></a>                <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'COUNTRY'</span><span class="op">,</span><span class="st">'United States'</span>))<span class="op">;</span></span>
<span id="cb13-18" class="hljs-ln-code"><a href="#cb13-18"></a></span>
<span id="cb13-19" class="hljs-ln-code"><a href="#cb13-19"></a><span class="co">//Take the 1st population density map within the given date arange</span></span>
<span id="cb13-20" class="hljs-ln-code"><a href="#cb13-20"></a><span class="kw">var</span> popDensYear <span class="op">=</span> popDens<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">'2010-01-01'</span><span class="op">,</span> <span class="st">'2019-12-31'</span>))<span class="op">.</span><span class="fu">first</span>()<span class="op">;</span></span>
<span id="cb13-21" class="hljs-ln-code"><a href="#cb13-21"></a></span>
<span id="cb13-22" class="hljs-ln-code"><a href="#cb13-22"></a><span class="co">// Perform a spatial join between filteredStreams</span></span>
<span id="cb13-23" class="hljs-ln-code"><a href="#cb13-23"></a><span class="co">// and interstates FeatureCollections</span></span>
<span id="cb13-24" class="hljs-ln-code"><a href="#cb13-24"></a><span class="kw">var</span> join <span class="op">=</span> ee<span class="op">.</span><span class="at">Join</span><span class="op">.</span><span class="fu">simple</span>()<span class="op">;</span></span>
<span id="cb13-25" class="hljs-ln-code"><a href="#cb13-25"></a><span class="kw">var</span> filter <span class="op">=</span> ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">intersects</span>({</span>
<span id="cb13-26" class="hljs-ln-code"><a href="#cb13-26"></a>  <span class="dt">leftField</span><span class="op">:</span> <span class="st">'.geo'</span><span class="op">,</span></span>
<span id="cb13-27" class="hljs-ln-code"><a href="#cb13-27"></a>  <span class="dt">rightField</span><span class="op">:</span> <span class="st">'.geo'</span></span>
<span id="cb13-28" class="hljs-ln-code"><a href="#cb13-28"></a>})<span class="op">;</span></span>
<span id="cb13-29" class="hljs-ln-code"><a href="#cb13-29"></a></span>
<span id="cb13-30" class="hljs-ln-code"><a href="#cb13-30"></a><span class="kw">var</span> intersectionLines <span class="op">=</span> join<span class="op">.</span><span class="fu">apply</span>(</span>
<span id="cb13-31" class="hljs-ln-code"><a href="#cb13-31"></a>                              filteredStreams<span class="op">,</span> </span>
<span id="cb13-32" class="hljs-ln-code"><a href="#cb13-32"></a>                              interstates<span class="op">,</span></span>
<span id="cb13-33" class="hljs-ln-code"><a href="#cb13-33"></a>                              filter)<span class="op">;</span></span>
<span id="cb13-34" class="hljs-ln-code"><a href="#cb13-34"></a></span>
<span id="cb13-35" class="hljs-ln-code"><a href="#cb13-35"></a><span class="co">// Sort by a random number and select the first N features</span></span>
<span id="cb13-36" class="hljs-ln-code"><a href="#cb13-36"></a><span class="kw">var</span> selectedLines <span class="op">=</span> intersectionLines<span class="op">.</span><span class="fu">sort</span>(<span class="st">'random'</span>)<span class="op">.</span><span class="fu">limit</span>(<span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb13-37" class="hljs-ln-code"><a href="#cb13-37"></a></span>
<span id="cb13-38" class="hljs-ln-code"><a href="#cb13-38"></a><span class="co">// Function to convert line geometry to a point </span></span>
<span id="cb13-39" class="hljs-ln-code"><a href="#cb13-39"></a><span class="kw">var</span> lineToPoint <span class="op">=</span> <span class="kw">function</span>(feature) {</span>
<span id="cb13-40" class="hljs-ln-code"><a href="#cb13-40"></a>  <span class="co">// Get the geometry</span></span>
<span id="cb13-41" class="hljs-ln-code"><a href="#cb13-41"></a>  <span class="kw">var</span> geom <span class="op">=</span> feature<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb13-42" class="hljs-ln-code"><a href="#cb13-42"></a>  <span class="co">// Get the centroid of the geometry</span></span>
<span id="cb13-43" class="hljs-ln-code"><a href="#cb13-43"></a>  <span class="kw">var</span> centroid <span class="op">=</span> geom<span class="op">.</span><span class="fu">centroid</span>()<span class="op">;</span></span>
<span id="cb13-44" class="hljs-ln-code"><a href="#cb13-44"></a>  <span class="co">// Create a new point feature</span></span>
<span id="cb13-45" class="hljs-ln-code"><a href="#cb13-45"></a>  <span class="kw">var</span> pointFeature <span class="op">=</span> ee<span class="op">.</span><span class="fu">Feature</span>(centroid<span class="op">,</span> feature<span class="op">.</span><span class="fu">toDictionary</span>())<span class="op">;</span></span>
<span id="cb13-46" class="hljs-ln-code"><a href="#cb13-46"></a>  <span class="cf">return</span> pointFeature<span class="op">;</span></span>
<span id="cb13-47" class="hljs-ln-code"><a href="#cb13-47"></a>}<span class="op">;</span></span>
<span id="cb13-48" class="hljs-ln-code"><a href="#cb13-48"></a></span>
<span id="cb13-49" class="hljs-ln-code"><a href="#cb13-49"></a><span class="co">// Apply the lineToPoint function to each element</span></span>
<span id="cb13-50" class="hljs-ln-code"><a href="#cb13-50"></a><span class="co">// in intersectionPoints</span></span>
<span id="cb13-51" class="hljs-ln-code"><a href="#cb13-51"></a><span class="kw">var</span> intersectionPoints <span class="op">=</span> selectedLines<span class="op">.</span><span class="fu">map</span>(lineToPoint)<span class="op">;</span></span>
<span id="cb13-52" class="hljs-ln-code"><a href="#cb13-52"></a></span>
<span id="cb13-53" class="hljs-ln-code"><a href="#cb13-53"></a><span class="co">// Convert the intersectionPoints FeatureCollection to a List</span></span>
<span id="cb13-54" class="hljs-ln-code"><a href="#cb13-54"></a><span class="kw">var</span> pointsList <span class="op">=</span> intersectionPoints</span>
<span id="cb13-55" class="hljs-ln-code"><a href="#cb13-55"></a>                              <span class="op">.</span><span class="fu">toList</span>(intersectionPoints<span class="op">.</span><span class="fu">size</span>())<span class="op">;</span></span>
<span id="cb13-56" class="hljs-ln-code"><a href="#cb13-56"></a></span>
<span id="cb13-57" class="hljs-ln-code"><a href="#cb13-57"></a><span class="co">// Function to buffer a point and set an ID</span></span>
<span id="cb13-58" class="hljs-ln-code"><a href="#cb13-58"></a><span class="kw">var</span> bufferAndSetID <span class="op">=</span> <span class="kw">function</span>(index) {</span>
<span id="cb13-59" class="hljs-ln-code"><a href="#cb13-59"></a>  <span class="co">// Get the point</span></span>
<span id="cb13-60" class="hljs-ln-code"><a href="#cb13-60"></a>  <span class="kw">var</span> point <span class="op">=</span> ee<span class="op">.</span><span class="fu">Feature</span>(pointsList<span class="op">.</span><span class="fu">get</span>(index))<span class="op">;</span></span>
<span id="cb13-61" class="hljs-ln-code"><a href="#cb13-61"></a>  <span class="co">// Buffer the point</span></span>
<span id="cb13-62" class="hljs-ln-code"><a href="#cb13-62"></a>  <span class="kw">var</span> bufferedPoint <span class="op">=</span> point<span class="op">.</span><span class="fu">buffer</span>(<span class="dv">10000</span>)<span class="op">;</span></span>
<span id="cb13-63" class="hljs-ln-code"><a href="#cb13-63"></a>  <span class="co">// Set the ID</span></span>
<span id="cb13-64" class="hljs-ln-code"><a href="#cb13-64"></a>  <span class="kw">var</span> bufferedPointWithID <span class="op">=</span> bufferedPoint<span class="op">.</span><span class="fu">set</span>(<span class="st">'ID'</span><span class="op">,</span> index)<span class="op">;</span></span>
<span id="cb13-65" class="hljs-ln-code"><a href="#cb13-65"></a>  <span class="co">// Return the buffered point with ID</span></span>
<span id="cb13-66" class="hljs-ln-code"><a href="#cb13-66"></a>  <span class="cf">return</span> bufferedPointWithID<span class="op">;</span></span>
<span id="cb13-67" class="hljs-ln-code"><a href="#cb13-67"></a>}<span class="op">;</span></span>
<span id="cb13-68" class="hljs-ln-code"><a href="#cb13-68"></a></span>
<span id="cb13-69" class="hljs-ln-code"><a href="#cb13-69"></a><span class="co">// Create a sequence of numbers to use as IDs</span></span>
<span id="cb13-70" class="hljs-ln-code"><a href="#cb13-70"></a><span class="kw">var</span> ids <span class="op">=</span> ee<span class="op">.</span><span class="at">List</span><span class="op">.</span><span class="fu">sequence</span>(</span>
<span id="cb13-71" class="hljs-ln-code"><a href="#cb13-71"></a>                           <span class="dv">0</span><span class="op">,</span></span>
<span id="cb13-72" class="hljs-ln-code"><a href="#cb13-72"></a>                           intersectionPoints<span class="op">.</span><span class="fu">size</span>()<span class="op">.</span><span class="fu">subtract</span>(<span class="dv">1</span>)</span>
<span id="cb13-73" class="hljs-ln-code"><a href="#cb13-73"></a>                          )<span class="op">;</span></span>
<span id="cb13-74" class="hljs-ln-code"><a href="#cb13-74"></a></span>
<span id="cb13-75" class="hljs-ln-code"><a href="#cb13-75"></a><span class="co">// Create a buffer at every intersection points</span></span>
<span id="cb13-76" class="hljs-ln-code"><a href="#cb13-76"></a><span class="co">// using the id's you just created</span></span>
<span id="cb13-77" class="hljs-ln-code"><a href="#cb13-77"></a><span class="kw">var</span> bufferedPoints <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(ids<span class="op">.</span><span class="fu">map</span>(bufferAndSetID))<span class="op">;</span></span>
<span id="cb13-78" class="hljs-ln-code"><a href="#cb13-78"></a></span>
<span id="cb13-79" class="hljs-ln-code"><a href="#cb13-79"></a><span class="co">// Center the map on the continental USA</span></span>
<span id="cb13-80" class="hljs-ln-code"><a href="#cb13-80"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">setCenter</span>(<span class="op">-</span><span class="fl">98.5833</span><span class="op">,</span> <span class="fl">39.8333</span><span class="op">,</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb13-81" class="hljs-ln-code"><a href="#cb13-81"></a></span>
<span id="cb13-82" class="hljs-ln-code"><a href="#cb13-82"></a><span class="co">// Display the filtered FeatureCollection</span></span>
<span id="cb13-83" class="hljs-ln-code"><a href="#cb13-83"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(interstates<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">'green'</span>}<span class="op">,</span> <span class="st">'Interstates'</span>)<span class="op">;</span></span>
<span id="cb13-84" class="hljs-ln-code"><a href="#cb13-84"></a></span>
<span id="cb13-85" class="hljs-ln-code"><a href="#cb13-85"></a><span class="co">// Set visualization parameters</span></span>
<span id="cb13-86" class="hljs-ln-code"><a href="#cb13-86"></a><span class="kw">var</span> streamsVis <span class="op">=</span> {</span>
<span id="cb13-87" class="hljs-ln-code"><a href="#cb13-87"></a>  <span class="dt">color</span><span class="op">:</span> <span class="st">'blue'</span><span class="op">,</span></span>
<span id="cb13-88" class="hljs-ln-code"><a href="#cb13-88"></a>  <span class="dt">width</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb13-89" class="hljs-ln-code"><a href="#cb13-89"></a>}<span class="op">;</span></span>
<span id="cb13-90" class="hljs-ln-code"><a href="#cb13-90"></a></span>
<span id="cb13-91" class="hljs-ln-code"><a href="#cb13-91"></a><span class="co">// Add the filtered streams to the map</span></span>
<span id="cb13-92" class="hljs-ln-code"><a href="#cb13-92"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(filteredStreams<span class="op">,</span> streamsVis<span class="op">,</span> <span class="st">'Filtered Streams'</span>)<span class="op">;</span></span>
<span id="cb13-93" class="hljs-ln-code"><a href="#cb13-93"></a></span>
<span id="cb13-94" class="hljs-ln-code"><a href="#cb13-94"></a><span class="co">// Add the filtered intersection points to the map</span></span>
<span id="cb13-95" class="hljs-ln-code"><a href="#cb13-95"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(</span>
<span id="cb13-96" class="hljs-ln-code"><a href="#cb13-96"></a>             intersectionPoints<span class="op">,</span></span>
<span id="cb13-97" class="hljs-ln-code"><a href="#cb13-97"></a>             {<span class="dt">color</span><span class="op">:</span> <span class="st">'yellow'</span><span class="op">,</span><span class="dt">pointSize</span><span class="op">:</span> <span class="dv">10</span>}<span class="op">,</span></span>
<span id="cb13-98" class="hljs-ln-code"><a href="#cb13-98"></a>             <span class="st">'Filtered Intersection Points'</span></span>
<span id="cb13-99" class="hljs-ln-code"><a href="#cb13-99"></a>             )<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="sampling-population-densities-2" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Sampling population densities</h2>
<div class="sourceCode" id="cb14" data-code-line-numbers="79-86"><pre class="sourceCode numberSource javascript number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><span id="cb14-1" class="hljs-ln-code"><a href="#cb14-1"></a><span class="co">// Load road data from US census bureau </span></span>
<span id="cb14-2" class="hljs-ln-code"><a href="#cb14-2"></a><span class="kw">var</span> roads <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"TIGER/2016/Roads"</span>)<span class="op">;</span></span>
<span id="cb14-3" class="hljs-ln-code"><a href="#cb14-3"></a></span>
<span id="cb14-4" class="hljs-ln-code"><a href="#cb14-4"></a><span class="co">// Load the WWF HydroSHEDS Free Flowing Rivers Network v1 dataset</span></span>
<span id="cb14-5" class="hljs-ln-code"><a href="#cb14-5"></a><span class="kw">var</span> hydrosheds <span class="op">=</span></span>
<span id="cb14-6" class="hljs-ln-code"><a href="#cb14-6"></a>ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"WWF/HydroSHEDS/v1/FreeFlowingRivers"</span>)<span class="op">;</span></span>
<span id="cb14-7" class="hljs-ln-code"><a href="#cb14-7"></a></span>
<span id="cb14-8" class="hljs-ln-code"><a href="#cb14-8"></a><span class="co">// Load the population density data</span></span>
<span id="cb14-9" class="hljs-ln-code"><a href="#cb14-9"></a><span class="kw">var</span> popDens <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">"CIESIN/GPWv411/GPW_Population_Density"</span>)<span class="op">;</span></span>
<span id="cb14-10" class="hljs-ln-code"><a href="#cb14-10"></a></span>
<span id="cb14-11" class="hljs-ln-code"><a href="#cb14-11"></a><span class="co">// Select just interstates using the MTFCC code</span></span>
<span id="cb14-12" class="hljs-ln-code"><a href="#cb14-12"></a><span class="kw">var</span> interstates <span class="op">=</span> roads<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'mtfcc'</span><span class="op">,</span> <span class="st">'S1100'</span>))<span class="op">;</span></span>
<span id="cb14-13" class="hljs-ln-code"><a href="#cb14-13"></a></span>
<span id="cb14-14" class="hljs-ln-code"><a href="#cb14-14"></a><span class="co">// Filter out streams with an order less than 4</span></span>
<span id="cb14-15" class="hljs-ln-code"><a href="#cb14-15"></a><span class="kw">var</span> filteredStreams <span class="op">=</span> </span>
<span id="cb14-16" class="hljs-ln-code"><a href="#cb14-16"></a>      hydrosheds<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lte</span>(<span class="st">'RIV_ORD'</span><span class="op">,</span> <span class="dv">4</span>))</span>
<span id="cb14-17" class="hljs-ln-code"><a href="#cb14-17"></a>                <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'COUNTRY'</span><span class="op">,</span><span class="st">'United States'</span>))<span class="op">;</span></span>
<span id="cb14-18" class="hljs-ln-code"><a href="#cb14-18"></a></span>
<span id="cb14-19" class="hljs-ln-code"><a href="#cb14-19"></a><span class="co">//Take the 1st population density map within the given date arange</span></span>
<span id="cb14-20" class="hljs-ln-code"><a href="#cb14-20"></a><span class="kw">var</span> popDensYear <span class="op">=</span> popDens<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">'2010-01-01'</span><span class="op">,</span> <span class="st">'2019-12-31'</span>))<span class="op">.</span><span class="fu">first</span>()<span class="op">;</span></span>
<span id="cb14-21" class="hljs-ln-code"><a href="#cb14-21"></a></span>
<span id="cb14-22" class="hljs-ln-code"><a href="#cb14-22"></a><span class="co">// Perform a spatial join between filteredStreams</span></span>
<span id="cb14-23" class="hljs-ln-code"><a href="#cb14-23"></a><span class="co">// and interstates FeatureCollections</span></span>
<span id="cb14-24" class="hljs-ln-code"><a href="#cb14-24"></a><span class="kw">var</span> join <span class="op">=</span> ee<span class="op">.</span><span class="at">Join</span><span class="op">.</span><span class="fu">simple</span>()<span class="op">;</span></span>
<span id="cb14-25" class="hljs-ln-code"><a href="#cb14-25"></a><span class="kw">var</span> filter <span class="op">=</span> ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">intersects</span>({</span>
<span id="cb14-26" class="hljs-ln-code"><a href="#cb14-26"></a>  <span class="dt">leftField</span><span class="op">:</span> <span class="st">'.geo'</span><span class="op">,</span></span>
<span id="cb14-27" class="hljs-ln-code"><a href="#cb14-27"></a>  <span class="dt">rightField</span><span class="op">:</span> <span class="st">'.geo'</span></span>
<span id="cb14-28" class="hljs-ln-code"><a href="#cb14-28"></a>})<span class="op">;</span></span>
<span id="cb14-29" class="hljs-ln-code"><a href="#cb14-29"></a></span>
<span id="cb14-30" class="hljs-ln-code"><a href="#cb14-30"></a><span class="kw">var</span> intersectionLines <span class="op">=</span> join<span class="op">.</span><span class="fu">apply</span>(</span>
<span id="cb14-31" class="hljs-ln-code"><a href="#cb14-31"></a>                              filteredStreams<span class="op">,</span> </span>
<span id="cb14-32" class="hljs-ln-code"><a href="#cb14-32"></a>                              interstates<span class="op">,</span></span>
<span id="cb14-33" class="hljs-ln-code"><a href="#cb14-33"></a>                              filter)<span class="op">;</span></span>
<span id="cb14-34" class="hljs-ln-code"><a href="#cb14-34"></a></span>
<span id="cb14-35" class="hljs-ln-code"><a href="#cb14-35"></a><span class="co">// Sort by a random number and select the first N features</span></span>
<span id="cb14-36" class="hljs-ln-code"><a href="#cb14-36"></a><span class="kw">var</span> selectedLines <span class="op">=</span> intersectionLines<span class="op">.</span><span class="fu">sort</span>(<span class="st">'random'</span>)<span class="op">.</span><span class="fu">limit</span>(<span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb14-37" class="hljs-ln-code"><a href="#cb14-37"></a></span>
<span id="cb14-38" class="hljs-ln-code"><a href="#cb14-38"></a><span class="co">// Function to convert line geometry to a point </span></span>
<span id="cb14-39" class="hljs-ln-code"><a href="#cb14-39"></a><span class="kw">var</span> lineToPoint <span class="op">=</span> <span class="kw">function</span>(feature) {</span>
<span id="cb14-40" class="hljs-ln-code"><a href="#cb14-40"></a>  <span class="co">// Get the geometry</span></span>
<span id="cb14-41" class="hljs-ln-code"><a href="#cb14-41"></a>  <span class="kw">var</span> geom <span class="op">=</span> feature<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb14-42" class="hljs-ln-code"><a href="#cb14-42"></a>  <span class="co">// Get the centroid of the geometry</span></span>
<span id="cb14-43" class="hljs-ln-code"><a href="#cb14-43"></a>  <span class="kw">var</span> centroid <span class="op">=</span> geom<span class="op">.</span><span class="fu">centroid</span>()<span class="op">;</span></span>
<span id="cb14-44" class="hljs-ln-code"><a href="#cb14-44"></a>  <span class="co">// Create a new point feature</span></span>
<span id="cb14-45" class="hljs-ln-code"><a href="#cb14-45"></a>  <span class="kw">var</span> pointFeature <span class="op">=</span> ee<span class="op">.</span><span class="fu">Feature</span>(centroid<span class="op">,</span> feature<span class="op">.</span><span class="fu">toDictionary</span>())<span class="op">;</span></span>
<span id="cb14-46" class="hljs-ln-code"><a href="#cb14-46"></a>  <span class="cf">return</span> pointFeature<span class="op">;</span></span>
<span id="cb14-47" class="hljs-ln-code"><a href="#cb14-47"></a>}<span class="op">;</span></span>
<span id="cb14-48" class="hljs-ln-code"><a href="#cb14-48"></a></span>
<span id="cb14-49" class="hljs-ln-code"><a href="#cb14-49"></a><span class="co">// Apply the lineToPoint function to each element</span></span>
<span id="cb14-50" class="hljs-ln-code"><a href="#cb14-50"></a><span class="co">// in intersectionPoints</span></span>
<span id="cb14-51" class="hljs-ln-code"><a href="#cb14-51"></a><span class="kw">var</span> intersectionPoints <span class="op">=</span> selectedLines<span class="op">.</span><span class="fu">map</span>(lineToPoint)<span class="op">;</span></span>
<span id="cb14-52" class="hljs-ln-code"><a href="#cb14-52"></a></span>
<span id="cb14-53" class="hljs-ln-code"><a href="#cb14-53"></a><span class="co">// Convert the intersectionPoints FeatureCollection to a List</span></span>
<span id="cb14-54" class="hljs-ln-code"><a href="#cb14-54"></a><span class="kw">var</span> pointsList <span class="op">=</span> intersectionPoints</span>
<span id="cb14-55" class="hljs-ln-code"><a href="#cb14-55"></a>                              <span class="op">.</span><span class="fu">toList</span>(intersectionPoints<span class="op">.</span><span class="fu">size</span>())<span class="op">;</span></span>
<span id="cb14-56" class="hljs-ln-code"><a href="#cb14-56"></a></span>
<span id="cb14-57" class="hljs-ln-code"><a href="#cb14-57"></a><span class="co">// Function to buffer a point and set an ID</span></span>
<span id="cb14-58" class="hljs-ln-code"><a href="#cb14-58"></a><span class="kw">var</span> bufferAndSetID <span class="op">=</span> <span class="kw">function</span>(index) {</span>
<span id="cb14-59" class="hljs-ln-code"><a href="#cb14-59"></a>  <span class="co">// Get the point</span></span>
<span id="cb14-60" class="hljs-ln-code"><a href="#cb14-60"></a>  <span class="kw">var</span> point <span class="op">=</span> ee<span class="op">.</span><span class="fu">Feature</span>(pointsList<span class="op">.</span><span class="fu">get</span>(index))<span class="op">;</span></span>
<span id="cb14-61" class="hljs-ln-code"><a href="#cb14-61"></a>  <span class="co">// Buffer the point</span></span>
<span id="cb14-62" class="hljs-ln-code"><a href="#cb14-62"></a>  <span class="kw">var</span> bufferedPoint <span class="op">=</span> point<span class="op">.</span><span class="fu">buffer</span>(<span class="dv">10000</span>)<span class="op">;</span></span>
<span id="cb14-63" class="hljs-ln-code"><a href="#cb14-63"></a>  <span class="co">// Set the ID</span></span>
<span id="cb14-64" class="hljs-ln-code"><a href="#cb14-64"></a>  <span class="kw">var</span> bufferedPointWithID <span class="op">=</span> bufferedPoint<span class="op">.</span><span class="fu">set</span>(<span class="st">'ID'</span><span class="op">,</span> index)<span class="op">;</span></span>
<span id="cb14-65" class="hljs-ln-code"><a href="#cb14-65"></a>  <span class="co">// Return the buffered point with ID</span></span>
<span id="cb14-66" class="hljs-ln-code"><a href="#cb14-66"></a>  <span class="cf">return</span> bufferedPointWithID<span class="op">;</span></span>
<span id="cb14-67" class="hljs-ln-code"><a href="#cb14-67"></a>}<span class="op">;</span></span>
<span id="cb14-68" class="hljs-ln-code"><a href="#cb14-68"></a></span>
<span id="cb14-69" class="hljs-ln-code"><a href="#cb14-69"></a><span class="co">// Create a sequence of numbers to use as IDs</span></span>
<span id="cb14-70" class="hljs-ln-code"><a href="#cb14-70"></a><span class="kw">var</span> ids <span class="op">=</span> ee<span class="op">.</span><span class="at">List</span><span class="op">.</span><span class="fu">sequence</span>(</span>
<span id="cb14-71" class="hljs-ln-code"><a href="#cb14-71"></a>                           <span class="dv">0</span><span class="op">,</span></span>
<span id="cb14-72" class="hljs-ln-code"><a href="#cb14-72"></a>                           intersectionPoints<span class="op">.</span><span class="fu">size</span>()<span class="op">.</span><span class="fu">subtract</span>(<span class="dv">1</span>)</span>
<span id="cb14-73" class="hljs-ln-code"><a href="#cb14-73"></a>                          )<span class="op">;</span></span>
<span id="cb14-74" class="hljs-ln-code"><a href="#cb14-74"></a></span>
<span id="cb14-75" class="hljs-ln-code"><a href="#cb14-75"></a><span class="co">// Create a buffer at every intersection points</span></span>
<span id="cb14-76" class="hljs-ln-code"><a href="#cb14-76"></a><span class="co">// using the id's you just created</span></span>
<span id="cb14-77" class="hljs-ln-code"><a href="#cb14-77"></a><span class="kw">var</span> bufferedPoints <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(ids<span class="op">.</span><span class="fu">map</span>(bufferAndSetID))<span class="op">;</span></span>
<span id="cb14-78" class="hljs-ln-code"><a href="#cb14-78"></a></span>
<span id="cb14-79" class="hljs-ln-code"><a href="#cb14-79"></a><span class="co">// Merge the buffered geometries</span></span>
<span id="cb14-80" class="hljs-ln-code"><a href="#cb14-80"></a><span class="kw">var</span> bufferedGeometries <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span></span>
<span id="cb14-81" class="hljs-ln-code"><a href="#cb14-81"></a>                           <span class="op">.</span><span class="fu">MultiPolygon</span>(bufferedPoints</span>
<span id="cb14-82" class="hljs-ln-code"><a href="#cb14-82"></a>                                          <span class="op">.</span><span class="fu">geometry</span>()</span>
<span id="cb14-83" class="hljs-ln-code"><a href="#cb14-83"></a>                                          <span class="op">.</span><span class="fu">coordinates</span>())<span class="op">;</span></span>
<span id="cb14-84" class="hljs-ln-code"><a href="#cb14-84"></a></span>
<span id="cb14-85" class="hljs-ln-code"><a href="#cb14-85"></a><span class="co">// Clip the population density image to the buffered geometries</span></span>
<span id="cb14-86" class="hljs-ln-code"><a href="#cb14-86"></a><span class="kw">var</span> popDensYearBuffered <span class="op">=</span> popDensYear<span class="op">.</span><span class="fu">clip</span>(bufferedGeometries)<span class="op">;</span></span>
<span id="cb14-87" class="hljs-ln-code"><a href="#cb14-87"></a></span>
<span id="cb14-88" class="hljs-ln-code"><a href="#cb14-88"></a><span class="co">// Center the map on the continental USA</span></span>
<span id="cb14-89" class="hljs-ln-code"><a href="#cb14-89"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">setCenter</span>(<span class="op">-</span><span class="fl">98.5833</span><span class="op">,</span> <span class="fl">39.8333</span><span class="op">,</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb14-90" class="hljs-ln-code"><a href="#cb14-90"></a></span>
<span id="cb14-91" class="hljs-ln-code"><a href="#cb14-91"></a><span class="co">// Display the filtered FeatureCollection</span></span>
<span id="cb14-92" class="hljs-ln-code"><a href="#cb14-92"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(interstates<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">'green'</span>}<span class="op">,</span> <span class="st">'Interstates'</span>)<span class="op">;</span></span>
<span id="cb14-93" class="hljs-ln-code"><a href="#cb14-93"></a></span>
<span id="cb14-94" class="hljs-ln-code"><a href="#cb14-94"></a><span class="co">// Set visualization parameters</span></span>
<span id="cb14-95" class="hljs-ln-code"><a href="#cb14-95"></a><span class="kw">var</span> streamsVis <span class="op">=</span> {</span>
<span id="cb14-96" class="hljs-ln-code"><a href="#cb14-96"></a>  <span class="dt">color</span><span class="op">:</span> <span class="st">'blue'</span><span class="op">,</span></span>
<span id="cb14-97" class="hljs-ln-code"><a href="#cb14-97"></a>  <span class="dt">width</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb14-98" class="hljs-ln-code"><a href="#cb14-98"></a>}<span class="op">;</span></span>
<span id="cb14-99" class="hljs-ln-code"><a href="#cb14-99"></a></span>
<span id="cb14-100" class="hljs-ln-code"><a href="#cb14-100"></a><span class="co">// Add the filtered streams to the map</span></span>
<span id="cb14-101" class="hljs-ln-code"><a href="#cb14-101"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(filteredStreams<span class="op">,</span> streamsVis<span class="op">,</span> <span class="st">'Filtered Streams'</span>)<span class="op">;</span></span>
<span id="cb14-102" class="hljs-ln-code"><a href="#cb14-102"></a></span>
<span id="cb14-103" class="hljs-ln-code"><a href="#cb14-103"></a><span class="co">// Add the filtered intersection points to the map</span></span>
<span id="cb14-104" class="hljs-ln-code"><a href="#cb14-104"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(intersectionPoints<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">'yellow'</span><span class="op">,</span><span class="dt">pointSize</span><span class="op">:</span> <span class="dv">10</span>}<span class="op">,</span> <span class="st">'Filtered Intersection Points'</span>)<span class="op">;</span></span>
<span id="cb14-105" class="hljs-ln-code"><a href="#cb14-105"></a></span>
<span id="cb14-106" class="hljs-ln-code"><a href="#cb14-106"></a><span class="co">// Add the filtered intersection points to the map</span></span>
<span id="cb14-107" class="hljs-ln-code"><a href="#cb14-107"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(</span>
<span id="cb14-108" class="hljs-ln-code"><a href="#cb14-108"></a>             intersectionPoints<span class="op">,</span></span>
<span id="cb14-109" class="hljs-ln-code"><a href="#cb14-109"></a>             {<span class="dt">color</span><span class="op">:</span> <span class="st">'yellow'</span><span class="op">,</span><span class="dt">pointSize</span><span class="op">:</span> <span class="dv">10</span>}<span class="op">,</span></span>
<span id="cb14-110" class="hljs-ln-code"><a href="#cb14-110"></a>             <span class="st">'Filtered Intersection Points'</span></span>
<span id="cb14-111" class="hljs-ln-code"><a href="#cb14-111"></a>             )<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="sampling-population-densities-3" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Sampling population densities</h2>
<div class="sourceCode" id="cb15" data-code-line-numbers="88-105"><pre class="sourceCode numberSource javascript number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><span id="cb15-1" class="hljs-ln-code"><a href="#cb15-1"></a><span class="co">// Load road data from US census bureau </span></span>
<span id="cb15-2" class="hljs-ln-code"><a href="#cb15-2"></a><span class="kw">var</span> roads <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"TIGER/2016/Roads"</span>)<span class="op">;</span></span>
<span id="cb15-3" class="hljs-ln-code"><a href="#cb15-3"></a></span>
<span id="cb15-4" class="hljs-ln-code"><a href="#cb15-4"></a><span class="co">// Load the WWF HydroSHEDS Free Flowing Rivers Network v1 dataset</span></span>
<span id="cb15-5" class="hljs-ln-code"><a href="#cb15-5"></a><span class="kw">var</span> hydrosheds <span class="op">=</span></span>
<span id="cb15-6" class="hljs-ln-code"><a href="#cb15-6"></a>ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"WWF/HydroSHEDS/v1/FreeFlowingRivers"</span>)<span class="op">;</span></span>
<span id="cb15-7" class="hljs-ln-code"><a href="#cb15-7"></a></span>
<span id="cb15-8" class="hljs-ln-code"><a href="#cb15-8"></a><span class="co">// Load the population density data</span></span>
<span id="cb15-9" class="hljs-ln-code"><a href="#cb15-9"></a><span class="kw">var</span> popDens <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">"CIESIN/GPWv411/GPW_Population_Density"</span>)<span class="op">;</span></span>
<span id="cb15-10" class="hljs-ln-code"><a href="#cb15-10"></a></span>
<span id="cb15-11" class="hljs-ln-code"><a href="#cb15-11"></a><span class="co">// Select just interstates using the MTFCC code</span></span>
<span id="cb15-12" class="hljs-ln-code"><a href="#cb15-12"></a><span class="kw">var</span> interstates <span class="op">=</span> roads<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'mtfcc'</span><span class="op">,</span> <span class="st">'S1100'</span>))<span class="op">;</span></span>
<span id="cb15-13" class="hljs-ln-code"><a href="#cb15-13"></a></span>
<span id="cb15-14" class="hljs-ln-code"><a href="#cb15-14"></a><span class="co">// Filter out streams with an order less than 4</span></span>
<span id="cb15-15" class="hljs-ln-code"><a href="#cb15-15"></a><span class="kw">var</span> filteredStreams <span class="op">=</span> </span>
<span id="cb15-16" class="hljs-ln-code"><a href="#cb15-16"></a>      hydrosheds<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lte</span>(<span class="st">'RIV_ORD'</span><span class="op">,</span> <span class="dv">4</span>))</span>
<span id="cb15-17" class="hljs-ln-code"><a href="#cb15-17"></a>                <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'COUNTRY'</span><span class="op">,</span><span class="st">'United States'</span>))<span class="op">;</span></span>
<span id="cb15-18" class="hljs-ln-code"><a href="#cb15-18"></a></span>
<span id="cb15-19" class="hljs-ln-code"><a href="#cb15-19"></a><span class="co">//Take the 1st population density map within the given date arange</span></span>
<span id="cb15-20" class="hljs-ln-code"><a href="#cb15-20"></a><span class="kw">var</span> popDensYear <span class="op">=</span> popDens<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">'2010-01-01'</span><span class="op">,</span> <span class="st">'2019-12-31'</span>))<span class="op">.</span><span class="fu">first</span>()<span class="op">;</span></span>
<span id="cb15-21" class="hljs-ln-code"><a href="#cb15-21"></a></span>
<span id="cb15-22" class="hljs-ln-code"><a href="#cb15-22"></a><span class="co">// Perform a spatial join between filteredStreams</span></span>
<span id="cb15-23" class="hljs-ln-code"><a href="#cb15-23"></a><span class="co">// and interstates FeatureCollections</span></span>
<span id="cb15-24" class="hljs-ln-code"><a href="#cb15-24"></a><span class="kw">var</span> join <span class="op">=</span> ee<span class="op">.</span><span class="at">Join</span><span class="op">.</span><span class="fu">simple</span>()<span class="op">;</span></span>
<span id="cb15-25" class="hljs-ln-code"><a href="#cb15-25"></a><span class="kw">var</span> filter <span class="op">=</span> ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">intersects</span>({</span>
<span id="cb15-26" class="hljs-ln-code"><a href="#cb15-26"></a>  <span class="dt">leftField</span><span class="op">:</span> <span class="st">'.geo'</span><span class="op">,</span></span>
<span id="cb15-27" class="hljs-ln-code"><a href="#cb15-27"></a>  <span class="dt">rightField</span><span class="op">:</span> <span class="st">'.geo'</span></span>
<span id="cb15-28" class="hljs-ln-code"><a href="#cb15-28"></a>})<span class="op">;</span></span>
<span id="cb15-29" class="hljs-ln-code"><a href="#cb15-29"></a></span>
<span id="cb15-30" class="hljs-ln-code"><a href="#cb15-30"></a><span class="kw">var</span> intersectionLines <span class="op">=</span> join<span class="op">.</span><span class="fu">apply</span>(</span>
<span id="cb15-31" class="hljs-ln-code"><a href="#cb15-31"></a>                              filteredStreams<span class="op">,</span> </span>
<span id="cb15-32" class="hljs-ln-code"><a href="#cb15-32"></a>                              interstates<span class="op">,</span></span>
<span id="cb15-33" class="hljs-ln-code"><a href="#cb15-33"></a>                              filter)<span class="op">;</span></span>
<span id="cb15-34" class="hljs-ln-code"><a href="#cb15-34"></a></span>
<span id="cb15-35" class="hljs-ln-code"><a href="#cb15-35"></a><span class="co">// Sort by a random number and select the first N features</span></span>
<span id="cb15-36" class="hljs-ln-code"><a href="#cb15-36"></a><span class="kw">var</span> selectedLines <span class="op">=</span> intersectionLines<span class="op">.</span><span class="fu">sort</span>(<span class="st">'random'</span>)<span class="op">.</span><span class="fu">limit</span>(<span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb15-37" class="hljs-ln-code"><a href="#cb15-37"></a></span>
<span id="cb15-38" class="hljs-ln-code"><a href="#cb15-38"></a><span class="co">// Function to convert line geometry to a point </span></span>
<span id="cb15-39" class="hljs-ln-code"><a href="#cb15-39"></a><span class="kw">var</span> lineToPoint <span class="op">=</span> <span class="kw">function</span>(feature) {</span>
<span id="cb15-40" class="hljs-ln-code"><a href="#cb15-40"></a>  <span class="co">// Get the geometry</span></span>
<span id="cb15-41" class="hljs-ln-code"><a href="#cb15-41"></a>  <span class="kw">var</span> geom <span class="op">=</span> feature<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb15-42" class="hljs-ln-code"><a href="#cb15-42"></a>  <span class="co">// Get the centroid of the geometry</span></span>
<span id="cb15-43" class="hljs-ln-code"><a href="#cb15-43"></a>  <span class="kw">var</span> centroid <span class="op">=</span> geom<span class="op">.</span><span class="fu">centroid</span>()<span class="op">;</span></span>
<span id="cb15-44" class="hljs-ln-code"><a href="#cb15-44"></a>  <span class="co">// Create a new point feature</span></span>
<span id="cb15-45" class="hljs-ln-code"><a href="#cb15-45"></a>  <span class="kw">var</span> pointFeature <span class="op">=</span> ee<span class="op">.</span><span class="fu">Feature</span>(centroid<span class="op">,</span> feature<span class="op">.</span><span class="fu">toDictionary</span>())<span class="op">;</span></span>
<span id="cb15-46" class="hljs-ln-code"><a href="#cb15-46"></a>  <span class="cf">return</span> pointFeature<span class="op">;</span></span>
<span id="cb15-47" class="hljs-ln-code"><a href="#cb15-47"></a>}<span class="op">;</span></span>
<span id="cb15-48" class="hljs-ln-code"><a href="#cb15-48"></a></span>
<span id="cb15-49" class="hljs-ln-code"><a href="#cb15-49"></a><span class="co">// Apply the lineToPoint function to each element</span></span>
<span id="cb15-50" class="hljs-ln-code"><a href="#cb15-50"></a><span class="co">// in intersectionPoints</span></span>
<span id="cb15-51" class="hljs-ln-code"><a href="#cb15-51"></a><span class="kw">var</span> intersectionPoints <span class="op">=</span> selectedLines<span class="op">.</span><span class="fu">map</span>(lineToPoint)<span class="op">;</span></span>
<span id="cb15-52" class="hljs-ln-code"><a href="#cb15-52"></a></span>
<span id="cb15-53" class="hljs-ln-code"><a href="#cb15-53"></a><span class="co">// Convert the intersectionPoints FeatureCollection to a List</span></span>
<span id="cb15-54" class="hljs-ln-code"><a href="#cb15-54"></a><span class="kw">var</span> pointsList <span class="op">=</span> intersectionPoints</span>
<span id="cb15-55" class="hljs-ln-code"><a href="#cb15-55"></a>                              <span class="op">.</span><span class="fu">toList</span>(intersectionPoints<span class="op">.</span><span class="fu">size</span>())<span class="op">;</span></span>
<span id="cb15-56" class="hljs-ln-code"><a href="#cb15-56"></a></span>
<span id="cb15-57" class="hljs-ln-code"><a href="#cb15-57"></a><span class="co">// Function to buffer a point and set an ID</span></span>
<span id="cb15-58" class="hljs-ln-code"><a href="#cb15-58"></a><span class="kw">var</span> bufferAndSetID <span class="op">=</span> <span class="kw">function</span>(index) {</span>
<span id="cb15-59" class="hljs-ln-code"><a href="#cb15-59"></a>  <span class="co">// Get the point</span></span>
<span id="cb15-60" class="hljs-ln-code"><a href="#cb15-60"></a>  <span class="kw">var</span> point <span class="op">=</span> ee<span class="op">.</span><span class="fu">Feature</span>(pointsList<span class="op">.</span><span class="fu">get</span>(index))<span class="op">;</span></span>
<span id="cb15-61" class="hljs-ln-code"><a href="#cb15-61"></a>  <span class="co">// Buffer the point</span></span>
<span id="cb15-62" class="hljs-ln-code"><a href="#cb15-62"></a>  <span class="kw">var</span> bufferedPoint <span class="op">=</span> point<span class="op">.</span><span class="fu">buffer</span>(<span class="dv">10000</span>)<span class="op">;</span></span>
<span id="cb15-63" class="hljs-ln-code"><a href="#cb15-63"></a>  <span class="co">// Set the ID</span></span>
<span id="cb15-64" class="hljs-ln-code"><a href="#cb15-64"></a>  <span class="kw">var</span> bufferedPointWithID <span class="op">=</span> bufferedPoint<span class="op">.</span><span class="fu">set</span>(<span class="st">'ID'</span><span class="op">,</span> index)<span class="op">;</span></span>
<span id="cb15-65" class="hljs-ln-code"><a href="#cb15-65"></a>  <span class="co">// Return the buffered point with ID</span></span>
<span id="cb15-66" class="hljs-ln-code"><a href="#cb15-66"></a>  <span class="cf">return</span> bufferedPointWithID<span class="op">;</span></span>
<span id="cb15-67" class="hljs-ln-code"><a href="#cb15-67"></a>}<span class="op">;</span></span>
<span id="cb15-68" class="hljs-ln-code"><a href="#cb15-68"></a></span>
<span id="cb15-69" class="hljs-ln-code"><a href="#cb15-69"></a><span class="co">// Create a sequence of numbers to use as IDs</span></span>
<span id="cb15-70" class="hljs-ln-code"><a href="#cb15-70"></a><span class="kw">var</span> ids <span class="op">=</span> ee<span class="op">.</span><span class="at">List</span><span class="op">.</span><span class="fu">sequence</span>(</span>
<span id="cb15-71" class="hljs-ln-code"><a href="#cb15-71"></a>                           <span class="dv">0</span><span class="op">,</span></span>
<span id="cb15-72" class="hljs-ln-code"><a href="#cb15-72"></a>                           intersectionPoints<span class="op">.</span><span class="fu">size</span>()<span class="op">.</span><span class="fu">subtract</span>(<span class="dv">1</span>)</span>
<span id="cb15-73" class="hljs-ln-code"><a href="#cb15-73"></a>                          )<span class="op">;</span></span>
<span id="cb15-74" class="hljs-ln-code"><a href="#cb15-74"></a></span>
<span id="cb15-75" class="hljs-ln-code"><a href="#cb15-75"></a><span class="co">// Create a buffer at every intersection points</span></span>
<span id="cb15-76" class="hljs-ln-code"><a href="#cb15-76"></a><span class="co">// using the id's you just created</span></span>
<span id="cb15-77" class="hljs-ln-code"><a href="#cb15-77"></a><span class="kw">var</span> bufferedPoints <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(ids<span class="op">.</span><span class="fu">map</span>(bufferAndSetID))<span class="op">;</span></span>
<span id="cb15-78" class="hljs-ln-code"><a href="#cb15-78"></a></span>
<span id="cb15-79" class="hljs-ln-code"><a href="#cb15-79"></a><span class="co">// Merge the buffered geometries</span></span>
<span id="cb15-80" class="hljs-ln-code"><a href="#cb15-80"></a><span class="kw">var</span> bufferedGeometries <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span></span>
<span id="cb15-81" class="hljs-ln-code"><a href="#cb15-81"></a>                           <span class="op">.</span><span class="fu">MultiPolygon</span>(bufferedPoints</span>
<span id="cb15-82" class="hljs-ln-code"><a href="#cb15-82"></a>                                          <span class="op">.</span><span class="fu">geometry</span>()</span>
<span id="cb15-83" class="hljs-ln-code"><a href="#cb15-83"></a>                                          <span class="op">.</span><span class="fu">coordinates</span>())<span class="op">;</span></span>
<span id="cb15-84" class="hljs-ln-code"><a href="#cb15-84"></a></span>
<span id="cb15-85" class="hljs-ln-code"><a href="#cb15-85"></a><span class="co">// Clip the population density image to the buffered geometries</span></span>
<span id="cb15-86" class="hljs-ln-code"><a href="#cb15-86"></a><span class="kw">var</span> popDensYearBuffered <span class="op">=</span> popDensYear<span class="op">.</span><span class="fu">clip</span>(bufferedGeometries)<span class="op">;</span></span>
<span id="cb15-87" class="hljs-ln-code"><a href="#cb15-87"></a></span>
<span id="cb15-88" class="hljs-ln-code"><a href="#cb15-88"></a><span class="co">// Function to sample random points within each buffered area</span></span>
<span id="cb15-89" class="hljs-ln-code"><a href="#cb15-89"></a><span class="kw">var</span> samplePoints <span class="op">=</span> <span class="kw">function</span> (feature) {</span>
<span id="cb15-90" class="hljs-ln-code"><a href="#cb15-90"></a>  <span class="kw">var</span> geometry <span class="op">=</span> feature<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb15-91" class="hljs-ln-code"><a href="#cb15-91"></a>  <span class="kw">var</span> randomPoints <span class="op">=</span> ee<span class="op">.</span><span class="at">FeatureCollection</span><span class="op">.</span><span class="fu">randomPoints</span>(geometry<span class="op">,</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb15-92" class="hljs-ln-code"><a href="#cb15-92"></a>  <span class="kw">var</span> sampledPoints <span class="op">=</span> popDensYearBuffered<span class="op">.</span><span class="fu">sampleRegions</span>({</span>
<span id="cb15-93" class="hljs-ln-code"><a href="#cb15-93"></a>    <span class="dt">collection</span><span class="op">:</span> randomPoints<span class="op">,</span></span>
<span id="cb15-94" class="hljs-ln-code"><a href="#cb15-94"></a>    <span class="dt">scale</span><span class="op">:</span> <span class="dv">1000</span><span class="op">,</span></span>
<span id="cb15-95" class="hljs-ln-code"><a href="#cb15-95"></a>    <span class="dt">tileScale</span><span class="op">:</span> <span class="dv">16</span></span>
<span id="cb15-96" class="hljs-ln-code"><a href="#cb15-96"></a>  })</span>
<span id="cb15-97" class="hljs-ln-code"><a href="#cb15-97"></a>  <span class="co">// Add the buffered area ID to each sampled point</span></span>
<span id="cb15-98" class="hljs-ln-code"><a href="#cb15-98"></a>  sampledPoints <span class="op">=</span> sampledPoints<span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(point) {</span>
<span id="cb15-99" class="hljs-ln-code"><a href="#cb15-99"></a>    <span class="cf">return</span> point<span class="op">.</span><span class="fu">set</span>(<span class="st">'BufferedAreaID'</span><span class="op">,</span> feature<span class="op">.</span><span class="fu">get</span>(<span class="st">'ID'</span>))<span class="op">;</span></span>
<span id="cb15-100" class="hljs-ln-code"><a href="#cb15-100"></a>  })<span class="op">;</span></span>
<span id="cb15-101" class="hljs-ln-code"><a href="#cb15-101"></a>  <span class="cf">return</span> sampledPoints<span class="op">;</span></span>
<span id="cb15-102" class="hljs-ln-code"><a href="#cb15-102"></a>}<span class="op">;</span></span>
<span id="cb15-103" class="hljs-ln-code"><a href="#cb15-103"></a></span>
<span id="cb15-104" class="hljs-ln-code"><a href="#cb15-104"></a><span class="co">// Sample 10 random points within each buffered area</span></span>
<span id="cb15-105" class="hljs-ln-code"><a href="#cb15-105"></a><span class="kw">var</span> sampledPoints <span class="op">=</span> bufferedPoints<span class="op">.</span><span class="fu">map</span>(samplePoints)<span class="op">.</span><span class="fu">flatten</span>()<span class="op">;</span></span>
<span id="cb15-106" class="hljs-ln-code"><a href="#cb15-106"></a></span>
<span id="cb15-107" class="hljs-ln-code"><a href="#cb15-107"></a><span class="co">// Center the map on the continental USA</span></span>
<span id="cb15-108" class="hljs-ln-code"><a href="#cb15-108"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">setCenter</span>(<span class="op">-</span><span class="fl">98.5833</span><span class="op">,</span> <span class="fl">39.8333</span><span class="op">,</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb15-109" class="hljs-ln-code"><a href="#cb15-109"></a></span>
<span id="cb15-110" class="hljs-ln-code"><a href="#cb15-110"></a><span class="co">// Display the filtered FeatureCollection</span></span>
<span id="cb15-111" class="hljs-ln-code"><a href="#cb15-111"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(interstates<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">'green'</span>}<span class="op">,</span> <span class="st">'Interstates'</span>)<span class="op">;</span></span>
<span id="cb15-112" class="hljs-ln-code"><a href="#cb15-112"></a></span>
<span id="cb15-113" class="hljs-ln-code"><a href="#cb15-113"></a><span class="co">// Set visualization parameters</span></span>
<span id="cb15-114" class="hljs-ln-code"><a href="#cb15-114"></a><span class="kw">var</span> streamsVis <span class="op">=</span> {</span>
<span id="cb15-115" class="hljs-ln-code"><a href="#cb15-115"></a>  <span class="dt">color</span><span class="op">:</span> <span class="st">'blue'</span><span class="op">,</span></span>
<span id="cb15-116" class="hljs-ln-code"><a href="#cb15-116"></a>  <span class="dt">width</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb15-117" class="hljs-ln-code"><a href="#cb15-117"></a>}<span class="op">;</span></span>
<span id="cb15-118" class="hljs-ln-code"><a href="#cb15-118"></a></span>
<span id="cb15-119" class="hljs-ln-code"><a href="#cb15-119"></a><span class="co">// Add the filtered streams to the map</span></span>
<span id="cb15-120" class="hljs-ln-code"><a href="#cb15-120"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(filteredStreams<span class="op">,</span> streamsVis<span class="op">,</span> <span class="st">'Filtered Streams'</span>)<span class="op">;</span></span>
<span id="cb15-121" class="hljs-ln-code"><a href="#cb15-121"></a></span>
<span id="cb15-122" class="hljs-ln-code"><a href="#cb15-122"></a><span class="co">// Add the filtered intersection points to the map</span></span>
<span id="cb15-123" class="hljs-ln-code"><a href="#cb15-123"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(intersectionPoints<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">'yellow'</span><span class="op">,</span><span class="dt">pointSize</span><span class="op">:</span> <span class="dv">10</span>}<span class="op">,</span> <span class="st">'Filtered Intersection Points'</span>)<span class="op">;</span></span>
<span id="cb15-124" class="hljs-ln-code"><a href="#cb15-124"></a></span>
<span id="cb15-125" class="hljs-ln-code"><a href="#cb15-125"></a><span class="co">// Add the filtered intersection points to the map</span></span>
<span id="cb15-126" class="hljs-ln-code"><a href="#cb15-126"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(</span>
<span id="cb15-127" class="hljs-ln-code"><a href="#cb15-127"></a>             intersectionPoints<span class="op">,</span></span>
<span id="cb15-128" class="hljs-ln-code"><a href="#cb15-128"></a>             {<span class="dt">color</span><span class="op">:</span> <span class="st">'yellow'</span><span class="op">,</span><span class="dt">pointSize</span><span class="op">:</span> <span class="dv">10</span>}<span class="op">,</span></span>
<span id="cb15-129" class="hljs-ln-code"><a href="#cb15-129"></a>             <span class="st">'Filtered Intersection Points'</span></span>
<span id="cb15-130" class="hljs-ln-code"><a href="#cb15-130"></a>             )<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="finding-mean-population-densities" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Finding mean population densities</h2>
<div class="sourceCode" id="cb16" data-code-line-numbers="107-118"><pre class="sourceCode numberSource javascript number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><span id="cb16-1" class="hljs-ln-code"><a href="#cb16-1"></a><span class="co">// Load road data from US census bureau </span></span>
<span id="cb16-2" class="hljs-ln-code"><a href="#cb16-2"></a><span class="kw">var</span> roads <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"TIGER/2016/Roads"</span>)<span class="op">;</span></span>
<span id="cb16-3" class="hljs-ln-code"><a href="#cb16-3"></a></span>
<span id="cb16-4" class="hljs-ln-code"><a href="#cb16-4"></a><span class="co">// Load the WWF HydroSHEDS Free Flowing Rivers Network v1 dataset</span></span>
<span id="cb16-5" class="hljs-ln-code"><a href="#cb16-5"></a><span class="kw">var</span> hydrosheds <span class="op">=</span></span>
<span id="cb16-6" class="hljs-ln-code"><a href="#cb16-6"></a>ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"WWF/HydroSHEDS/v1/FreeFlowingRivers"</span>)<span class="op">;</span></span>
<span id="cb16-7" class="hljs-ln-code"><a href="#cb16-7"></a></span>
<span id="cb16-8" class="hljs-ln-code"><a href="#cb16-8"></a><span class="co">// Load the population density data</span></span>
<span id="cb16-9" class="hljs-ln-code"><a href="#cb16-9"></a><span class="kw">var</span> popDens <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">"CIESIN/GPWv411/GPW_Population_Density"</span>)<span class="op">;</span></span>
<span id="cb16-10" class="hljs-ln-code"><a href="#cb16-10"></a></span>
<span id="cb16-11" class="hljs-ln-code"><a href="#cb16-11"></a><span class="co">// Select just interstates using the MTFCC code</span></span>
<span id="cb16-12" class="hljs-ln-code"><a href="#cb16-12"></a><span class="kw">var</span> interstates <span class="op">=</span> roads<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'mtfcc'</span><span class="op">,</span> <span class="st">'S1100'</span>))<span class="op">;</span></span>
<span id="cb16-13" class="hljs-ln-code"><a href="#cb16-13"></a></span>
<span id="cb16-14" class="hljs-ln-code"><a href="#cb16-14"></a><span class="co">// Filter out streams with an order less than 4</span></span>
<span id="cb16-15" class="hljs-ln-code"><a href="#cb16-15"></a><span class="kw">var</span> filteredStreams <span class="op">=</span> </span>
<span id="cb16-16" class="hljs-ln-code"><a href="#cb16-16"></a>      hydrosheds<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lte</span>(<span class="st">'RIV_ORD'</span><span class="op">,</span> <span class="dv">4</span>))</span>
<span id="cb16-17" class="hljs-ln-code"><a href="#cb16-17"></a>                <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'COUNTRY'</span><span class="op">,</span><span class="st">'United States'</span>))<span class="op">;</span></span>
<span id="cb16-18" class="hljs-ln-code"><a href="#cb16-18"></a></span>
<span id="cb16-19" class="hljs-ln-code"><a href="#cb16-19"></a><span class="co">//Take the 1st population density map within the given date arange</span></span>
<span id="cb16-20" class="hljs-ln-code"><a href="#cb16-20"></a><span class="kw">var</span> popDensYear <span class="op">=</span> popDens<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">'2010-01-01'</span><span class="op">,</span> <span class="st">'2019-12-31'</span>))<span class="op">.</span><span class="fu">first</span>()<span class="op">;</span></span>
<span id="cb16-21" class="hljs-ln-code"><a href="#cb16-21"></a></span>
<span id="cb16-22" class="hljs-ln-code"><a href="#cb16-22"></a><span class="co">// Perform a spatial join between filteredStreams</span></span>
<span id="cb16-23" class="hljs-ln-code"><a href="#cb16-23"></a><span class="co">// and interstates FeatureCollections</span></span>
<span id="cb16-24" class="hljs-ln-code"><a href="#cb16-24"></a><span class="kw">var</span> join <span class="op">=</span> ee<span class="op">.</span><span class="at">Join</span><span class="op">.</span><span class="fu">simple</span>()<span class="op">;</span></span>
<span id="cb16-25" class="hljs-ln-code"><a href="#cb16-25"></a><span class="kw">var</span> filter <span class="op">=</span> ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">intersects</span>({</span>
<span id="cb16-26" class="hljs-ln-code"><a href="#cb16-26"></a>  <span class="dt">leftField</span><span class="op">:</span> <span class="st">'.geo'</span><span class="op">,</span></span>
<span id="cb16-27" class="hljs-ln-code"><a href="#cb16-27"></a>  <span class="dt">rightField</span><span class="op">:</span> <span class="st">'.geo'</span></span>
<span id="cb16-28" class="hljs-ln-code"><a href="#cb16-28"></a>})<span class="op">;</span></span>
<span id="cb16-29" class="hljs-ln-code"><a href="#cb16-29"></a></span>
<span id="cb16-30" class="hljs-ln-code"><a href="#cb16-30"></a><span class="kw">var</span> intersectionLines <span class="op">=</span> join<span class="op">.</span><span class="fu">apply</span>(</span>
<span id="cb16-31" class="hljs-ln-code"><a href="#cb16-31"></a>                              filteredStreams<span class="op">,</span> </span>
<span id="cb16-32" class="hljs-ln-code"><a href="#cb16-32"></a>                              interstates<span class="op">,</span></span>
<span id="cb16-33" class="hljs-ln-code"><a href="#cb16-33"></a>                              filter)<span class="op">;</span></span>
<span id="cb16-34" class="hljs-ln-code"><a href="#cb16-34"></a></span>
<span id="cb16-35" class="hljs-ln-code"><a href="#cb16-35"></a><span class="co">// Sort by a random number and select the first N features</span></span>
<span id="cb16-36" class="hljs-ln-code"><a href="#cb16-36"></a><span class="kw">var</span> selectedLines <span class="op">=</span> intersectionLines<span class="op">.</span><span class="fu">sort</span>(<span class="st">'random'</span>)<span class="op">.</span><span class="fu">limit</span>(<span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb16-37" class="hljs-ln-code"><a href="#cb16-37"></a></span>
<span id="cb16-38" class="hljs-ln-code"><a href="#cb16-38"></a><span class="co">// Function to convert line geometry to a point </span></span>
<span id="cb16-39" class="hljs-ln-code"><a href="#cb16-39"></a><span class="kw">var</span> lineToPoint <span class="op">=</span> <span class="kw">function</span>(feature) {</span>
<span id="cb16-40" class="hljs-ln-code"><a href="#cb16-40"></a>  <span class="co">// Get the geometry</span></span>
<span id="cb16-41" class="hljs-ln-code"><a href="#cb16-41"></a>  <span class="kw">var</span> geom <span class="op">=</span> feature<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb16-42" class="hljs-ln-code"><a href="#cb16-42"></a>  <span class="co">// Get the centroid of the geometry</span></span>
<span id="cb16-43" class="hljs-ln-code"><a href="#cb16-43"></a>  <span class="kw">var</span> centroid <span class="op">=</span> geom<span class="op">.</span><span class="fu">centroid</span>()<span class="op">;</span></span>
<span id="cb16-44" class="hljs-ln-code"><a href="#cb16-44"></a>  <span class="co">// Create a new point feature</span></span>
<span id="cb16-45" class="hljs-ln-code"><a href="#cb16-45"></a>  <span class="kw">var</span> pointFeature <span class="op">=</span> ee<span class="op">.</span><span class="fu">Feature</span>(centroid<span class="op">,</span> feature<span class="op">.</span><span class="fu">toDictionary</span>())<span class="op">;</span></span>
<span id="cb16-46" class="hljs-ln-code"><a href="#cb16-46"></a>  <span class="cf">return</span> pointFeature<span class="op">;</span></span>
<span id="cb16-47" class="hljs-ln-code"><a href="#cb16-47"></a>}<span class="op">;</span></span>
<span id="cb16-48" class="hljs-ln-code"><a href="#cb16-48"></a></span>
<span id="cb16-49" class="hljs-ln-code"><a href="#cb16-49"></a><span class="co">// Apply the lineToPoint function to each element</span></span>
<span id="cb16-50" class="hljs-ln-code"><a href="#cb16-50"></a><span class="co">// in intersectionPoints</span></span>
<span id="cb16-51" class="hljs-ln-code"><a href="#cb16-51"></a><span class="kw">var</span> intersectionPoints <span class="op">=</span> selectedLines<span class="op">.</span><span class="fu">map</span>(lineToPoint)<span class="op">;</span></span>
<span id="cb16-52" class="hljs-ln-code"><a href="#cb16-52"></a></span>
<span id="cb16-53" class="hljs-ln-code"><a href="#cb16-53"></a><span class="co">// Convert the intersectionPoints FeatureCollection to a List</span></span>
<span id="cb16-54" class="hljs-ln-code"><a href="#cb16-54"></a><span class="kw">var</span> pointsList <span class="op">=</span> intersectionPoints</span>
<span id="cb16-55" class="hljs-ln-code"><a href="#cb16-55"></a>                              <span class="op">.</span><span class="fu">toList</span>(intersectionPoints<span class="op">.</span><span class="fu">size</span>())<span class="op">;</span></span>
<span id="cb16-56" class="hljs-ln-code"><a href="#cb16-56"></a></span>
<span id="cb16-57" class="hljs-ln-code"><a href="#cb16-57"></a><span class="co">// Function to buffer a point and set an ID</span></span>
<span id="cb16-58" class="hljs-ln-code"><a href="#cb16-58"></a><span class="kw">var</span> bufferAndSetID <span class="op">=</span> <span class="kw">function</span>(index) {</span>
<span id="cb16-59" class="hljs-ln-code"><a href="#cb16-59"></a>  <span class="co">// Get the point</span></span>
<span id="cb16-60" class="hljs-ln-code"><a href="#cb16-60"></a>  <span class="kw">var</span> point <span class="op">=</span> ee<span class="op">.</span><span class="fu">Feature</span>(pointsList<span class="op">.</span><span class="fu">get</span>(index))<span class="op">;</span></span>
<span id="cb16-61" class="hljs-ln-code"><a href="#cb16-61"></a>  <span class="co">// Buffer the point</span></span>
<span id="cb16-62" class="hljs-ln-code"><a href="#cb16-62"></a>  <span class="kw">var</span> bufferedPoint <span class="op">=</span> point<span class="op">.</span><span class="fu">buffer</span>(<span class="dv">10000</span>)<span class="op">;</span></span>
<span id="cb16-63" class="hljs-ln-code"><a href="#cb16-63"></a>  <span class="co">// Set the ID</span></span>
<span id="cb16-64" class="hljs-ln-code"><a href="#cb16-64"></a>  <span class="kw">var</span> bufferedPointWithID <span class="op">=</span> bufferedPoint<span class="op">.</span><span class="fu">set</span>(<span class="st">'ID'</span><span class="op">,</span> index)<span class="op">;</span></span>
<span id="cb16-65" class="hljs-ln-code"><a href="#cb16-65"></a>  <span class="co">// Return the buffered point with ID</span></span>
<span id="cb16-66" class="hljs-ln-code"><a href="#cb16-66"></a>  <span class="cf">return</span> bufferedPointWithID<span class="op">;</span></span>
<span id="cb16-67" class="hljs-ln-code"><a href="#cb16-67"></a>}<span class="op">;</span></span>
<span id="cb16-68" class="hljs-ln-code"><a href="#cb16-68"></a></span>
<span id="cb16-69" class="hljs-ln-code"><a href="#cb16-69"></a><span class="co">// Create a sequence of numbers to use as IDs</span></span>
<span id="cb16-70" class="hljs-ln-code"><a href="#cb16-70"></a><span class="kw">var</span> ids <span class="op">=</span> ee<span class="op">.</span><span class="at">List</span><span class="op">.</span><span class="fu">sequence</span>(</span>
<span id="cb16-71" class="hljs-ln-code"><a href="#cb16-71"></a>                           <span class="dv">0</span><span class="op">,</span></span>
<span id="cb16-72" class="hljs-ln-code"><a href="#cb16-72"></a>                           intersectionPoints<span class="op">.</span><span class="fu">size</span>()<span class="op">.</span><span class="fu">subtract</span>(<span class="dv">1</span>)</span>
<span id="cb16-73" class="hljs-ln-code"><a href="#cb16-73"></a>                          )<span class="op">;</span></span>
<span id="cb16-74" class="hljs-ln-code"><a href="#cb16-74"></a></span>
<span id="cb16-75" class="hljs-ln-code"><a href="#cb16-75"></a><span class="co">// Create a buffer at every intersection points</span></span>
<span id="cb16-76" class="hljs-ln-code"><a href="#cb16-76"></a><span class="co">// using the id's you just created</span></span>
<span id="cb16-77" class="hljs-ln-code"><a href="#cb16-77"></a><span class="kw">var</span> bufferedPoints <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(ids<span class="op">.</span><span class="fu">map</span>(bufferAndSetID))<span class="op">;</span></span>
<span id="cb16-78" class="hljs-ln-code"><a href="#cb16-78"></a></span>
<span id="cb16-79" class="hljs-ln-code"><a href="#cb16-79"></a><span class="co">// Merge the buffered geometries</span></span>
<span id="cb16-80" class="hljs-ln-code"><a href="#cb16-80"></a><span class="kw">var</span> bufferedGeometries <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span></span>
<span id="cb16-81" class="hljs-ln-code"><a href="#cb16-81"></a>                           <span class="op">.</span><span class="fu">MultiPolygon</span>(bufferedPoints</span>
<span id="cb16-82" class="hljs-ln-code"><a href="#cb16-82"></a>                                          <span class="op">.</span><span class="fu">geometry</span>()</span>
<span id="cb16-83" class="hljs-ln-code"><a href="#cb16-83"></a>                                          <span class="op">.</span><span class="fu">coordinates</span>())<span class="op">;</span></span>
<span id="cb16-84" class="hljs-ln-code"><a href="#cb16-84"></a></span>
<span id="cb16-85" class="hljs-ln-code"><a href="#cb16-85"></a><span class="co">// Clip the population density image to the buffered geometries</span></span>
<span id="cb16-86" class="hljs-ln-code"><a href="#cb16-86"></a><span class="kw">var</span> popDensYearBuffered <span class="op">=</span> popDensYear<span class="op">.</span><span class="fu">clip</span>(bufferedGeometries)<span class="op">;</span></span>
<span id="cb16-87" class="hljs-ln-code"><a href="#cb16-87"></a></span>
<span id="cb16-88" class="hljs-ln-code"><a href="#cb16-88"></a><span class="co">// Function to sample random points within each buffered area</span></span>
<span id="cb16-89" class="hljs-ln-code"><a href="#cb16-89"></a><span class="kw">var</span> samplePoints <span class="op">=</span> <span class="kw">function</span> (feature) {</span>
<span id="cb16-90" class="hljs-ln-code"><a href="#cb16-90"></a>  <span class="kw">var</span> geometry <span class="op">=</span> feature<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb16-91" class="hljs-ln-code"><a href="#cb16-91"></a>  <span class="kw">var</span> randomPoints <span class="op">=</span> ee<span class="op">.</span><span class="at">FeatureCollection</span><span class="op">.</span><span class="fu">randomPoints</span>(geometry<span class="op">,</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb16-92" class="hljs-ln-code"><a href="#cb16-92"></a>  <span class="kw">var</span> sampledPoints <span class="op">=</span> popDensYearBuffered<span class="op">.</span><span class="fu">sampleRegions</span>({</span>
<span id="cb16-93" class="hljs-ln-code"><a href="#cb16-93"></a>    <span class="dt">collection</span><span class="op">:</span> randomPoints<span class="op">,</span></span>
<span id="cb16-94" class="hljs-ln-code"><a href="#cb16-94"></a>    <span class="dt">scale</span><span class="op">:</span> <span class="dv">1000</span><span class="op">,</span></span>
<span id="cb16-95" class="hljs-ln-code"><a href="#cb16-95"></a>    <span class="dt">tileScale</span><span class="op">:</span> <span class="dv">16</span></span>
<span id="cb16-96" class="hljs-ln-code"><a href="#cb16-96"></a>  })</span>
<span id="cb16-97" class="hljs-ln-code"><a href="#cb16-97"></a>  <span class="co">// Add the buffered area ID to each sampled point</span></span>
<span id="cb16-98" class="hljs-ln-code"><a href="#cb16-98"></a>  sampledPoints <span class="op">=</span> sampledPoints<span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(point) {</span>
<span id="cb16-99" class="hljs-ln-code"><a href="#cb16-99"></a>    <span class="cf">return</span> point<span class="op">.</span><span class="fu">set</span>(<span class="st">'BufferedAreaID'</span><span class="op">,</span> feature<span class="op">.</span><span class="fu">get</span>(<span class="st">'ID'</span>))<span class="op">;</span></span>
<span id="cb16-100" class="hljs-ln-code"><a href="#cb16-100"></a>  })<span class="op">;</span></span>
<span id="cb16-101" class="hljs-ln-code"><a href="#cb16-101"></a>  <span class="cf">return</span> sampledPoints<span class="op">;</span></span>
<span id="cb16-102" class="hljs-ln-code"><a href="#cb16-102"></a>}<span class="op">;</span></span>
<span id="cb16-103" class="hljs-ln-code"><a href="#cb16-103"></a></span>
<span id="cb16-104" class="hljs-ln-code"><a href="#cb16-104"></a><span class="co">// Sample 10 random points within each buffered area</span></span>
<span id="cb16-105" class="hljs-ln-code"><a href="#cb16-105"></a><span class="kw">var</span> sampledPoints <span class="op">=</span> bufferedPoints<span class="op">.</span><span class="fu">map</span>(samplePoints)<span class="op">.</span><span class="fu">flatten</span>()<span class="op">;</span></span>
<span id="cb16-106" class="hljs-ln-code"><a href="#cb16-106"></a></span>
<span id="cb16-107" class="hljs-ln-code"><a href="#cb16-107"></a><span class="co">// Define a reducer that calculates the mean 'population_density'</span></span>
<span id="cb16-108" class="hljs-ln-code"><a href="#cb16-108"></a><span class="kw">var</span> meanReducer <span class="op">=</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>()<span class="op">;</span></span>
<span id="cb16-109" class="hljs-ln-code"><a href="#cb16-109"></a></span>
<span id="cb16-110" class="hljs-ln-code"><a href="#cb16-110"></a><span class="co">// Group the 'sampledPoints' FeatureCollection by 'BufferedAreaID' </span></span>
<span id="cb16-111" class="hljs-ln-code"><a href="#cb16-111"></a><span class="co">// and calculate the mean 'population_density' for each group</span></span>
<span id="cb16-112" class="hljs-ln-code"><a href="#cb16-112"></a><span class="kw">var</span> meanPopDens <span class="op">=</span> sampledPoints<span class="op">.</span><span class="fu">reduceColumns</span>({</span>
<span id="cb16-113" class="hljs-ln-code"><a href="#cb16-113"></a>  <span class="dt">reducer</span><span class="op">:</span> meanReducer<span class="op">.</span><span class="fu">group</span>({</span>
<span id="cb16-114" class="hljs-ln-code"><a href="#cb16-114"></a>    <span class="dt">groupField</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb16-115" class="hljs-ln-code"><a href="#cb16-115"></a>    <span class="dt">groupName</span><span class="op">:</span> <span class="st">'BufferedAreaID'</span><span class="op">,</span></span>
<span id="cb16-116" class="hljs-ln-code"><a href="#cb16-116"></a>  })<span class="op">,</span></span>
<span id="cb16-117" class="hljs-ln-code"><a href="#cb16-117"></a>  <span class="dt">selectors</span><span class="op">:</span> [<span class="st">'BufferedAreaID'</span><span class="op">,</span> <span class="st">'population_density'</span>]</span>
<span id="cb16-118" class="hljs-ln-code"><a href="#cb16-118"></a>})<span class="op">;</span></span>
<span id="cb16-119" class="hljs-ln-code"><a href="#cb16-119"></a></span>
<span id="cb16-120" class="hljs-ln-code"><a href="#cb16-120"></a><span class="co">// Center the map on the continental USA</span></span>
<span id="cb16-121" class="hljs-ln-code"><a href="#cb16-121"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">setCenter</span>(<span class="op">-</span><span class="fl">98.5833</span><span class="op">,</span> <span class="fl">39.8333</span><span class="op">,</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb16-122" class="hljs-ln-code"><a href="#cb16-122"></a></span>
<span id="cb16-123" class="hljs-ln-code"><a href="#cb16-123"></a><span class="co">// Display the filtered FeatureCollection</span></span>
<span id="cb16-124" class="hljs-ln-code"><a href="#cb16-124"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(interstates<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">'green'</span>}<span class="op">,</span> <span class="st">'Interstates'</span>)<span class="op">;</span></span>
<span id="cb16-125" class="hljs-ln-code"><a href="#cb16-125"></a></span>
<span id="cb16-126" class="hljs-ln-code"><a href="#cb16-126"></a><span class="co">// Set visualization parameters</span></span>
<span id="cb16-127" class="hljs-ln-code"><a href="#cb16-127"></a><span class="kw">var</span> streamsVis <span class="op">=</span> {</span>
<span id="cb16-128" class="hljs-ln-code"><a href="#cb16-128"></a>  <span class="dt">color</span><span class="op">:</span> <span class="st">'blue'</span><span class="op">,</span></span>
<span id="cb16-129" class="hljs-ln-code"><a href="#cb16-129"></a>  <span class="dt">width</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb16-130" class="hljs-ln-code"><a href="#cb16-130"></a>}<span class="op">;</span></span>
<span id="cb16-131" class="hljs-ln-code"><a href="#cb16-131"></a></span>
<span id="cb16-132" class="hljs-ln-code"><a href="#cb16-132"></a><span class="co">// Add the filtered streams to the map</span></span>
<span id="cb16-133" class="hljs-ln-code"><a href="#cb16-133"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(filteredStreams<span class="op">,</span> streamsVis<span class="op">,</span> <span class="st">'Filtered Streams'</span>)<span class="op">;</span></span>
<span id="cb16-134" class="hljs-ln-code"><a href="#cb16-134"></a></span>
<span id="cb16-135" class="hljs-ln-code"><a href="#cb16-135"></a><span class="co">// Add the filtered intersection points to the map</span></span>
<span id="cb16-136" class="hljs-ln-code"><a href="#cb16-136"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(intersectionPoints<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">'yellow'</span><span class="op">,</span><span class="dt">pointSize</span><span class="op">:</span> <span class="dv">10</span>}<span class="op">,</span> <span class="st">'Filtered Intersection Points'</span>)<span class="op">;</span></span>
<span id="cb16-137" class="hljs-ln-code"><a href="#cb16-137"></a></span>
<span id="cb16-138" class="hljs-ln-code"><a href="#cb16-138"></a><span class="co">// Add the filtered intersection points to the map</span></span>
<span id="cb16-139" class="hljs-ln-code"><a href="#cb16-139"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(</span>
<span id="cb16-140" class="hljs-ln-code"><a href="#cb16-140"></a>             intersectionPoints<span class="op">,</span></span>
<span id="cb16-141" class="hljs-ln-code"><a href="#cb16-141"></a>             {<span class="dt">color</span><span class="op">:</span> <span class="st">'yellow'</span><span class="op">,</span><span class="dt">pointSize</span><span class="op">:</span> <span class="dv">10</span>}<span class="op">,</span></span>
<span id="cb16-142" class="hljs-ln-code"><a href="#cb16-142"></a>             <span class="st">'Filtered Intersection Points'</span></span>
<span id="cb16-143" class="hljs-ln-code"><a href="#cb16-143"></a>             )<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="filtering-out-low-density-intersections" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Filtering out low density intersections</h2>
<div class="sourceCode" id="cb17" data-code-line-numbers="120-134"><pre class="sourceCode numberSource javascript number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><span id="cb17-1" class="hljs-ln-code"><a href="#cb17-1"></a><span class="co">// Load road data from US census bureau </span></span>
<span id="cb17-2" class="hljs-ln-code"><a href="#cb17-2"></a><span class="kw">var</span> roads <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"TIGER/2016/Roads"</span>)<span class="op">;</span></span>
<span id="cb17-3" class="hljs-ln-code"><a href="#cb17-3"></a></span>
<span id="cb17-4" class="hljs-ln-code"><a href="#cb17-4"></a><span class="co">// Load the WWF HydroSHEDS Free Flowing Rivers Network v1 dataset</span></span>
<span id="cb17-5" class="hljs-ln-code"><a href="#cb17-5"></a><span class="kw">var</span> hydrosheds <span class="op">=</span></span>
<span id="cb17-6" class="hljs-ln-code"><a href="#cb17-6"></a>ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"WWF/HydroSHEDS/v1/FreeFlowingRivers"</span>)<span class="op">;</span></span>
<span id="cb17-7" class="hljs-ln-code"><a href="#cb17-7"></a></span>
<span id="cb17-8" class="hljs-ln-code"><a href="#cb17-8"></a><span class="co">// Load the population density data</span></span>
<span id="cb17-9" class="hljs-ln-code"><a href="#cb17-9"></a><span class="kw">var</span> popDens <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">"CIESIN/GPWv411/GPW_Population_Density"</span>)<span class="op">;</span></span>
<span id="cb17-10" class="hljs-ln-code"><a href="#cb17-10"></a></span>
<span id="cb17-11" class="hljs-ln-code"><a href="#cb17-11"></a><span class="co">// Select just interstates using the MTFCC code</span></span>
<span id="cb17-12" class="hljs-ln-code"><a href="#cb17-12"></a><span class="kw">var</span> interstates <span class="op">=</span> roads<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'mtfcc'</span><span class="op">,</span> <span class="st">'S1100'</span>))<span class="op">;</span></span>
<span id="cb17-13" class="hljs-ln-code"><a href="#cb17-13"></a></span>
<span id="cb17-14" class="hljs-ln-code"><a href="#cb17-14"></a><span class="co">// Filter out streams with an order less than 4</span></span>
<span id="cb17-15" class="hljs-ln-code"><a href="#cb17-15"></a><span class="kw">var</span> filteredStreams <span class="op">=</span> </span>
<span id="cb17-16" class="hljs-ln-code"><a href="#cb17-16"></a>      hydrosheds<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lte</span>(<span class="st">'RIV_ORD'</span><span class="op">,</span> <span class="dv">4</span>))</span>
<span id="cb17-17" class="hljs-ln-code"><a href="#cb17-17"></a>                <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'COUNTRY'</span><span class="op">,</span><span class="st">'United States'</span>))<span class="op">;</span></span>
<span id="cb17-18" class="hljs-ln-code"><a href="#cb17-18"></a></span>
<span id="cb17-19" class="hljs-ln-code"><a href="#cb17-19"></a><span class="co">//Take the 1st population density map within the given date arange</span></span>
<span id="cb17-20" class="hljs-ln-code"><a href="#cb17-20"></a><span class="kw">var</span> popDensYear <span class="op">=</span> popDens<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">'2010-01-01'</span><span class="op">,</span> <span class="st">'2019-12-31'</span>))<span class="op">.</span><span class="fu">first</span>()<span class="op">;</span></span>
<span id="cb17-21" class="hljs-ln-code"><a href="#cb17-21"></a></span>
<span id="cb17-22" class="hljs-ln-code"><a href="#cb17-22"></a><span class="co">// Perform a spatial join between filteredStreams</span></span>
<span id="cb17-23" class="hljs-ln-code"><a href="#cb17-23"></a><span class="co">// and interstates FeatureCollections</span></span>
<span id="cb17-24" class="hljs-ln-code"><a href="#cb17-24"></a><span class="kw">var</span> join <span class="op">=</span> ee<span class="op">.</span><span class="at">Join</span><span class="op">.</span><span class="fu">simple</span>()<span class="op">;</span></span>
<span id="cb17-25" class="hljs-ln-code"><a href="#cb17-25"></a><span class="kw">var</span> filter <span class="op">=</span> ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">intersects</span>({</span>
<span id="cb17-26" class="hljs-ln-code"><a href="#cb17-26"></a>  <span class="dt">leftField</span><span class="op">:</span> <span class="st">'.geo'</span><span class="op">,</span></span>
<span id="cb17-27" class="hljs-ln-code"><a href="#cb17-27"></a>  <span class="dt">rightField</span><span class="op">:</span> <span class="st">'.geo'</span></span>
<span id="cb17-28" class="hljs-ln-code"><a href="#cb17-28"></a>})<span class="op">;</span></span>
<span id="cb17-29" class="hljs-ln-code"><a href="#cb17-29"></a></span>
<span id="cb17-30" class="hljs-ln-code"><a href="#cb17-30"></a><span class="kw">var</span> intersectionLines <span class="op">=</span> join<span class="op">.</span><span class="fu">apply</span>(</span>
<span id="cb17-31" class="hljs-ln-code"><a href="#cb17-31"></a>                              filteredStreams<span class="op">,</span> </span>
<span id="cb17-32" class="hljs-ln-code"><a href="#cb17-32"></a>                              interstates<span class="op">,</span></span>
<span id="cb17-33" class="hljs-ln-code"><a href="#cb17-33"></a>                              filter)<span class="op">;</span></span>
<span id="cb17-34" class="hljs-ln-code"><a href="#cb17-34"></a></span>
<span id="cb17-35" class="hljs-ln-code"><a href="#cb17-35"></a><span class="co">// Sort by a random number and select the first N features</span></span>
<span id="cb17-36" class="hljs-ln-code"><a href="#cb17-36"></a><span class="kw">var</span> selectedLines <span class="op">=</span> intersectionLines<span class="op">.</span><span class="fu">sort</span>(<span class="st">'random'</span>)<span class="op">.</span><span class="fu">limit</span>(<span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb17-37" class="hljs-ln-code"><a href="#cb17-37"></a></span>
<span id="cb17-38" class="hljs-ln-code"><a href="#cb17-38"></a><span class="co">// Function to convert line geometry to a point </span></span>
<span id="cb17-39" class="hljs-ln-code"><a href="#cb17-39"></a><span class="kw">var</span> lineToPoint <span class="op">=</span> <span class="kw">function</span>(feature) {</span>
<span id="cb17-40" class="hljs-ln-code"><a href="#cb17-40"></a>  <span class="co">// Get the geometry</span></span>
<span id="cb17-41" class="hljs-ln-code"><a href="#cb17-41"></a>  <span class="kw">var</span> geom <span class="op">=</span> feature<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb17-42" class="hljs-ln-code"><a href="#cb17-42"></a>  <span class="co">// Get the centroid of the geometry</span></span>
<span id="cb17-43" class="hljs-ln-code"><a href="#cb17-43"></a>  <span class="kw">var</span> centroid <span class="op">=</span> geom<span class="op">.</span><span class="fu">centroid</span>()<span class="op">;</span></span>
<span id="cb17-44" class="hljs-ln-code"><a href="#cb17-44"></a>  <span class="co">// Create a new point feature</span></span>
<span id="cb17-45" class="hljs-ln-code"><a href="#cb17-45"></a>  <span class="kw">var</span> pointFeature <span class="op">=</span> ee<span class="op">.</span><span class="fu">Feature</span>(centroid<span class="op">,</span> feature<span class="op">.</span><span class="fu">toDictionary</span>())<span class="op">;</span></span>
<span id="cb17-46" class="hljs-ln-code"><a href="#cb17-46"></a>  <span class="cf">return</span> pointFeature<span class="op">;</span></span>
<span id="cb17-47" class="hljs-ln-code"><a href="#cb17-47"></a>}<span class="op">;</span></span>
<span id="cb17-48" class="hljs-ln-code"><a href="#cb17-48"></a></span>
<span id="cb17-49" class="hljs-ln-code"><a href="#cb17-49"></a><span class="co">// Apply the lineToPoint function to each element</span></span>
<span id="cb17-50" class="hljs-ln-code"><a href="#cb17-50"></a><span class="co">// in intersectionPoints</span></span>
<span id="cb17-51" class="hljs-ln-code"><a href="#cb17-51"></a><span class="kw">var</span> intersectionPoints <span class="op">=</span> selectedLines<span class="op">.</span><span class="fu">map</span>(lineToPoint)<span class="op">;</span></span>
<span id="cb17-52" class="hljs-ln-code"><a href="#cb17-52"></a></span>
<span id="cb17-53" class="hljs-ln-code"><a href="#cb17-53"></a><span class="co">// Convert the intersectionPoints FeatureCollection to a List</span></span>
<span id="cb17-54" class="hljs-ln-code"><a href="#cb17-54"></a><span class="kw">var</span> pointsList <span class="op">=</span> intersectionPoints</span>
<span id="cb17-55" class="hljs-ln-code"><a href="#cb17-55"></a>                              <span class="op">.</span><span class="fu">toList</span>(intersectionPoints<span class="op">.</span><span class="fu">size</span>())<span class="op">;</span></span>
<span id="cb17-56" class="hljs-ln-code"><a href="#cb17-56"></a></span>
<span id="cb17-57" class="hljs-ln-code"><a href="#cb17-57"></a><span class="co">// Function to buffer a point and set an ID</span></span>
<span id="cb17-58" class="hljs-ln-code"><a href="#cb17-58"></a><span class="kw">var</span> bufferAndSetID <span class="op">=</span> <span class="kw">function</span>(index) {</span>
<span id="cb17-59" class="hljs-ln-code"><a href="#cb17-59"></a>  <span class="co">// Get the point</span></span>
<span id="cb17-60" class="hljs-ln-code"><a href="#cb17-60"></a>  <span class="kw">var</span> point <span class="op">=</span> ee<span class="op">.</span><span class="fu">Feature</span>(pointsList<span class="op">.</span><span class="fu">get</span>(index))<span class="op">;</span></span>
<span id="cb17-61" class="hljs-ln-code"><a href="#cb17-61"></a>  <span class="co">// Buffer the point</span></span>
<span id="cb17-62" class="hljs-ln-code"><a href="#cb17-62"></a>  <span class="kw">var</span> bufferedPoint <span class="op">=</span> point<span class="op">.</span><span class="fu">buffer</span>(<span class="dv">10000</span>)<span class="op">;</span></span>
<span id="cb17-63" class="hljs-ln-code"><a href="#cb17-63"></a>  <span class="co">// Set the ID</span></span>
<span id="cb17-64" class="hljs-ln-code"><a href="#cb17-64"></a>  <span class="kw">var</span> bufferedPointWithID <span class="op">=</span> bufferedPoint<span class="op">.</span><span class="fu">set</span>(<span class="st">'ID'</span><span class="op">,</span> index)<span class="op">;</span></span>
<span id="cb17-65" class="hljs-ln-code"><a href="#cb17-65"></a>  <span class="co">// Return the buffered point with ID</span></span>
<span id="cb17-66" class="hljs-ln-code"><a href="#cb17-66"></a>  <span class="cf">return</span> bufferedPointWithID<span class="op">;</span></span>
<span id="cb17-67" class="hljs-ln-code"><a href="#cb17-67"></a>}<span class="op">;</span></span>
<span id="cb17-68" class="hljs-ln-code"><a href="#cb17-68"></a></span>
<span id="cb17-69" class="hljs-ln-code"><a href="#cb17-69"></a><span class="co">// Create a sequence of numbers to use as IDs</span></span>
<span id="cb17-70" class="hljs-ln-code"><a href="#cb17-70"></a><span class="kw">var</span> ids <span class="op">=</span> ee<span class="op">.</span><span class="at">List</span><span class="op">.</span><span class="fu">sequence</span>(</span>
<span id="cb17-71" class="hljs-ln-code"><a href="#cb17-71"></a>                           <span class="dv">0</span><span class="op">,</span></span>
<span id="cb17-72" class="hljs-ln-code"><a href="#cb17-72"></a>                           intersectionPoints<span class="op">.</span><span class="fu">size</span>()<span class="op">.</span><span class="fu">subtract</span>(<span class="dv">1</span>)</span>
<span id="cb17-73" class="hljs-ln-code"><a href="#cb17-73"></a>                          )<span class="op">;</span></span>
<span id="cb17-74" class="hljs-ln-code"><a href="#cb17-74"></a></span>
<span id="cb17-75" class="hljs-ln-code"><a href="#cb17-75"></a><span class="co">// Create a buffer at every intersection points</span></span>
<span id="cb17-76" class="hljs-ln-code"><a href="#cb17-76"></a><span class="co">// using the id's you just created</span></span>
<span id="cb17-77" class="hljs-ln-code"><a href="#cb17-77"></a><span class="kw">var</span> bufferedPoints <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(ids<span class="op">.</span><span class="fu">map</span>(bufferAndSetID))<span class="op">;</span></span>
<span id="cb17-78" class="hljs-ln-code"><a href="#cb17-78"></a></span>
<span id="cb17-79" class="hljs-ln-code"><a href="#cb17-79"></a><span class="co">// Merge the buffered geometries</span></span>
<span id="cb17-80" class="hljs-ln-code"><a href="#cb17-80"></a><span class="kw">var</span> bufferedGeometries <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span></span>
<span id="cb17-81" class="hljs-ln-code"><a href="#cb17-81"></a>                           <span class="op">.</span><span class="fu">MultiPolygon</span>(bufferedPoints</span>
<span id="cb17-82" class="hljs-ln-code"><a href="#cb17-82"></a>                                          <span class="op">.</span><span class="fu">geometry</span>()</span>
<span id="cb17-83" class="hljs-ln-code"><a href="#cb17-83"></a>                                          <span class="op">.</span><span class="fu">coordinates</span>())<span class="op">;</span></span>
<span id="cb17-84" class="hljs-ln-code"><a href="#cb17-84"></a></span>
<span id="cb17-85" class="hljs-ln-code"><a href="#cb17-85"></a><span class="co">// Clip the population density image to the buffered geometries</span></span>
<span id="cb17-86" class="hljs-ln-code"><a href="#cb17-86"></a><span class="kw">var</span> popDensYearBuffered <span class="op">=</span> popDensYear<span class="op">.</span><span class="fu">clip</span>(bufferedGeometries)<span class="op">;</span></span>
<span id="cb17-87" class="hljs-ln-code"><a href="#cb17-87"></a></span>
<span id="cb17-88" class="hljs-ln-code"><a href="#cb17-88"></a><span class="co">// Function to sample random points within each buffered area</span></span>
<span id="cb17-89" class="hljs-ln-code"><a href="#cb17-89"></a><span class="kw">var</span> samplePoints <span class="op">=</span> <span class="kw">function</span> (feature) {</span>
<span id="cb17-90" class="hljs-ln-code"><a href="#cb17-90"></a>  <span class="kw">var</span> geometry <span class="op">=</span> feature<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb17-91" class="hljs-ln-code"><a href="#cb17-91"></a>  <span class="kw">var</span> randomPoints <span class="op">=</span> ee<span class="op">.</span><span class="at">FeatureCollection</span><span class="op">.</span><span class="fu">randomPoints</span>(geometry<span class="op">,</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb17-92" class="hljs-ln-code"><a href="#cb17-92"></a>  <span class="kw">var</span> sampledPoints <span class="op">=</span> popDensYearBuffered<span class="op">.</span><span class="fu">sampleRegions</span>({</span>
<span id="cb17-93" class="hljs-ln-code"><a href="#cb17-93"></a>    <span class="dt">collection</span><span class="op">:</span> randomPoints<span class="op">,</span></span>
<span id="cb17-94" class="hljs-ln-code"><a href="#cb17-94"></a>    <span class="dt">scale</span><span class="op">:</span> <span class="dv">1000</span><span class="op">,</span></span>
<span id="cb17-95" class="hljs-ln-code"><a href="#cb17-95"></a>    <span class="dt">tileScale</span><span class="op">:</span> <span class="dv">16</span></span>
<span id="cb17-96" class="hljs-ln-code"><a href="#cb17-96"></a>  })</span>
<span id="cb17-97" class="hljs-ln-code"><a href="#cb17-97"></a>  <span class="co">// Add the buffered area ID to each sampled point</span></span>
<span id="cb17-98" class="hljs-ln-code"><a href="#cb17-98"></a>  sampledPoints <span class="op">=</span> sampledPoints<span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(point) {</span>
<span id="cb17-99" class="hljs-ln-code"><a href="#cb17-99"></a>    <span class="cf">return</span> point<span class="op">.</span><span class="fu">set</span>(<span class="st">'BufferedAreaID'</span><span class="op">,</span> feature<span class="op">.</span><span class="fu">get</span>(<span class="st">'ID'</span>))<span class="op">;</span></span>
<span id="cb17-100" class="hljs-ln-code"><a href="#cb17-100"></a>  })<span class="op">;</span></span>
<span id="cb17-101" class="hljs-ln-code"><a href="#cb17-101"></a>  <span class="cf">return</span> sampledPoints<span class="op">;</span></span>
<span id="cb17-102" class="hljs-ln-code"><a href="#cb17-102"></a>}<span class="op">;</span></span>
<span id="cb17-103" class="hljs-ln-code"><a href="#cb17-103"></a></span>
<span id="cb17-104" class="hljs-ln-code"><a href="#cb17-104"></a><span class="co">// Sample 10 random points within each buffered area</span></span>
<span id="cb17-105" class="hljs-ln-code"><a href="#cb17-105"></a><span class="kw">var</span> sampledPoints <span class="op">=</span> bufferedPoints<span class="op">.</span><span class="fu">map</span>(samplePoints)<span class="op">.</span><span class="fu">flatten</span>()<span class="op">;</span></span>
<span id="cb17-106" class="hljs-ln-code"><a href="#cb17-106"></a></span>
<span id="cb17-107" class="hljs-ln-code"><a href="#cb17-107"></a><span class="co">// Define a reducer that calculates the mean 'population_density'</span></span>
<span id="cb17-108" class="hljs-ln-code"><a href="#cb17-108"></a><span class="kw">var</span> meanReducer <span class="op">=</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>()<span class="op">;</span></span>
<span id="cb17-109" class="hljs-ln-code"><a href="#cb17-109"></a></span>
<span id="cb17-110" class="hljs-ln-code"><a href="#cb17-110"></a><span class="co">// Group the 'sampledPoints' FeatureCollection by 'BufferedAreaID' </span></span>
<span id="cb17-111" class="hljs-ln-code"><a href="#cb17-111"></a><span class="co">// and calculate the mean 'population_density' for each group</span></span>
<span id="cb17-112" class="hljs-ln-code"><a href="#cb17-112"></a><span class="kw">var</span> meanPopDens <span class="op">=</span> sampledPoints<span class="op">.</span><span class="fu">reduceColumns</span>({</span>
<span id="cb17-113" class="hljs-ln-code"><a href="#cb17-113"></a>  <span class="dt">reducer</span><span class="op">:</span> meanReducer<span class="op">.</span><span class="fu">group</span>({</span>
<span id="cb17-114" class="hljs-ln-code"><a href="#cb17-114"></a>    <span class="dt">groupField</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb17-115" class="hljs-ln-code"><a href="#cb17-115"></a>    <span class="dt">groupName</span><span class="op">:</span> <span class="st">'BufferedAreaID'</span><span class="op">,</span></span>
<span id="cb17-116" class="hljs-ln-code"><a href="#cb17-116"></a>  })<span class="op">,</span></span>
<span id="cb17-117" class="hljs-ln-code"><a href="#cb17-117"></a>  <span class="dt">selectors</span><span class="op">:</span> [<span class="st">'BufferedAreaID'</span><span class="op">,</span> <span class="st">'population_density'</span>]</span>
<span id="cb17-118" class="hljs-ln-code"><a href="#cb17-118"></a>})<span class="op">;</span></span>
<span id="cb17-119" class="hljs-ln-code"><a href="#cb17-119"></a></span>
<span id="cb17-120" class="hljs-ln-code"><a href="#cb17-120"></a><span class="co">// Transform the output of the reduceColumns method</span></span>
<span id="cb17-121" class="hljs-ln-code"><a href="#cb17-121"></a><span class="co">// to a FeatureCollection</span></span>
<span id="cb17-122" class="hljs-ln-code"><a href="#cb17-122"></a><span class="kw">var</span> meanPopDensList <span class="op">=</span> ee<span class="op">.</span><span class="fu">List</span>(meanPopDens<span class="op">.</span><span class="fu">get</span>(<span class="st">'groups'</span>))<span class="op">;</span></span>
<span id="cb17-123" class="hljs-ln-code"><a href="#cb17-123"></a><span class="kw">var</span> meanPopDensFC <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(</span>
<span id="cb17-124" class="hljs-ln-code"><a href="#cb17-124"></a>                          meanPopDensList<span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(el)</span>
<span id="cb17-125" class="hljs-ln-code"><a href="#cb17-125"></a>                                      {</span>
<span id="cb17-126" class="hljs-ln-code"><a href="#cb17-126"></a>                                        <span class="kw">var</span> dict <span class="op">=</span> ee<span class="op">.</span><span class="fu">Dictionary</span>(el)<span class="op">;</span></span>
<span id="cb17-127" class="hljs-ln-code"><a href="#cb17-127"></a>                                        <span class="cf">return</span> ee<span class="op">.</span><span class="fu">Feature</span>(<span class="kw">null</span><span class="op">,</span> dict)<span class="op">;</span></span>
<span id="cb17-128" class="hljs-ln-code"><a href="#cb17-128"></a>                                      }))<span class="op">;</span></span>
<span id="cb17-129" class="hljs-ln-code"><a href="#cb17-129"></a></span>
<span id="cb17-130" class="hljs-ln-code"><a href="#cb17-130"></a><span class="co">// Filter the meanPopDensFC by the 'mean' property</span></span>
<span id="cb17-131" class="hljs-ln-code"><a href="#cb17-131"></a><span class="kw">var</span> filteredMeanPopDens <span class="op">=</span> meanPopDensFC<span class="op">.</span><span class="fu">filter</span>(</span>
<span id="cb17-132" class="hljs-ln-code"><a href="#cb17-132"></a>                                              ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">gt</span>(</span>
<span id="cb17-133" class="hljs-ln-code"><a href="#cb17-133"></a>                                                <span class="st">'mean'</span><span class="op">,</span> <span class="dv">100</span>)</span>
<span id="cb17-134" class="hljs-ln-code"><a href="#cb17-134"></a>                                              )<span class="op">;</span></span>
<span id="cb17-135" class="hljs-ln-code"><a href="#cb17-135"></a></span>
<span id="cb17-136" class="hljs-ln-code"><a href="#cb17-136"></a><span class="co">// Center the map on the continental USA</span></span>
<span id="cb17-137" class="hljs-ln-code"><a href="#cb17-137"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">setCenter</span>(<span class="op">-</span><span class="fl">98.5833</span><span class="op">,</span> <span class="fl">39.8333</span><span class="op">,</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb17-138" class="hljs-ln-code"><a href="#cb17-138"></a></span>
<span id="cb17-139" class="hljs-ln-code"><a href="#cb17-139"></a><span class="co">// Display the filtered FeatureCollection</span></span>
<span id="cb17-140" class="hljs-ln-code"><a href="#cb17-140"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(interstates<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">'green'</span>}<span class="op">,</span> <span class="st">'Interstates'</span>)<span class="op">;</span></span>
<span id="cb17-141" class="hljs-ln-code"><a href="#cb17-141"></a></span>
<span id="cb17-142" class="hljs-ln-code"><a href="#cb17-142"></a><span class="co">// Set visualization parameters</span></span>
<span id="cb17-143" class="hljs-ln-code"><a href="#cb17-143"></a><span class="kw">var</span> streamsVis <span class="op">=</span> {</span>
<span id="cb17-144" class="hljs-ln-code"><a href="#cb17-144"></a>  <span class="dt">color</span><span class="op">:</span> <span class="st">'blue'</span><span class="op">,</span></span>
<span id="cb17-145" class="hljs-ln-code"><a href="#cb17-145"></a>  <span class="dt">width</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb17-146" class="hljs-ln-code"><a href="#cb17-146"></a>}<span class="op">;</span></span>
<span id="cb17-147" class="hljs-ln-code"><a href="#cb17-147"></a></span>
<span id="cb17-148" class="hljs-ln-code"><a href="#cb17-148"></a><span class="co">// Add the filtered streams to the map</span></span>
<span id="cb17-149" class="hljs-ln-code"><a href="#cb17-149"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(filteredStreams<span class="op">,</span> streamsVis<span class="op">,</span> <span class="st">'Filtered Streams'</span>)<span class="op">;</span></span>
<span id="cb17-150" class="hljs-ln-code"><a href="#cb17-150"></a></span>
<span id="cb17-151" class="hljs-ln-code"><a href="#cb17-151"></a><span class="co">// Add the filtered intersection points to the map</span></span>
<span id="cb17-152" class="hljs-ln-code"><a href="#cb17-152"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(intersectionPoints<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">'yellow'</span><span class="op">,</span><span class="dt">pointSize</span><span class="op">:</span> <span class="dv">10</span>}<span class="op">,</span> <span class="st">'Filtered Intersection Points'</span>)<span class="op">;</span></span>
<span id="cb17-153" class="hljs-ln-code"><a href="#cb17-153"></a></span>
<span id="cb17-154" class="hljs-ln-code"><a href="#cb17-154"></a><span class="co">// Add the filtered intersection points to the map</span></span>
<span id="cb17-155" class="hljs-ln-code"><a href="#cb17-155"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(</span>
<span id="cb17-156" class="hljs-ln-code"><a href="#cb17-156"></a>             intersectionPoints<span class="op">,</span></span>
<span id="cb17-157" class="hljs-ln-code"><a href="#cb17-157"></a>             {<span class="dt">color</span><span class="op">:</span> <span class="st">'yellow'</span><span class="op">,</span><span class="dt">pointSize</span><span class="op">:</span> <span class="dv">10</span>}<span class="op">,</span></span>
<span id="cb17-158" class="hljs-ln-code"><a href="#cb17-158"></a>             <span class="st">'Filtered Intersection Points'</span></span>
<span id="cb17-159" class="hljs-ln-code"><a href="#cb17-159"></a>             )<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="filtering-out-low-density-intersections-1" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Filtering out low density intersections</h2>
<div class="sourceCode" id="cb18" data-code-line-numbers="136-140"><pre class="sourceCode numberSource javascript number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><span id="cb18-1" class="hljs-ln-code"><a href="#cb18-1"></a><span class="co">// Load road data from US census bureau </span></span>
<span id="cb18-2" class="hljs-ln-code"><a href="#cb18-2"></a><span class="kw">var</span> roads <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"TIGER/2016/Roads"</span>)<span class="op">;</span></span>
<span id="cb18-3" class="hljs-ln-code"><a href="#cb18-3"></a></span>
<span id="cb18-4" class="hljs-ln-code"><a href="#cb18-4"></a><span class="co">// Load the WWF HydroSHEDS Free Flowing Rivers Network v1 dataset</span></span>
<span id="cb18-5" class="hljs-ln-code"><a href="#cb18-5"></a><span class="kw">var</span> hydrosheds <span class="op">=</span></span>
<span id="cb18-6" class="hljs-ln-code"><a href="#cb18-6"></a>ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"WWF/HydroSHEDS/v1/FreeFlowingRivers"</span>)<span class="op">;</span></span>
<span id="cb18-7" class="hljs-ln-code"><a href="#cb18-7"></a></span>
<span id="cb18-8" class="hljs-ln-code"><a href="#cb18-8"></a><span class="co">// Load the population density data</span></span>
<span id="cb18-9" class="hljs-ln-code"><a href="#cb18-9"></a><span class="kw">var</span> popDens <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">"CIESIN/GPWv411/GPW_Population_Density"</span>)<span class="op">;</span></span>
<span id="cb18-10" class="hljs-ln-code"><a href="#cb18-10"></a></span>
<span id="cb18-11" class="hljs-ln-code"><a href="#cb18-11"></a><span class="co">// Select just interstates using the MTFCC code</span></span>
<span id="cb18-12" class="hljs-ln-code"><a href="#cb18-12"></a><span class="kw">var</span> interstates <span class="op">=</span> roads<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'mtfcc'</span><span class="op">,</span> <span class="st">'S1100'</span>))<span class="op">;</span></span>
<span id="cb18-13" class="hljs-ln-code"><a href="#cb18-13"></a></span>
<span id="cb18-14" class="hljs-ln-code"><a href="#cb18-14"></a><span class="co">// Filter out streams with an order less than 4</span></span>
<span id="cb18-15" class="hljs-ln-code"><a href="#cb18-15"></a><span class="kw">var</span> filteredStreams <span class="op">=</span> </span>
<span id="cb18-16" class="hljs-ln-code"><a href="#cb18-16"></a>      hydrosheds<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lte</span>(<span class="st">'RIV_ORD'</span><span class="op">,</span> <span class="dv">4</span>))</span>
<span id="cb18-17" class="hljs-ln-code"><a href="#cb18-17"></a>                <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'COUNTRY'</span><span class="op">,</span><span class="st">'United States'</span>))<span class="op">;</span></span>
<span id="cb18-18" class="hljs-ln-code"><a href="#cb18-18"></a></span>
<span id="cb18-19" class="hljs-ln-code"><a href="#cb18-19"></a><span class="co">//Take the 1st population density map within the given date arange</span></span>
<span id="cb18-20" class="hljs-ln-code"><a href="#cb18-20"></a><span class="kw">var</span> popDensYear <span class="op">=</span> popDens<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">'2010-01-01'</span><span class="op">,</span> <span class="st">'2019-12-31'</span>))<span class="op">.</span><span class="fu">first</span>()<span class="op">;</span></span>
<span id="cb18-21" class="hljs-ln-code"><a href="#cb18-21"></a></span>
<span id="cb18-22" class="hljs-ln-code"><a href="#cb18-22"></a><span class="co">// Perform a spatial join between filteredStreams</span></span>
<span id="cb18-23" class="hljs-ln-code"><a href="#cb18-23"></a><span class="co">// and interstates FeatureCollections</span></span>
<span id="cb18-24" class="hljs-ln-code"><a href="#cb18-24"></a><span class="kw">var</span> join <span class="op">=</span> ee<span class="op">.</span><span class="at">Join</span><span class="op">.</span><span class="fu">simple</span>()<span class="op">;</span></span>
<span id="cb18-25" class="hljs-ln-code"><a href="#cb18-25"></a><span class="kw">var</span> filter <span class="op">=</span> ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">intersects</span>({</span>
<span id="cb18-26" class="hljs-ln-code"><a href="#cb18-26"></a>  <span class="dt">leftField</span><span class="op">:</span> <span class="st">'.geo'</span><span class="op">,</span></span>
<span id="cb18-27" class="hljs-ln-code"><a href="#cb18-27"></a>  <span class="dt">rightField</span><span class="op">:</span> <span class="st">'.geo'</span></span>
<span id="cb18-28" class="hljs-ln-code"><a href="#cb18-28"></a>})<span class="op">;</span></span>
<span id="cb18-29" class="hljs-ln-code"><a href="#cb18-29"></a></span>
<span id="cb18-30" class="hljs-ln-code"><a href="#cb18-30"></a><span class="kw">var</span> intersectionLines <span class="op">=</span> join<span class="op">.</span><span class="fu">apply</span>(</span>
<span id="cb18-31" class="hljs-ln-code"><a href="#cb18-31"></a>                              filteredStreams<span class="op">,</span> </span>
<span id="cb18-32" class="hljs-ln-code"><a href="#cb18-32"></a>                              interstates<span class="op">,</span></span>
<span id="cb18-33" class="hljs-ln-code"><a href="#cb18-33"></a>                              filter)<span class="op">;</span></span>
<span id="cb18-34" class="hljs-ln-code"><a href="#cb18-34"></a></span>
<span id="cb18-35" class="hljs-ln-code"><a href="#cb18-35"></a><span class="co">// Sort by a random number and select the first N features</span></span>
<span id="cb18-36" class="hljs-ln-code"><a href="#cb18-36"></a><span class="kw">var</span> selectedLines <span class="op">=</span> intersectionLines<span class="op">.</span><span class="fu">sort</span>(<span class="st">'random'</span>)<span class="op">.</span><span class="fu">limit</span>(<span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb18-37" class="hljs-ln-code"><a href="#cb18-37"></a></span>
<span id="cb18-38" class="hljs-ln-code"><a href="#cb18-38"></a><span class="co">// Function to convert line geometry to a point </span></span>
<span id="cb18-39" class="hljs-ln-code"><a href="#cb18-39"></a><span class="kw">var</span> lineToPoint <span class="op">=</span> <span class="kw">function</span>(feature) {</span>
<span id="cb18-40" class="hljs-ln-code"><a href="#cb18-40"></a>  <span class="co">// Get the geometry</span></span>
<span id="cb18-41" class="hljs-ln-code"><a href="#cb18-41"></a>  <span class="kw">var</span> geom <span class="op">=</span> feature<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb18-42" class="hljs-ln-code"><a href="#cb18-42"></a>  <span class="co">// Get the centroid of the geometry</span></span>
<span id="cb18-43" class="hljs-ln-code"><a href="#cb18-43"></a>  <span class="kw">var</span> centroid <span class="op">=</span> geom<span class="op">.</span><span class="fu">centroid</span>()<span class="op">;</span></span>
<span id="cb18-44" class="hljs-ln-code"><a href="#cb18-44"></a>  <span class="co">// Create a new point feature</span></span>
<span id="cb18-45" class="hljs-ln-code"><a href="#cb18-45"></a>  <span class="kw">var</span> pointFeature <span class="op">=</span> ee<span class="op">.</span><span class="fu">Feature</span>(centroid<span class="op">,</span> feature<span class="op">.</span><span class="fu">toDictionary</span>())<span class="op">;</span></span>
<span id="cb18-46" class="hljs-ln-code"><a href="#cb18-46"></a>  <span class="cf">return</span> pointFeature<span class="op">;</span></span>
<span id="cb18-47" class="hljs-ln-code"><a href="#cb18-47"></a>}<span class="op">;</span></span>
<span id="cb18-48" class="hljs-ln-code"><a href="#cb18-48"></a></span>
<span id="cb18-49" class="hljs-ln-code"><a href="#cb18-49"></a><span class="co">// Apply the lineToPoint function to each element</span></span>
<span id="cb18-50" class="hljs-ln-code"><a href="#cb18-50"></a><span class="co">// in intersectionPoints</span></span>
<span id="cb18-51" class="hljs-ln-code"><a href="#cb18-51"></a><span class="kw">var</span> intersectionPoints <span class="op">=</span> selectedLines<span class="op">.</span><span class="fu">map</span>(lineToPoint)<span class="op">;</span></span>
<span id="cb18-52" class="hljs-ln-code"><a href="#cb18-52"></a></span>
<span id="cb18-53" class="hljs-ln-code"><a href="#cb18-53"></a><span class="co">// Convert the intersectionPoints FeatureCollection to a List</span></span>
<span id="cb18-54" class="hljs-ln-code"><a href="#cb18-54"></a><span class="kw">var</span> pointsList <span class="op">=</span> intersectionPoints</span>
<span id="cb18-55" class="hljs-ln-code"><a href="#cb18-55"></a>                              <span class="op">.</span><span class="fu">toList</span>(intersectionPoints<span class="op">.</span><span class="fu">size</span>())<span class="op">;</span></span>
<span id="cb18-56" class="hljs-ln-code"><a href="#cb18-56"></a></span>
<span id="cb18-57" class="hljs-ln-code"><a href="#cb18-57"></a><span class="co">// Function to buffer a point and set an ID</span></span>
<span id="cb18-58" class="hljs-ln-code"><a href="#cb18-58"></a><span class="kw">var</span> bufferAndSetID <span class="op">=</span> <span class="kw">function</span>(index) {</span>
<span id="cb18-59" class="hljs-ln-code"><a href="#cb18-59"></a>  <span class="co">// Get the point</span></span>
<span id="cb18-60" class="hljs-ln-code"><a href="#cb18-60"></a>  <span class="kw">var</span> point <span class="op">=</span> ee<span class="op">.</span><span class="fu">Feature</span>(pointsList<span class="op">.</span><span class="fu">get</span>(index))<span class="op">;</span></span>
<span id="cb18-61" class="hljs-ln-code"><a href="#cb18-61"></a>  <span class="co">// Buffer the point</span></span>
<span id="cb18-62" class="hljs-ln-code"><a href="#cb18-62"></a>  <span class="kw">var</span> bufferedPoint <span class="op">=</span> point<span class="op">.</span><span class="fu">buffer</span>(<span class="dv">10000</span>)<span class="op">;</span></span>
<span id="cb18-63" class="hljs-ln-code"><a href="#cb18-63"></a>  <span class="co">// Set the ID</span></span>
<span id="cb18-64" class="hljs-ln-code"><a href="#cb18-64"></a>  <span class="kw">var</span> bufferedPointWithID <span class="op">=</span> bufferedPoint<span class="op">.</span><span class="fu">set</span>(<span class="st">'ID'</span><span class="op">,</span> index)<span class="op">;</span></span>
<span id="cb18-65" class="hljs-ln-code"><a href="#cb18-65"></a>  <span class="co">// Return the buffered point with ID</span></span>
<span id="cb18-66" class="hljs-ln-code"><a href="#cb18-66"></a>  <span class="cf">return</span> bufferedPointWithID<span class="op">;</span></span>
<span id="cb18-67" class="hljs-ln-code"><a href="#cb18-67"></a>}<span class="op">;</span></span>
<span id="cb18-68" class="hljs-ln-code"><a href="#cb18-68"></a></span>
<span id="cb18-69" class="hljs-ln-code"><a href="#cb18-69"></a><span class="co">// Create a sequence of numbers to use as IDs</span></span>
<span id="cb18-70" class="hljs-ln-code"><a href="#cb18-70"></a><span class="kw">var</span> ids <span class="op">=</span> ee<span class="op">.</span><span class="at">List</span><span class="op">.</span><span class="fu">sequence</span>(</span>
<span id="cb18-71" class="hljs-ln-code"><a href="#cb18-71"></a>                           <span class="dv">0</span><span class="op">,</span></span>
<span id="cb18-72" class="hljs-ln-code"><a href="#cb18-72"></a>                           intersectionPoints<span class="op">.</span><span class="fu">size</span>()<span class="op">.</span><span class="fu">subtract</span>(<span class="dv">1</span>)</span>
<span id="cb18-73" class="hljs-ln-code"><a href="#cb18-73"></a>                          )<span class="op">;</span></span>
<span id="cb18-74" class="hljs-ln-code"><a href="#cb18-74"></a></span>
<span id="cb18-75" class="hljs-ln-code"><a href="#cb18-75"></a><span class="co">// Create a buffer at every intersection points</span></span>
<span id="cb18-76" class="hljs-ln-code"><a href="#cb18-76"></a><span class="co">// using the id's you just created</span></span>
<span id="cb18-77" class="hljs-ln-code"><a href="#cb18-77"></a><span class="kw">var</span> bufferedPoints <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(ids<span class="op">.</span><span class="fu">map</span>(bufferAndSetID))<span class="op">;</span></span>
<span id="cb18-78" class="hljs-ln-code"><a href="#cb18-78"></a></span>
<span id="cb18-79" class="hljs-ln-code"><a href="#cb18-79"></a><span class="co">// Merge the buffered geometries</span></span>
<span id="cb18-80" class="hljs-ln-code"><a href="#cb18-80"></a><span class="kw">var</span> bufferedGeometries <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span></span>
<span id="cb18-81" class="hljs-ln-code"><a href="#cb18-81"></a>                           <span class="op">.</span><span class="fu">MultiPolygon</span>(bufferedPoints</span>
<span id="cb18-82" class="hljs-ln-code"><a href="#cb18-82"></a>                                          <span class="op">.</span><span class="fu">geometry</span>()</span>
<span id="cb18-83" class="hljs-ln-code"><a href="#cb18-83"></a>                                          <span class="op">.</span><span class="fu">coordinates</span>())<span class="op">;</span></span>
<span id="cb18-84" class="hljs-ln-code"><a href="#cb18-84"></a></span>
<span id="cb18-85" class="hljs-ln-code"><a href="#cb18-85"></a><span class="co">// Clip the population density image to the buffered geometries</span></span>
<span id="cb18-86" class="hljs-ln-code"><a href="#cb18-86"></a><span class="kw">var</span> popDensYearBuffered <span class="op">=</span> popDensYear<span class="op">.</span><span class="fu">clip</span>(bufferedGeometries)<span class="op">;</span></span>
<span id="cb18-87" class="hljs-ln-code"><a href="#cb18-87"></a></span>
<span id="cb18-88" class="hljs-ln-code"><a href="#cb18-88"></a><span class="co">// Function to sample random points within each buffered area</span></span>
<span id="cb18-89" class="hljs-ln-code"><a href="#cb18-89"></a><span class="kw">var</span> samplePoints <span class="op">=</span> <span class="kw">function</span> (feature) {</span>
<span id="cb18-90" class="hljs-ln-code"><a href="#cb18-90"></a>  <span class="kw">var</span> geometry <span class="op">=</span> feature<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb18-91" class="hljs-ln-code"><a href="#cb18-91"></a>  <span class="kw">var</span> randomPoints <span class="op">=</span> ee<span class="op">.</span><span class="at">FeatureCollection</span><span class="op">.</span><span class="fu">randomPoints</span>(geometry<span class="op">,</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb18-92" class="hljs-ln-code"><a href="#cb18-92"></a>  <span class="kw">var</span> sampledPoints <span class="op">=</span> popDensYearBuffered<span class="op">.</span><span class="fu">sampleRegions</span>({</span>
<span id="cb18-93" class="hljs-ln-code"><a href="#cb18-93"></a>    <span class="dt">collection</span><span class="op">:</span> randomPoints<span class="op">,</span></span>
<span id="cb18-94" class="hljs-ln-code"><a href="#cb18-94"></a>    <span class="dt">scale</span><span class="op">:</span> <span class="dv">1000</span><span class="op">,</span></span>
<span id="cb18-95" class="hljs-ln-code"><a href="#cb18-95"></a>    <span class="dt">tileScale</span><span class="op">:</span> <span class="dv">16</span></span>
<span id="cb18-96" class="hljs-ln-code"><a href="#cb18-96"></a>  })</span>
<span id="cb18-97" class="hljs-ln-code"><a href="#cb18-97"></a>  <span class="co">// Add the buffered area ID to each sampled point</span></span>
<span id="cb18-98" class="hljs-ln-code"><a href="#cb18-98"></a>  sampledPoints <span class="op">=</span> sampledPoints<span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(point) {</span>
<span id="cb18-99" class="hljs-ln-code"><a href="#cb18-99"></a>    <span class="cf">return</span> point<span class="op">.</span><span class="fu">set</span>(<span class="st">'BufferedAreaID'</span><span class="op">,</span> feature<span class="op">.</span><span class="fu">get</span>(<span class="st">'ID'</span>))<span class="op">;</span></span>
<span id="cb18-100" class="hljs-ln-code"><a href="#cb18-100"></a>  })<span class="op">;</span></span>
<span id="cb18-101" class="hljs-ln-code"><a href="#cb18-101"></a>  <span class="cf">return</span> sampledPoints<span class="op">;</span></span>
<span id="cb18-102" class="hljs-ln-code"><a href="#cb18-102"></a>}<span class="op">;</span></span>
<span id="cb18-103" class="hljs-ln-code"><a href="#cb18-103"></a></span>
<span id="cb18-104" class="hljs-ln-code"><a href="#cb18-104"></a><span class="co">// Sample 10 random points within each buffered area</span></span>
<span id="cb18-105" class="hljs-ln-code"><a href="#cb18-105"></a><span class="kw">var</span> sampledPoints <span class="op">=</span> bufferedPoints<span class="op">.</span><span class="fu">map</span>(samplePoints)<span class="op">.</span><span class="fu">flatten</span>()<span class="op">;</span></span>
<span id="cb18-106" class="hljs-ln-code"><a href="#cb18-106"></a></span>
<span id="cb18-107" class="hljs-ln-code"><a href="#cb18-107"></a><span class="co">// Define a reducer that calculates the mean 'population_density'</span></span>
<span id="cb18-108" class="hljs-ln-code"><a href="#cb18-108"></a><span class="kw">var</span> meanReducer <span class="op">=</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>()<span class="op">;</span></span>
<span id="cb18-109" class="hljs-ln-code"><a href="#cb18-109"></a></span>
<span id="cb18-110" class="hljs-ln-code"><a href="#cb18-110"></a><span class="co">// Group the 'sampledPoints' FeatureCollection by 'BufferedAreaID' </span></span>
<span id="cb18-111" class="hljs-ln-code"><a href="#cb18-111"></a><span class="co">// and calculate the mean 'population_density' for each group</span></span>
<span id="cb18-112" class="hljs-ln-code"><a href="#cb18-112"></a><span class="kw">var</span> meanPopDens <span class="op">=</span> sampledPoints<span class="op">.</span><span class="fu">reduceColumns</span>({</span>
<span id="cb18-113" class="hljs-ln-code"><a href="#cb18-113"></a>  <span class="dt">reducer</span><span class="op">:</span> meanReducer<span class="op">.</span><span class="fu">group</span>({</span>
<span id="cb18-114" class="hljs-ln-code"><a href="#cb18-114"></a>    <span class="dt">groupField</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb18-115" class="hljs-ln-code"><a href="#cb18-115"></a>    <span class="dt">groupName</span><span class="op">:</span> <span class="st">'BufferedAreaID'</span><span class="op">,</span></span>
<span id="cb18-116" class="hljs-ln-code"><a href="#cb18-116"></a>  })<span class="op">,</span></span>
<span id="cb18-117" class="hljs-ln-code"><a href="#cb18-117"></a>  <span class="dt">selectors</span><span class="op">:</span> [<span class="st">'BufferedAreaID'</span><span class="op">,</span> <span class="st">'population_density'</span>]</span>
<span id="cb18-118" class="hljs-ln-code"><a href="#cb18-118"></a>})<span class="op">;</span></span>
<span id="cb18-119" class="hljs-ln-code"><a href="#cb18-119"></a></span>
<span id="cb18-120" class="hljs-ln-code"><a href="#cb18-120"></a><span class="co">// Transform the output of the reduceColumns method</span></span>
<span id="cb18-121" class="hljs-ln-code"><a href="#cb18-121"></a><span class="co">// to a FeatureCollection</span></span>
<span id="cb18-122" class="hljs-ln-code"><a href="#cb18-122"></a><span class="kw">var</span> meanPopDensList <span class="op">=</span> ee<span class="op">.</span><span class="fu">List</span>(meanPopDens<span class="op">.</span><span class="fu">get</span>(<span class="st">'groups'</span>))<span class="op">;</span></span>
<span id="cb18-123" class="hljs-ln-code"><a href="#cb18-123"></a><span class="kw">var</span> meanPopDensFC <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(</span>
<span id="cb18-124" class="hljs-ln-code"><a href="#cb18-124"></a>                          meanPopDensList<span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(el)</span>
<span id="cb18-125" class="hljs-ln-code"><a href="#cb18-125"></a>                                      {</span>
<span id="cb18-126" class="hljs-ln-code"><a href="#cb18-126"></a>                                        <span class="kw">var</span> dict <span class="op">=</span> ee<span class="op">.</span><span class="fu">Dictionary</span>(el)<span class="op">;</span></span>
<span id="cb18-127" class="hljs-ln-code"><a href="#cb18-127"></a>                                        <span class="cf">return</span> ee<span class="op">.</span><span class="fu">Feature</span>(<span class="kw">null</span><span class="op">,</span> dict)<span class="op">;</span></span>
<span id="cb18-128" class="hljs-ln-code"><a href="#cb18-128"></a>                                      }))<span class="op">;</span></span>
<span id="cb18-129" class="hljs-ln-code"><a href="#cb18-129"></a></span>
<span id="cb18-130" class="hljs-ln-code"><a href="#cb18-130"></a><span class="co">// Filter the meanPopDensFC by the 'mean' property</span></span>
<span id="cb18-131" class="hljs-ln-code"><a href="#cb18-131"></a><span class="kw">var</span> filteredMeanPopDens <span class="op">=</span> meanPopDensFC<span class="op">.</span><span class="fu">filter</span>(</span>
<span id="cb18-132" class="hljs-ln-code"><a href="#cb18-132"></a>                                              ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">gt</span>(</span>
<span id="cb18-133" class="hljs-ln-code"><a href="#cb18-133"></a>                                                <span class="st">'mean'</span><span class="op">,</span> <span class="dv">100</span>)</span>
<span id="cb18-134" class="hljs-ln-code"><a href="#cb18-134"></a>                                              )<span class="op">;</span></span>
<span id="cb18-135" class="hljs-ln-code"><a href="#cb18-135"></a></span>
<span id="cb18-136" class="hljs-ln-code"><a href="#cb18-136"></a><span class="co">// Get the list indices of the points with a</span></span>
<span id="cb18-137" class="hljs-ln-code"><a href="#cb18-137"></a><span class="co">// population density greater than 100 people per sq km</span></span>
<span id="cb18-138" class="hljs-ln-code"><a href="#cb18-138"></a><span class="kw">var</span> filteredIds <span class="op">=</span> filteredMeanPopDens<span class="op">.</span><span class="fu">aggregate_array</span>(</span>
<span id="cb18-139" class="hljs-ln-code"><a href="#cb18-139"></a>                                      <span class="st">'BufferedAreaID'</span></span>
<span id="cb18-140" class="hljs-ln-code"><a href="#cb18-140"></a>                                      )<span class="op">;</span></span>
<span id="cb18-141" class="hljs-ln-code"><a href="#cb18-141"></a></span>
<span id="cb18-142" class="hljs-ln-code"><a href="#cb18-142"></a><span class="co">// Center the map on the continental USA</span></span>
<span id="cb18-143" class="hljs-ln-code"><a href="#cb18-143"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">setCenter</span>(<span class="op">-</span><span class="fl">98.5833</span><span class="op">,</span> <span class="fl">39.8333</span><span class="op">,</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb18-144" class="hljs-ln-code"><a href="#cb18-144"></a></span>
<span id="cb18-145" class="hljs-ln-code"><a href="#cb18-145"></a><span class="co">// Display the filtered FeatureCollection</span></span>
<span id="cb18-146" class="hljs-ln-code"><a href="#cb18-146"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(interstates<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">'green'</span>}<span class="op">,</span> <span class="st">'Interstates'</span>)<span class="op">;</span></span>
<span id="cb18-147" class="hljs-ln-code"><a href="#cb18-147"></a></span>
<span id="cb18-148" class="hljs-ln-code"><a href="#cb18-148"></a><span class="co">// Set visualization parameters</span></span>
<span id="cb18-149" class="hljs-ln-code"><a href="#cb18-149"></a><span class="kw">var</span> streamsVis <span class="op">=</span> {</span>
<span id="cb18-150" class="hljs-ln-code"><a href="#cb18-150"></a>  <span class="dt">color</span><span class="op">:</span> <span class="st">'blue'</span><span class="op">,</span></span>
<span id="cb18-151" class="hljs-ln-code"><a href="#cb18-151"></a>  <span class="dt">width</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb18-152" class="hljs-ln-code"><a href="#cb18-152"></a>}<span class="op">;</span></span>
<span id="cb18-153" class="hljs-ln-code"><a href="#cb18-153"></a></span>
<span id="cb18-154" class="hljs-ln-code"><a href="#cb18-154"></a><span class="co">// Add the filtered streams to the map</span></span>
<span id="cb18-155" class="hljs-ln-code"><a href="#cb18-155"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(filteredStreams<span class="op">,</span> streamsVis<span class="op">,</span> <span class="st">'Filtered Streams'</span>)<span class="op">;</span></span>
<span id="cb18-156" class="hljs-ln-code"><a href="#cb18-156"></a></span>
<span id="cb18-157" class="hljs-ln-code"><a href="#cb18-157"></a><span class="co">// Add the filtered intersection points to the map</span></span>
<span id="cb18-158" class="hljs-ln-code"><a href="#cb18-158"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(intersectionPoints<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">'yellow'</span><span class="op">,</span><span class="dt">pointSize</span><span class="op">:</span> <span class="dv">10</span>}<span class="op">,</span> <span class="st">'Filtered Intersection Points'</span>)<span class="op">;</span></span>
<span id="cb18-159" class="hljs-ln-code"><a href="#cb18-159"></a></span>
<span id="cb18-160" class="hljs-ln-code"><a href="#cb18-160"></a><span class="co">// Add the filtered intersection points to the map</span></span>
<span id="cb18-161" class="hljs-ln-code"><a href="#cb18-161"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(</span>
<span id="cb18-162" class="hljs-ln-code"><a href="#cb18-162"></a>             intersectionPoints<span class="op">,</span></span>
<span id="cb18-163" class="hljs-ln-code"><a href="#cb18-163"></a>             {<span class="dt">color</span><span class="op">:</span> <span class="st">'yellow'</span><span class="op">,</span><span class="dt">pointSize</span><span class="op">:</span> <span class="dv">10</span>}<span class="op">,</span></span>
<span id="cb18-164" class="hljs-ln-code"><a href="#cb18-164"></a>             <span class="st">'Filtered Intersection Points'</span></span>
<span id="cb18-165" class="hljs-ln-code"><a href="#cb18-165"></a>             )<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="filtering-out-low-density-intersections-2" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Filtering out low density intersections</h2>
<div class="sourceCode" id="cb19" data-code-line-numbers="142-147"><pre class="sourceCode numberSource javascript number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><span id="cb19-1" class="hljs-ln-code"><a href="#cb19-1"></a><span class="co">// Load road data from US census bureau </span></span>
<span id="cb19-2" class="hljs-ln-code"><a href="#cb19-2"></a><span class="kw">var</span> roads <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"TIGER/2016/Roads"</span>)<span class="op">;</span></span>
<span id="cb19-3" class="hljs-ln-code"><a href="#cb19-3"></a></span>
<span id="cb19-4" class="hljs-ln-code"><a href="#cb19-4"></a><span class="co">// Load the WWF HydroSHEDS Free Flowing Rivers Network v1 dataset</span></span>
<span id="cb19-5" class="hljs-ln-code"><a href="#cb19-5"></a><span class="kw">var</span> hydrosheds <span class="op">=</span></span>
<span id="cb19-6" class="hljs-ln-code"><a href="#cb19-6"></a>ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"WWF/HydroSHEDS/v1/FreeFlowingRivers"</span>)<span class="op">;</span></span>
<span id="cb19-7" class="hljs-ln-code"><a href="#cb19-7"></a></span>
<span id="cb19-8" class="hljs-ln-code"><a href="#cb19-8"></a><span class="co">// Load the population density data</span></span>
<span id="cb19-9" class="hljs-ln-code"><a href="#cb19-9"></a><span class="kw">var</span> popDens <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">"CIESIN/GPWv411/GPW_Population_Density"</span>)<span class="op">;</span></span>
<span id="cb19-10" class="hljs-ln-code"><a href="#cb19-10"></a></span>
<span id="cb19-11" class="hljs-ln-code"><a href="#cb19-11"></a><span class="co">// Select just interstates using the MTFCC code</span></span>
<span id="cb19-12" class="hljs-ln-code"><a href="#cb19-12"></a><span class="kw">var</span> interstates <span class="op">=</span> roads<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'mtfcc'</span><span class="op">,</span> <span class="st">'S1100'</span>))<span class="op">;</span></span>
<span id="cb19-13" class="hljs-ln-code"><a href="#cb19-13"></a></span>
<span id="cb19-14" class="hljs-ln-code"><a href="#cb19-14"></a><span class="co">// Filter out streams with an order less than 4</span></span>
<span id="cb19-15" class="hljs-ln-code"><a href="#cb19-15"></a><span class="kw">var</span> filteredStreams <span class="op">=</span> </span>
<span id="cb19-16" class="hljs-ln-code"><a href="#cb19-16"></a>      hydrosheds<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lte</span>(<span class="st">'RIV_ORD'</span><span class="op">,</span> <span class="dv">4</span>))</span>
<span id="cb19-17" class="hljs-ln-code"><a href="#cb19-17"></a>                <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'COUNTRY'</span><span class="op">,</span><span class="st">'United States'</span>))<span class="op">;</span></span>
<span id="cb19-18" class="hljs-ln-code"><a href="#cb19-18"></a></span>
<span id="cb19-19" class="hljs-ln-code"><a href="#cb19-19"></a><span class="co">//Take the 1st population density map within the given date arange</span></span>
<span id="cb19-20" class="hljs-ln-code"><a href="#cb19-20"></a><span class="kw">var</span> popDensYear <span class="op">=</span> popDens<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">'2010-01-01'</span><span class="op">,</span> <span class="st">'2019-12-31'</span>))<span class="op">.</span><span class="fu">first</span>()<span class="op">;</span></span>
<span id="cb19-21" class="hljs-ln-code"><a href="#cb19-21"></a></span>
<span id="cb19-22" class="hljs-ln-code"><a href="#cb19-22"></a><span class="co">// Perform a spatial join between filteredStreams</span></span>
<span id="cb19-23" class="hljs-ln-code"><a href="#cb19-23"></a><span class="co">// and interstates FeatureCollections</span></span>
<span id="cb19-24" class="hljs-ln-code"><a href="#cb19-24"></a><span class="kw">var</span> join <span class="op">=</span> ee<span class="op">.</span><span class="at">Join</span><span class="op">.</span><span class="fu">simple</span>()<span class="op">;</span></span>
<span id="cb19-25" class="hljs-ln-code"><a href="#cb19-25"></a><span class="kw">var</span> filter <span class="op">=</span> ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">intersects</span>({</span>
<span id="cb19-26" class="hljs-ln-code"><a href="#cb19-26"></a>  <span class="dt">leftField</span><span class="op">:</span> <span class="st">'.geo'</span><span class="op">,</span></span>
<span id="cb19-27" class="hljs-ln-code"><a href="#cb19-27"></a>  <span class="dt">rightField</span><span class="op">:</span> <span class="st">'.geo'</span></span>
<span id="cb19-28" class="hljs-ln-code"><a href="#cb19-28"></a>})<span class="op">;</span></span>
<span id="cb19-29" class="hljs-ln-code"><a href="#cb19-29"></a></span>
<span id="cb19-30" class="hljs-ln-code"><a href="#cb19-30"></a><span class="kw">var</span> intersectionLines <span class="op">=</span> join<span class="op">.</span><span class="fu">apply</span>(</span>
<span id="cb19-31" class="hljs-ln-code"><a href="#cb19-31"></a>                              filteredStreams<span class="op">,</span> </span>
<span id="cb19-32" class="hljs-ln-code"><a href="#cb19-32"></a>                              interstates<span class="op">,</span></span>
<span id="cb19-33" class="hljs-ln-code"><a href="#cb19-33"></a>                              filter)<span class="op">;</span></span>
<span id="cb19-34" class="hljs-ln-code"><a href="#cb19-34"></a></span>
<span id="cb19-35" class="hljs-ln-code"><a href="#cb19-35"></a><span class="co">// Sort by a random number and select the first N features</span></span>
<span id="cb19-36" class="hljs-ln-code"><a href="#cb19-36"></a><span class="kw">var</span> selectedLines <span class="op">=</span> intersectionLines<span class="op">.</span><span class="fu">sort</span>(<span class="st">'random'</span>)<span class="op">.</span><span class="fu">limit</span>(<span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb19-37" class="hljs-ln-code"><a href="#cb19-37"></a></span>
<span id="cb19-38" class="hljs-ln-code"><a href="#cb19-38"></a><span class="co">// Function to convert line geometry to a point </span></span>
<span id="cb19-39" class="hljs-ln-code"><a href="#cb19-39"></a><span class="kw">var</span> lineToPoint <span class="op">=</span> <span class="kw">function</span>(feature) {</span>
<span id="cb19-40" class="hljs-ln-code"><a href="#cb19-40"></a>  <span class="co">// Get the geometry</span></span>
<span id="cb19-41" class="hljs-ln-code"><a href="#cb19-41"></a>  <span class="kw">var</span> geom <span class="op">=</span> feature<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb19-42" class="hljs-ln-code"><a href="#cb19-42"></a>  <span class="co">// Get the centroid of the geometry</span></span>
<span id="cb19-43" class="hljs-ln-code"><a href="#cb19-43"></a>  <span class="kw">var</span> centroid <span class="op">=</span> geom<span class="op">.</span><span class="fu">centroid</span>()<span class="op">;</span></span>
<span id="cb19-44" class="hljs-ln-code"><a href="#cb19-44"></a>  <span class="co">// Create a new point feature</span></span>
<span id="cb19-45" class="hljs-ln-code"><a href="#cb19-45"></a>  <span class="kw">var</span> pointFeature <span class="op">=</span> ee<span class="op">.</span><span class="fu">Feature</span>(centroid<span class="op">,</span> feature<span class="op">.</span><span class="fu">toDictionary</span>())<span class="op">;</span></span>
<span id="cb19-46" class="hljs-ln-code"><a href="#cb19-46"></a>  <span class="cf">return</span> pointFeature<span class="op">;</span></span>
<span id="cb19-47" class="hljs-ln-code"><a href="#cb19-47"></a>}<span class="op">;</span></span>
<span id="cb19-48" class="hljs-ln-code"><a href="#cb19-48"></a></span>
<span id="cb19-49" class="hljs-ln-code"><a href="#cb19-49"></a><span class="co">// Apply the lineToPoint function to each element</span></span>
<span id="cb19-50" class="hljs-ln-code"><a href="#cb19-50"></a><span class="co">// in intersectionPoints</span></span>
<span id="cb19-51" class="hljs-ln-code"><a href="#cb19-51"></a><span class="kw">var</span> intersectionPoints <span class="op">=</span> selectedLines<span class="op">.</span><span class="fu">map</span>(lineToPoint)<span class="op">;</span></span>
<span id="cb19-52" class="hljs-ln-code"><a href="#cb19-52"></a></span>
<span id="cb19-53" class="hljs-ln-code"><a href="#cb19-53"></a><span class="co">// Convert the intersectionPoints FeatureCollection to a List</span></span>
<span id="cb19-54" class="hljs-ln-code"><a href="#cb19-54"></a><span class="kw">var</span> pointsList <span class="op">=</span> intersectionPoints</span>
<span id="cb19-55" class="hljs-ln-code"><a href="#cb19-55"></a>                              <span class="op">.</span><span class="fu">toList</span>(intersectionPoints<span class="op">.</span><span class="fu">size</span>())<span class="op">;</span></span>
<span id="cb19-56" class="hljs-ln-code"><a href="#cb19-56"></a></span>
<span id="cb19-57" class="hljs-ln-code"><a href="#cb19-57"></a><span class="co">// Function to buffer a point and set an ID</span></span>
<span id="cb19-58" class="hljs-ln-code"><a href="#cb19-58"></a><span class="kw">var</span> bufferAndSetID <span class="op">=</span> <span class="kw">function</span>(index) {</span>
<span id="cb19-59" class="hljs-ln-code"><a href="#cb19-59"></a>  <span class="co">// Get the point</span></span>
<span id="cb19-60" class="hljs-ln-code"><a href="#cb19-60"></a>  <span class="kw">var</span> point <span class="op">=</span> ee<span class="op">.</span><span class="fu">Feature</span>(pointsList<span class="op">.</span><span class="fu">get</span>(index))<span class="op">;</span></span>
<span id="cb19-61" class="hljs-ln-code"><a href="#cb19-61"></a>  <span class="co">// Buffer the point</span></span>
<span id="cb19-62" class="hljs-ln-code"><a href="#cb19-62"></a>  <span class="kw">var</span> bufferedPoint <span class="op">=</span> point<span class="op">.</span><span class="fu">buffer</span>(<span class="dv">10000</span>)<span class="op">;</span></span>
<span id="cb19-63" class="hljs-ln-code"><a href="#cb19-63"></a>  <span class="co">// Set the ID</span></span>
<span id="cb19-64" class="hljs-ln-code"><a href="#cb19-64"></a>  <span class="kw">var</span> bufferedPointWithID <span class="op">=</span> bufferedPoint<span class="op">.</span><span class="fu">set</span>(<span class="st">'ID'</span><span class="op">,</span> index)<span class="op">;</span></span>
<span id="cb19-65" class="hljs-ln-code"><a href="#cb19-65"></a>  <span class="co">// Return the buffered point with ID</span></span>
<span id="cb19-66" class="hljs-ln-code"><a href="#cb19-66"></a>  <span class="cf">return</span> bufferedPointWithID<span class="op">;</span></span>
<span id="cb19-67" class="hljs-ln-code"><a href="#cb19-67"></a>}<span class="op">;</span></span>
<span id="cb19-68" class="hljs-ln-code"><a href="#cb19-68"></a></span>
<span id="cb19-69" class="hljs-ln-code"><a href="#cb19-69"></a><span class="co">// Create a sequence of numbers to use as IDs</span></span>
<span id="cb19-70" class="hljs-ln-code"><a href="#cb19-70"></a><span class="kw">var</span> ids <span class="op">=</span> ee<span class="op">.</span><span class="at">List</span><span class="op">.</span><span class="fu">sequence</span>(</span>
<span id="cb19-71" class="hljs-ln-code"><a href="#cb19-71"></a>                           <span class="dv">0</span><span class="op">,</span></span>
<span id="cb19-72" class="hljs-ln-code"><a href="#cb19-72"></a>                           intersectionPoints<span class="op">.</span><span class="fu">size</span>()<span class="op">.</span><span class="fu">subtract</span>(<span class="dv">1</span>)</span>
<span id="cb19-73" class="hljs-ln-code"><a href="#cb19-73"></a>                          )<span class="op">;</span></span>
<span id="cb19-74" class="hljs-ln-code"><a href="#cb19-74"></a></span>
<span id="cb19-75" class="hljs-ln-code"><a href="#cb19-75"></a><span class="co">// Create a buffer at every intersection points</span></span>
<span id="cb19-76" class="hljs-ln-code"><a href="#cb19-76"></a><span class="co">// using the id's you just created</span></span>
<span id="cb19-77" class="hljs-ln-code"><a href="#cb19-77"></a><span class="kw">var</span> bufferedPoints <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(ids<span class="op">.</span><span class="fu">map</span>(bufferAndSetID))<span class="op">;</span></span>
<span id="cb19-78" class="hljs-ln-code"><a href="#cb19-78"></a></span>
<span id="cb19-79" class="hljs-ln-code"><a href="#cb19-79"></a><span class="co">// Merge the buffered geometries</span></span>
<span id="cb19-80" class="hljs-ln-code"><a href="#cb19-80"></a><span class="kw">var</span> bufferedGeometries <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span></span>
<span id="cb19-81" class="hljs-ln-code"><a href="#cb19-81"></a>                           <span class="op">.</span><span class="fu">MultiPolygon</span>(bufferedPoints</span>
<span id="cb19-82" class="hljs-ln-code"><a href="#cb19-82"></a>                                          <span class="op">.</span><span class="fu">geometry</span>()</span>
<span id="cb19-83" class="hljs-ln-code"><a href="#cb19-83"></a>                                          <span class="op">.</span><span class="fu">coordinates</span>())<span class="op">;</span></span>
<span id="cb19-84" class="hljs-ln-code"><a href="#cb19-84"></a></span>
<span id="cb19-85" class="hljs-ln-code"><a href="#cb19-85"></a><span class="co">// Clip the population density image to the buffered geometries</span></span>
<span id="cb19-86" class="hljs-ln-code"><a href="#cb19-86"></a><span class="kw">var</span> popDensYearBuffered <span class="op">=</span> popDensYear<span class="op">.</span><span class="fu">clip</span>(bufferedGeometries)<span class="op">;</span></span>
<span id="cb19-87" class="hljs-ln-code"><a href="#cb19-87"></a></span>
<span id="cb19-88" class="hljs-ln-code"><a href="#cb19-88"></a><span class="co">// Function to sample random points within each buffered area</span></span>
<span id="cb19-89" class="hljs-ln-code"><a href="#cb19-89"></a><span class="kw">var</span> samplePoints <span class="op">=</span> <span class="kw">function</span> (feature) {</span>
<span id="cb19-90" class="hljs-ln-code"><a href="#cb19-90"></a>  <span class="kw">var</span> geometry <span class="op">=</span> feature<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb19-91" class="hljs-ln-code"><a href="#cb19-91"></a>  <span class="kw">var</span> randomPoints <span class="op">=</span> ee<span class="op">.</span><span class="at">FeatureCollection</span><span class="op">.</span><span class="fu">randomPoints</span>(geometry<span class="op">,</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb19-92" class="hljs-ln-code"><a href="#cb19-92"></a>  <span class="kw">var</span> sampledPoints <span class="op">=</span> popDensYearBuffered<span class="op">.</span><span class="fu">sampleRegions</span>({</span>
<span id="cb19-93" class="hljs-ln-code"><a href="#cb19-93"></a>    <span class="dt">collection</span><span class="op">:</span> randomPoints<span class="op">,</span></span>
<span id="cb19-94" class="hljs-ln-code"><a href="#cb19-94"></a>    <span class="dt">scale</span><span class="op">:</span> <span class="dv">1000</span><span class="op">,</span></span>
<span id="cb19-95" class="hljs-ln-code"><a href="#cb19-95"></a>    <span class="dt">tileScale</span><span class="op">:</span> <span class="dv">16</span></span>
<span id="cb19-96" class="hljs-ln-code"><a href="#cb19-96"></a>  })</span>
<span id="cb19-97" class="hljs-ln-code"><a href="#cb19-97"></a>  <span class="co">// Add the buffered area ID to each sampled point</span></span>
<span id="cb19-98" class="hljs-ln-code"><a href="#cb19-98"></a>  sampledPoints <span class="op">=</span> sampledPoints<span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(point) {</span>
<span id="cb19-99" class="hljs-ln-code"><a href="#cb19-99"></a>    <span class="cf">return</span> point<span class="op">.</span><span class="fu">set</span>(<span class="st">'BufferedAreaID'</span><span class="op">,</span> feature<span class="op">.</span><span class="fu">get</span>(<span class="st">'ID'</span>))<span class="op">;</span></span>
<span id="cb19-100" class="hljs-ln-code"><a href="#cb19-100"></a>  })<span class="op">;</span></span>
<span id="cb19-101" class="hljs-ln-code"><a href="#cb19-101"></a>  <span class="cf">return</span> sampledPoints<span class="op">;</span></span>
<span id="cb19-102" class="hljs-ln-code"><a href="#cb19-102"></a>}<span class="op">;</span></span>
<span id="cb19-103" class="hljs-ln-code"><a href="#cb19-103"></a></span>
<span id="cb19-104" class="hljs-ln-code"><a href="#cb19-104"></a><span class="co">// Sample 10 random points within each buffered area</span></span>
<span id="cb19-105" class="hljs-ln-code"><a href="#cb19-105"></a><span class="kw">var</span> sampledPoints <span class="op">=</span> bufferedPoints<span class="op">.</span><span class="fu">map</span>(samplePoints)<span class="op">.</span><span class="fu">flatten</span>()<span class="op">;</span></span>
<span id="cb19-106" class="hljs-ln-code"><a href="#cb19-106"></a></span>
<span id="cb19-107" class="hljs-ln-code"><a href="#cb19-107"></a><span class="co">// Define a reducer that calculates the mean 'population_density'</span></span>
<span id="cb19-108" class="hljs-ln-code"><a href="#cb19-108"></a><span class="kw">var</span> meanReducer <span class="op">=</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>()<span class="op">;</span></span>
<span id="cb19-109" class="hljs-ln-code"><a href="#cb19-109"></a></span>
<span id="cb19-110" class="hljs-ln-code"><a href="#cb19-110"></a><span class="co">// Group the 'sampledPoints' FeatureCollection by 'BufferedAreaID' </span></span>
<span id="cb19-111" class="hljs-ln-code"><a href="#cb19-111"></a><span class="co">// and calculate the mean 'population_density' for each group</span></span>
<span id="cb19-112" class="hljs-ln-code"><a href="#cb19-112"></a><span class="kw">var</span> meanPopDens <span class="op">=</span> sampledPoints<span class="op">.</span><span class="fu">reduceColumns</span>({</span>
<span id="cb19-113" class="hljs-ln-code"><a href="#cb19-113"></a>  <span class="dt">reducer</span><span class="op">:</span> meanReducer<span class="op">.</span><span class="fu">group</span>({</span>
<span id="cb19-114" class="hljs-ln-code"><a href="#cb19-114"></a>    <span class="dt">groupField</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb19-115" class="hljs-ln-code"><a href="#cb19-115"></a>    <span class="dt">groupName</span><span class="op">:</span> <span class="st">'BufferedAreaID'</span><span class="op">,</span></span>
<span id="cb19-116" class="hljs-ln-code"><a href="#cb19-116"></a>  })<span class="op">,</span></span>
<span id="cb19-117" class="hljs-ln-code"><a href="#cb19-117"></a>  <span class="dt">selectors</span><span class="op">:</span> [<span class="st">'BufferedAreaID'</span><span class="op">,</span> <span class="st">'population_density'</span>]</span>
<span id="cb19-118" class="hljs-ln-code"><a href="#cb19-118"></a>})<span class="op">;</span></span>
<span id="cb19-119" class="hljs-ln-code"><a href="#cb19-119"></a></span>
<span id="cb19-120" class="hljs-ln-code"><a href="#cb19-120"></a><span class="co">// Transform the output of the reduceColumns method</span></span>
<span id="cb19-121" class="hljs-ln-code"><a href="#cb19-121"></a><span class="co">// to a FeatureCollection</span></span>
<span id="cb19-122" class="hljs-ln-code"><a href="#cb19-122"></a><span class="kw">var</span> meanPopDensList <span class="op">=</span> ee<span class="op">.</span><span class="fu">List</span>(meanPopDens<span class="op">.</span><span class="fu">get</span>(<span class="st">'groups'</span>))<span class="op">;</span></span>
<span id="cb19-123" class="hljs-ln-code"><a href="#cb19-123"></a><span class="kw">var</span> meanPopDensFC <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(</span>
<span id="cb19-124" class="hljs-ln-code"><a href="#cb19-124"></a>                          meanPopDensList<span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(el)</span>
<span id="cb19-125" class="hljs-ln-code"><a href="#cb19-125"></a>                                      {</span>
<span id="cb19-126" class="hljs-ln-code"><a href="#cb19-126"></a>                                        <span class="kw">var</span> dict <span class="op">=</span> ee<span class="op">.</span><span class="fu">Dictionary</span>(el)<span class="op">;</span></span>
<span id="cb19-127" class="hljs-ln-code"><a href="#cb19-127"></a>                                        <span class="cf">return</span> ee<span class="op">.</span><span class="fu">Feature</span>(<span class="kw">null</span><span class="op">,</span> dict)<span class="op">;</span></span>
<span id="cb19-128" class="hljs-ln-code"><a href="#cb19-128"></a>                                      }))<span class="op">;</span></span>
<span id="cb19-129" class="hljs-ln-code"><a href="#cb19-129"></a></span>
<span id="cb19-130" class="hljs-ln-code"><a href="#cb19-130"></a><span class="co">// Filter the meanPopDensFC by the 'mean' property</span></span>
<span id="cb19-131" class="hljs-ln-code"><a href="#cb19-131"></a><span class="kw">var</span> filteredMeanPopDens <span class="op">=</span> meanPopDensFC<span class="op">.</span><span class="fu">filter</span>(</span>
<span id="cb19-132" class="hljs-ln-code"><a href="#cb19-132"></a>                                              ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">gt</span>(</span>
<span id="cb19-133" class="hljs-ln-code"><a href="#cb19-133"></a>                                                <span class="st">'mean'</span><span class="op">,</span> <span class="dv">100</span>)</span>
<span id="cb19-134" class="hljs-ln-code"><a href="#cb19-134"></a>                                              )<span class="op">;</span></span>
<span id="cb19-135" class="hljs-ln-code"><a href="#cb19-135"></a></span>
<span id="cb19-136" class="hljs-ln-code"><a href="#cb19-136"></a><span class="co">// Get the list indices of the points with a</span></span>
<span id="cb19-137" class="hljs-ln-code"><a href="#cb19-137"></a><span class="co">// population density greater than 100 people per sq km</span></span>
<span id="cb19-138" class="hljs-ln-code"><a href="#cb19-138"></a><span class="kw">var</span> filteredIds <span class="op">=</span> filteredMeanPopDens<span class="op">.</span><span class="fu">aggregate_array</span>(</span>
<span id="cb19-139" class="hljs-ln-code"><a href="#cb19-139"></a>                                      <span class="st">'BufferedAreaID'</span></span>
<span id="cb19-140" class="hljs-ln-code"><a href="#cb19-140"></a>                                      )<span class="op">;</span></span>
<span id="cb19-141" class="hljs-ln-code"><a href="#cb19-141"></a></span>
<span id="cb19-142" class="hljs-ln-code"><a href="#cb19-142"></a><span class="co">// Get intersection points with high density</span></span>
<span id="cb19-143" class="hljs-ln-code"><a href="#cb19-143"></a><span class="kw">var</span> highDensityPoints <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(</span>
<span id="cb19-144" class="hljs-ln-code"><a href="#cb19-144"></a>                              filteredIds<span class="op">.</span><span class="at">map</span></span>
<span id="cb19-145" class="hljs-ln-code"><a href="#cb19-145"></a>                                  (<span class="kw">function</span>(id) {</span>
<span id="cb19-146" class="hljs-ln-code"><a href="#cb19-146"></a>                                     <span class="cf">return</span> pointsList<span class="op">.</span><span class="fu">get</span>(id)<span class="op">;</span></span>
<span id="cb19-147" class="hljs-ln-code"><a href="#cb19-147"></a>                                    }))<span class="op">;</span></span>
<span id="cb19-148" class="hljs-ln-code"><a href="#cb19-148"></a></span>
<span id="cb19-149" class="hljs-ln-code"><a href="#cb19-149"></a><span class="co">// Center the map on the continental USA</span></span>
<span id="cb19-150" class="hljs-ln-code"><a href="#cb19-150"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">setCenter</span>(<span class="op">-</span><span class="fl">98.5833</span><span class="op">,</span> <span class="fl">39.8333</span><span class="op">,</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb19-151" class="hljs-ln-code"><a href="#cb19-151"></a></span>
<span id="cb19-152" class="hljs-ln-code"><a href="#cb19-152"></a><span class="co">// Display the filtered FeatureCollection</span></span>
<span id="cb19-153" class="hljs-ln-code"><a href="#cb19-153"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(interstates<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">'green'</span>}<span class="op">,</span> <span class="st">'Interstates'</span>)<span class="op">;</span></span>
<span id="cb19-154" class="hljs-ln-code"><a href="#cb19-154"></a></span>
<span id="cb19-155" class="hljs-ln-code"><a href="#cb19-155"></a><span class="co">// Set visualization parameters</span></span>
<span id="cb19-156" class="hljs-ln-code"><a href="#cb19-156"></a><span class="kw">var</span> streamsVis <span class="op">=</span> {</span>
<span id="cb19-157" class="hljs-ln-code"><a href="#cb19-157"></a>  <span class="dt">color</span><span class="op">:</span> <span class="st">'blue'</span><span class="op">,</span></span>
<span id="cb19-158" class="hljs-ln-code"><a href="#cb19-158"></a>  <span class="dt">width</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb19-159" class="hljs-ln-code"><a href="#cb19-159"></a>}<span class="op">;</span></span>
<span id="cb19-160" class="hljs-ln-code"><a href="#cb19-160"></a></span>
<span id="cb19-161" class="hljs-ln-code"><a href="#cb19-161"></a><span class="co">// Add the filtered streams to the map</span></span>
<span id="cb19-162" class="hljs-ln-code"><a href="#cb19-162"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(filteredStreams<span class="op">,</span> streamsVis<span class="op">,</span> <span class="st">'Filtered Streams'</span>)<span class="op">;</span></span>
<span id="cb19-163" class="hljs-ln-code"><a href="#cb19-163"></a></span>
<span id="cb19-164" class="hljs-ln-code"><a href="#cb19-164"></a><span class="co">// Add the filtered intersection points to the map</span></span>
<span id="cb19-165" class="hljs-ln-code"><a href="#cb19-165"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(intersectionPoints<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">'yellow'</span><span class="op">,</span><span class="dt">pointSize</span><span class="op">:</span> <span class="dv">10</span>}<span class="op">,</span> <span class="st">'Filtered Intersection Points'</span>)<span class="op">;</span></span>
<span id="cb19-166" class="hljs-ln-code"><a href="#cb19-166"></a></span>
<span id="cb19-167" class="hljs-ln-code"><a href="#cb19-167"></a><span class="co">// Add the filtered intersection points to the map</span></span>
<span id="cb19-168" class="hljs-ln-code"><a href="#cb19-168"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(</span>
<span id="cb19-169" class="hljs-ln-code"><a href="#cb19-169"></a>             intersectionPoints<span class="op">,</span></span>
<span id="cb19-170" class="hljs-ln-code"><a href="#cb19-170"></a>             {<span class="dt">color</span><span class="op">:</span> <span class="st">'yellow'</span><span class="op">,</span><span class="dt">pointSize</span><span class="op">:</span> <span class="dv">10</span>}<span class="op">,</span></span>
<span id="cb19-171" class="hljs-ln-code"><a href="#cb19-171"></a>             <span class="st">'Filtered Intersection Points'</span></span>
<span id="cb19-172" class="hljs-ln-code"><a href="#cb19-172"></a>             )<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="display-port-candidates" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Display port candidates</h2>
<div class="sourceCode" id="cb20" data-code-line-numbers="174-179"><pre class="sourceCode numberSource javascript number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><span id="cb20-1" class="hljs-ln-code"><a href="#cb20-1"></a><span class="co">// Load road data from US census bureau </span></span>
<span id="cb20-2" class="hljs-ln-code"><a href="#cb20-2"></a><span class="kw">var</span> roads <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"TIGER/2016/Roads"</span>)<span class="op">;</span></span>
<span id="cb20-3" class="hljs-ln-code"><a href="#cb20-3"></a></span>
<span id="cb20-4" class="hljs-ln-code"><a href="#cb20-4"></a><span class="co">// Load the WWF HydroSHEDS Free Flowing Rivers Network v1 dataset</span></span>
<span id="cb20-5" class="hljs-ln-code"><a href="#cb20-5"></a><span class="kw">var</span> hydrosheds <span class="op">=</span></span>
<span id="cb20-6" class="hljs-ln-code"><a href="#cb20-6"></a>ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"WWF/HydroSHEDS/v1/FreeFlowingRivers"</span>)<span class="op">;</span></span>
<span id="cb20-7" class="hljs-ln-code"><a href="#cb20-7"></a></span>
<span id="cb20-8" class="hljs-ln-code"><a href="#cb20-8"></a><span class="co">// Load the population density data</span></span>
<span id="cb20-9" class="hljs-ln-code"><a href="#cb20-9"></a><span class="kw">var</span> popDens <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">"CIESIN/GPWv411/GPW_Population_Density"</span>)<span class="op">;</span></span>
<span id="cb20-10" class="hljs-ln-code"><a href="#cb20-10"></a></span>
<span id="cb20-11" class="hljs-ln-code"><a href="#cb20-11"></a><span class="co">// Select just interstates using the MTFCC code</span></span>
<span id="cb20-12" class="hljs-ln-code"><a href="#cb20-12"></a><span class="kw">var</span> interstates <span class="op">=</span> roads<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'mtfcc'</span><span class="op">,</span> <span class="st">'S1100'</span>))<span class="op">;</span></span>
<span id="cb20-13" class="hljs-ln-code"><a href="#cb20-13"></a></span>
<span id="cb20-14" class="hljs-ln-code"><a href="#cb20-14"></a><span class="co">// Filter out streams with an order less than 4</span></span>
<span id="cb20-15" class="hljs-ln-code"><a href="#cb20-15"></a><span class="kw">var</span> filteredStreams <span class="op">=</span> </span>
<span id="cb20-16" class="hljs-ln-code"><a href="#cb20-16"></a>      hydrosheds<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lte</span>(<span class="st">'RIV_ORD'</span><span class="op">,</span> <span class="dv">4</span>))</span>
<span id="cb20-17" class="hljs-ln-code"><a href="#cb20-17"></a>                <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'COUNTRY'</span><span class="op">,</span><span class="st">'United States'</span>))<span class="op">;</span></span>
<span id="cb20-18" class="hljs-ln-code"><a href="#cb20-18"></a></span>
<span id="cb20-19" class="hljs-ln-code"><a href="#cb20-19"></a><span class="co">//Take the 1st population density map within the given date arange</span></span>
<span id="cb20-20" class="hljs-ln-code"><a href="#cb20-20"></a><span class="kw">var</span> popDensYear <span class="op">=</span> popDens<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">'2010-01-01'</span><span class="op">,</span> <span class="st">'2019-12-31'</span>))<span class="op">.</span><span class="fu">first</span>()<span class="op">;</span></span>
<span id="cb20-21" class="hljs-ln-code"><a href="#cb20-21"></a></span>
<span id="cb20-22" class="hljs-ln-code"><a href="#cb20-22"></a><span class="co">// Perform a spatial join between filteredStreams</span></span>
<span id="cb20-23" class="hljs-ln-code"><a href="#cb20-23"></a><span class="co">// and interstates FeatureCollections</span></span>
<span id="cb20-24" class="hljs-ln-code"><a href="#cb20-24"></a><span class="kw">var</span> join <span class="op">=</span> ee<span class="op">.</span><span class="at">Join</span><span class="op">.</span><span class="fu">simple</span>()<span class="op">;</span></span>
<span id="cb20-25" class="hljs-ln-code"><a href="#cb20-25"></a><span class="kw">var</span> filter <span class="op">=</span> ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">intersects</span>({</span>
<span id="cb20-26" class="hljs-ln-code"><a href="#cb20-26"></a>  <span class="dt">leftField</span><span class="op">:</span> <span class="st">'.geo'</span><span class="op">,</span></span>
<span id="cb20-27" class="hljs-ln-code"><a href="#cb20-27"></a>  <span class="dt">rightField</span><span class="op">:</span> <span class="st">'.geo'</span></span>
<span id="cb20-28" class="hljs-ln-code"><a href="#cb20-28"></a>})<span class="op">;</span></span>
<span id="cb20-29" class="hljs-ln-code"><a href="#cb20-29"></a></span>
<span id="cb20-30" class="hljs-ln-code"><a href="#cb20-30"></a><span class="kw">var</span> intersectionLines <span class="op">=</span> join<span class="op">.</span><span class="fu">apply</span>(</span>
<span id="cb20-31" class="hljs-ln-code"><a href="#cb20-31"></a>                              filteredStreams<span class="op">,</span> </span>
<span id="cb20-32" class="hljs-ln-code"><a href="#cb20-32"></a>                              interstates<span class="op">,</span></span>
<span id="cb20-33" class="hljs-ln-code"><a href="#cb20-33"></a>                              filter)<span class="op">;</span></span>
<span id="cb20-34" class="hljs-ln-code"><a href="#cb20-34"></a></span>
<span id="cb20-35" class="hljs-ln-code"><a href="#cb20-35"></a><span class="co">// Sort by a random number and select the first N features</span></span>
<span id="cb20-36" class="hljs-ln-code"><a href="#cb20-36"></a><span class="kw">var</span> selectedLines <span class="op">=</span> intersectionLines<span class="op">.</span><span class="fu">sort</span>(<span class="st">'random'</span>)<span class="op">.</span><span class="fu">limit</span>(<span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb20-37" class="hljs-ln-code"><a href="#cb20-37"></a></span>
<span id="cb20-38" class="hljs-ln-code"><a href="#cb20-38"></a><span class="co">// Function to convert line geometry to a point </span></span>
<span id="cb20-39" class="hljs-ln-code"><a href="#cb20-39"></a><span class="kw">var</span> lineToPoint <span class="op">=</span> <span class="kw">function</span>(feature) {</span>
<span id="cb20-40" class="hljs-ln-code"><a href="#cb20-40"></a>  <span class="co">// Get the geometry</span></span>
<span id="cb20-41" class="hljs-ln-code"><a href="#cb20-41"></a>  <span class="kw">var</span> geom <span class="op">=</span> feature<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb20-42" class="hljs-ln-code"><a href="#cb20-42"></a>  <span class="co">// Get the centroid of the geometry</span></span>
<span id="cb20-43" class="hljs-ln-code"><a href="#cb20-43"></a>  <span class="kw">var</span> centroid <span class="op">=</span> geom<span class="op">.</span><span class="fu">centroid</span>()<span class="op">;</span></span>
<span id="cb20-44" class="hljs-ln-code"><a href="#cb20-44"></a>  <span class="co">// Create a new point feature</span></span>
<span id="cb20-45" class="hljs-ln-code"><a href="#cb20-45"></a>  <span class="kw">var</span> pointFeature <span class="op">=</span> ee<span class="op">.</span><span class="fu">Feature</span>(centroid<span class="op">,</span> feature<span class="op">.</span><span class="fu">toDictionary</span>())<span class="op">;</span></span>
<span id="cb20-46" class="hljs-ln-code"><a href="#cb20-46"></a>  <span class="cf">return</span> pointFeature<span class="op">;</span></span>
<span id="cb20-47" class="hljs-ln-code"><a href="#cb20-47"></a>}<span class="op">;</span></span>
<span id="cb20-48" class="hljs-ln-code"><a href="#cb20-48"></a></span>
<span id="cb20-49" class="hljs-ln-code"><a href="#cb20-49"></a><span class="co">// Apply the lineToPoint function to each element</span></span>
<span id="cb20-50" class="hljs-ln-code"><a href="#cb20-50"></a><span class="co">// in intersectionPoints</span></span>
<span id="cb20-51" class="hljs-ln-code"><a href="#cb20-51"></a><span class="kw">var</span> intersectionPoints <span class="op">=</span> selectedLines<span class="op">.</span><span class="fu">map</span>(lineToPoint)<span class="op">;</span></span>
<span id="cb20-52" class="hljs-ln-code"><a href="#cb20-52"></a></span>
<span id="cb20-53" class="hljs-ln-code"><a href="#cb20-53"></a><span class="co">// Convert the intersectionPoints FeatureCollection to a List</span></span>
<span id="cb20-54" class="hljs-ln-code"><a href="#cb20-54"></a><span class="kw">var</span> pointsList <span class="op">=</span> intersectionPoints</span>
<span id="cb20-55" class="hljs-ln-code"><a href="#cb20-55"></a>                              <span class="op">.</span><span class="fu">toList</span>(intersectionPoints<span class="op">.</span><span class="fu">size</span>())<span class="op">;</span></span>
<span id="cb20-56" class="hljs-ln-code"><a href="#cb20-56"></a></span>
<span id="cb20-57" class="hljs-ln-code"><a href="#cb20-57"></a><span class="co">// Function to buffer a point and set an ID</span></span>
<span id="cb20-58" class="hljs-ln-code"><a href="#cb20-58"></a><span class="kw">var</span> bufferAndSetID <span class="op">=</span> <span class="kw">function</span>(index) {</span>
<span id="cb20-59" class="hljs-ln-code"><a href="#cb20-59"></a>  <span class="co">// Get the point</span></span>
<span id="cb20-60" class="hljs-ln-code"><a href="#cb20-60"></a>  <span class="kw">var</span> point <span class="op">=</span> ee<span class="op">.</span><span class="fu">Feature</span>(pointsList<span class="op">.</span><span class="fu">get</span>(index))<span class="op">;</span></span>
<span id="cb20-61" class="hljs-ln-code"><a href="#cb20-61"></a>  <span class="co">// Buffer the point</span></span>
<span id="cb20-62" class="hljs-ln-code"><a href="#cb20-62"></a>  <span class="kw">var</span> bufferedPoint <span class="op">=</span> point<span class="op">.</span><span class="fu">buffer</span>(<span class="dv">10000</span>)<span class="op">;</span></span>
<span id="cb20-63" class="hljs-ln-code"><a href="#cb20-63"></a>  <span class="co">// Set the ID</span></span>
<span id="cb20-64" class="hljs-ln-code"><a href="#cb20-64"></a>  <span class="kw">var</span> bufferedPointWithID <span class="op">=</span> bufferedPoint<span class="op">.</span><span class="fu">set</span>(<span class="st">'ID'</span><span class="op">,</span> index)<span class="op">;</span></span>
<span id="cb20-65" class="hljs-ln-code"><a href="#cb20-65"></a>  <span class="co">// Return the buffered point with ID</span></span>
<span id="cb20-66" class="hljs-ln-code"><a href="#cb20-66"></a>  <span class="cf">return</span> bufferedPointWithID<span class="op">;</span></span>
<span id="cb20-67" class="hljs-ln-code"><a href="#cb20-67"></a>}<span class="op">;</span></span>
<span id="cb20-68" class="hljs-ln-code"><a href="#cb20-68"></a></span>
<span id="cb20-69" class="hljs-ln-code"><a href="#cb20-69"></a><span class="co">// Create a sequence of numbers to use as IDs</span></span>
<span id="cb20-70" class="hljs-ln-code"><a href="#cb20-70"></a><span class="kw">var</span> ids <span class="op">=</span> ee<span class="op">.</span><span class="at">List</span><span class="op">.</span><span class="fu">sequence</span>(</span>
<span id="cb20-71" class="hljs-ln-code"><a href="#cb20-71"></a>                           <span class="dv">0</span><span class="op">,</span></span>
<span id="cb20-72" class="hljs-ln-code"><a href="#cb20-72"></a>                           intersectionPoints<span class="op">.</span><span class="fu">size</span>()<span class="op">.</span><span class="fu">subtract</span>(<span class="dv">1</span>)</span>
<span id="cb20-73" class="hljs-ln-code"><a href="#cb20-73"></a>                          )<span class="op">;</span></span>
<span id="cb20-74" class="hljs-ln-code"><a href="#cb20-74"></a></span>
<span id="cb20-75" class="hljs-ln-code"><a href="#cb20-75"></a><span class="co">// Create a buffer at every intersection points</span></span>
<span id="cb20-76" class="hljs-ln-code"><a href="#cb20-76"></a><span class="co">// using the id's you just created</span></span>
<span id="cb20-77" class="hljs-ln-code"><a href="#cb20-77"></a><span class="kw">var</span> bufferedPoints <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(ids<span class="op">.</span><span class="fu">map</span>(bufferAndSetID))<span class="op">;</span></span>
<span id="cb20-78" class="hljs-ln-code"><a href="#cb20-78"></a></span>
<span id="cb20-79" class="hljs-ln-code"><a href="#cb20-79"></a><span class="co">// Merge the buffered geometries</span></span>
<span id="cb20-80" class="hljs-ln-code"><a href="#cb20-80"></a><span class="kw">var</span> bufferedGeometries <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span></span>
<span id="cb20-81" class="hljs-ln-code"><a href="#cb20-81"></a>                           <span class="op">.</span><span class="fu">MultiPolygon</span>(bufferedPoints</span>
<span id="cb20-82" class="hljs-ln-code"><a href="#cb20-82"></a>                                          <span class="op">.</span><span class="fu">geometry</span>()</span>
<span id="cb20-83" class="hljs-ln-code"><a href="#cb20-83"></a>                                          <span class="op">.</span><span class="fu">coordinates</span>())<span class="op">;</span></span>
<span id="cb20-84" class="hljs-ln-code"><a href="#cb20-84"></a></span>
<span id="cb20-85" class="hljs-ln-code"><a href="#cb20-85"></a><span class="co">// Clip the population density image to the buffered geometries</span></span>
<span id="cb20-86" class="hljs-ln-code"><a href="#cb20-86"></a><span class="kw">var</span> popDensYearBuffered <span class="op">=</span> popDensYear<span class="op">.</span><span class="fu">clip</span>(bufferedGeometries)<span class="op">;</span></span>
<span id="cb20-87" class="hljs-ln-code"><a href="#cb20-87"></a></span>
<span id="cb20-88" class="hljs-ln-code"><a href="#cb20-88"></a><span class="co">// Function to sample random points within each buffered area</span></span>
<span id="cb20-89" class="hljs-ln-code"><a href="#cb20-89"></a><span class="kw">var</span> samplePoints <span class="op">=</span> <span class="kw">function</span> (feature) {</span>
<span id="cb20-90" class="hljs-ln-code"><a href="#cb20-90"></a>  <span class="kw">var</span> geometry <span class="op">=</span> feature<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb20-91" class="hljs-ln-code"><a href="#cb20-91"></a>  <span class="kw">var</span> randomPoints <span class="op">=</span> ee<span class="op">.</span><span class="at">FeatureCollection</span><span class="op">.</span><span class="fu">randomPoints</span>(geometry<span class="op">,</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb20-92" class="hljs-ln-code"><a href="#cb20-92"></a>  <span class="kw">var</span> sampledPoints <span class="op">=</span> popDensYearBuffered<span class="op">.</span><span class="fu">sampleRegions</span>({</span>
<span id="cb20-93" class="hljs-ln-code"><a href="#cb20-93"></a>    <span class="dt">collection</span><span class="op">:</span> randomPoints<span class="op">,</span></span>
<span id="cb20-94" class="hljs-ln-code"><a href="#cb20-94"></a>    <span class="dt">scale</span><span class="op">:</span> <span class="dv">1000</span><span class="op">,</span></span>
<span id="cb20-95" class="hljs-ln-code"><a href="#cb20-95"></a>    <span class="dt">tileScale</span><span class="op">:</span> <span class="dv">16</span></span>
<span id="cb20-96" class="hljs-ln-code"><a href="#cb20-96"></a>  })</span>
<span id="cb20-97" class="hljs-ln-code"><a href="#cb20-97"></a>  <span class="co">// Add the buffered area ID to each sampled point</span></span>
<span id="cb20-98" class="hljs-ln-code"><a href="#cb20-98"></a>  sampledPoints <span class="op">=</span> sampledPoints<span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(point) {</span>
<span id="cb20-99" class="hljs-ln-code"><a href="#cb20-99"></a>    <span class="cf">return</span> point<span class="op">.</span><span class="fu">set</span>(<span class="st">'BufferedAreaID'</span><span class="op">,</span> feature<span class="op">.</span><span class="fu">get</span>(<span class="st">'ID'</span>))<span class="op">;</span></span>
<span id="cb20-100" class="hljs-ln-code"><a href="#cb20-100"></a>  })<span class="op">;</span></span>
<span id="cb20-101" class="hljs-ln-code"><a href="#cb20-101"></a>  <span class="cf">return</span> sampledPoints<span class="op">;</span></span>
<span id="cb20-102" class="hljs-ln-code"><a href="#cb20-102"></a>}<span class="op">;</span></span>
<span id="cb20-103" class="hljs-ln-code"><a href="#cb20-103"></a></span>
<span id="cb20-104" class="hljs-ln-code"><a href="#cb20-104"></a><span class="co">// Sample 10 random points within each buffered area</span></span>
<span id="cb20-105" class="hljs-ln-code"><a href="#cb20-105"></a><span class="kw">var</span> sampledPoints <span class="op">=</span> bufferedPoints<span class="op">.</span><span class="fu">map</span>(samplePoints)<span class="op">.</span><span class="fu">flatten</span>()<span class="op">;</span></span>
<span id="cb20-106" class="hljs-ln-code"><a href="#cb20-106"></a></span>
<span id="cb20-107" class="hljs-ln-code"><a href="#cb20-107"></a><span class="co">// Define a reducer that calculates the mean 'population_density'</span></span>
<span id="cb20-108" class="hljs-ln-code"><a href="#cb20-108"></a><span class="kw">var</span> meanReducer <span class="op">=</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>()<span class="op">;</span></span>
<span id="cb20-109" class="hljs-ln-code"><a href="#cb20-109"></a></span>
<span id="cb20-110" class="hljs-ln-code"><a href="#cb20-110"></a><span class="co">// Group the 'sampledPoints' FeatureCollection by 'BufferedAreaID' </span></span>
<span id="cb20-111" class="hljs-ln-code"><a href="#cb20-111"></a><span class="co">// and calculate the mean 'population_density' for each group</span></span>
<span id="cb20-112" class="hljs-ln-code"><a href="#cb20-112"></a><span class="kw">var</span> meanPopDens <span class="op">=</span> sampledPoints<span class="op">.</span><span class="fu">reduceColumns</span>({</span>
<span id="cb20-113" class="hljs-ln-code"><a href="#cb20-113"></a>  <span class="dt">reducer</span><span class="op">:</span> meanReducer<span class="op">.</span><span class="fu">group</span>({</span>
<span id="cb20-114" class="hljs-ln-code"><a href="#cb20-114"></a>    <span class="dt">groupField</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb20-115" class="hljs-ln-code"><a href="#cb20-115"></a>    <span class="dt">groupName</span><span class="op">:</span> <span class="st">'BufferedAreaID'</span><span class="op">,</span></span>
<span id="cb20-116" class="hljs-ln-code"><a href="#cb20-116"></a>  })<span class="op">,</span></span>
<span id="cb20-117" class="hljs-ln-code"><a href="#cb20-117"></a>  <span class="dt">selectors</span><span class="op">:</span> [<span class="st">'BufferedAreaID'</span><span class="op">,</span> <span class="st">'population_density'</span>]</span>
<span id="cb20-118" class="hljs-ln-code"><a href="#cb20-118"></a>})<span class="op">;</span></span>
<span id="cb20-119" class="hljs-ln-code"><a href="#cb20-119"></a></span>
<span id="cb20-120" class="hljs-ln-code"><a href="#cb20-120"></a><span class="co">// Transform the output of the reduceColumns method</span></span>
<span id="cb20-121" class="hljs-ln-code"><a href="#cb20-121"></a><span class="co">// to a FeatureCollection</span></span>
<span id="cb20-122" class="hljs-ln-code"><a href="#cb20-122"></a><span class="kw">var</span> meanPopDensList <span class="op">=</span> ee<span class="op">.</span><span class="fu">List</span>(meanPopDens<span class="op">.</span><span class="fu">get</span>(<span class="st">'groups'</span>))<span class="op">;</span></span>
<span id="cb20-123" class="hljs-ln-code"><a href="#cb20-123"></a><span class="kw">var</span> meanPopDensFC <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(</span>
<span id="cb20-124" class="hljs-ln-code"><a href="#cb20-124"></a>                          meanPopDensList<span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(el)</span>
<span id="cb20-125" class="hljs-ln-code"><a href="#cb20-125"></a>                                      {</span>
<span id="cb20-126" class="hljs-ln-code"><a href="#cb20-126"></a>                                        <span class="kw">var</span> dict <span class="op">=</span> ee<span class="op">.</span><span class="fu">Dictionary</span>(el)<span class="op">;</span></span>
<span id="cb20-127" class="hljs-ln-code"><a href="#cb20-127"></a>                                        <span class="cf">return</span> ee<span class="op">.</span><span class="fu">Feature</span>(<span class="kw">null</span><span class="op">,</span> dict)<span class="op">;</span></span>
<span id="cb20-128" class="hljs-ln-code"><a href="#cb20-128"></a>                                      }))<span class="op">;</span></span>
<span id="cb20-129" class="hljs-ln-code"><a href="#cb20-129"></a></span>
<span id="cb20-130" class="hljs-ln-code"><a href="#cb20-130"></a><span class="co">// Filter the meanPopDensFC by the 'mean' property</span></span>
<span id="cb20-131" class="hljs-ln-code"><a href="#cb20-131"></a><span class="kw">var</span> filteredMeanPopDens <span class="op">=</span> meanPopDensFC<span class="op">.</span><span class="fu">filter</span>(</span>
<span id="cb20-132" class="hljs-ln-code"><a href="#cb20-132"></a>                                              ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">gt</span>(</span>
<span id="cb20-133" class="hljs-ln-code"><a href="#cb20-133"></a>                                                <span class="st">'mean'</span><span class="op">,</span> <span class="dv">100</span>)</span>
<span id="cb20-134" class="hljs-ln-code"><a href="#cb20-134"></a>                                              )<span class="op">;</span></span>
<span id="cb20-135" class="hljs-ln-code"><a href="#cb20-135"></a></span>
<span id="cb20-136" class="hljs-ln-code"><a href="#cb20-136"></a><span class="co">// Get the list indices of the points with a</span></span>
<span id="cb20-137" class="hljs-ln-code"><a href="#cb20-137"></a><span class="co">// population density greater than 100 people per sq km</span></span>
<span id="cb20-138" class="hljs-ln-code"><a href="#cb20-138"></a><span class="kw">var</span> filteredIds <span class="op">=</span> filteredMeanPopDens<span class="op">.</span><span class="fu">aggregate_array</span>(</span>
<span id="cb20-139" class="hljs-ln-code"><a href="#cb20-139"></a>                                      <span class="st">'BufferedAreaID'</span></span>
<span id="cb20-140" class="hljs-ln-code"><a href="#cb20-140"></a>                                      )<span class="op">;</span></span>
<span id="cb20-141" class="hljs-ln-code"><a href="#cb20-141"></a></span>
<span id="cb20-142" class="hljs-ln-code"><a href="#cb20-142"></a><span class="co">// Get intersection points with high density</span></span>
<span id="cb20-143" class="hljs-ln-code"><a href="#cb20-143"></a><span class="kw">var</span> highDensityPoints <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(</span>
<span id="cb20-144" class="hljs-ln-code"><a href="#cb20-144"></a>                              filteredIds<span class="op">.</span><span class="at">map</span></span>
<span id="cb20-145" class="hljs-ln-code"><a href="#cb20-145"></a>                                  (<span class="kw">function</span>(id) {</span>
<span id="cb20-146" class="hljs-ln-code"><a href="#cb20-146"></a>                                     <span class="cf">return</span> pointsList<span class="op">.</span><span class="fu">get</span>(id)<span class="op">;</span></span>
<span id="cb20-147" class="hljs-ln-code"><a href="#cb20-147"></a>                                    }))<span class="op">;</span></span>
<span id="cb20-148" class="hljs-ln-code"><a href="#cb20-148"></a></span>
<span id="cb20-149" class="hljs-ln-code"><a href="#cb20-149"></a><span class="co">// Center the map on the continental USA</span></span>
<span id="cb20-150" class="hljs-ln-code"><a href="#cb20-150"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">setCenter</span>(<span class="op">-</span><span class="fl">98.5833</span><span class="op">,</span> <span class="fl">39.8333</span><span class="op">,</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb20-151" class="hljs-ln-code"><a href="#cb20-151"></a></span>
<span id="cb20-152" class="hljs-ln-code"><a href="#cb20-152"></a><span class="co">// Display the filtered FeatureCollection</span></span>
<span id="cb20-153" class="hljs-ln-code"><a href="#cb20-153"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(interstates<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">'green'</span>}<span class="op">,</span> <span class="st">'Interstates'</span>)<span class="op">;</span></span>
<span id="cb20-154" class="hljs-ln-code"><a href="#cb20-154"></a></span>
<span id="cb20-155" class="hljs-ln-code"><a href="#cb20-155"></a><span class="co">// Set visualization parameters</span></span>
<span id="cb20-156" class="hljs-ln-code"><a href="#cb20-156"></a><span class="kw">var</span> streamsVis <span class="op">=</span> {</span>
<span id="cb20-157" class="hljs-ln-code"><a href="#cb20-157"></a>  <span class="dt">color</span><span class="op">:</span> <span class="st">'blue'</span><span class="op">,</span></span>
<span id="cb20-158" class="hljs-ln-code"><a href="#cb20-158"></a>  <span class="dt">width</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb20-159" class="hljs-ln-code"><a href="#cb20-159"></a>}<span class="op">;</span></span>
<span id="cb20-160" class="hljs-ln-code"><a href="#cb20-160"></a></span>
<span id="cb20-161" class="hljs-ln-code"><a href="#cb20-161"></a><span class="co">// Add the filtered streams to the map</span></span>
<span id="cb20-162" class="hljs-ln-code"><a href="#cb20-162"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(filteredStreams<span class="op">,</span> streamsVis<span class="op">,</span> <span class="st">'Filtered Streams'</span>)<span class="op">;</span></span>
<span id="cb20-163" class="hljs-ln-code"><a href="#cb20-163"></a></span>
<span id="cb20-164" class="hljs-ln-code"><a href="#cb20-164"></a><span class="co">// Add the filtered intersection points to the map</span></span>
<span id="cb20-165" class="hljs-ln-code"><a href="#cb20-165"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(intersectionPoints<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">'yellow'</span><span class="op">,</span><span class="dt">pointSize</span><span class="op">:</span> <span class="dv">10</span>}<span class="op">,</span> <span class="st">'Filtered Intersection Points'</span>)<span class="op">;</span></span>
<span id="cb20-166" class="hljs-ln-code"><a href="#cb20-166"></a></span>
<span id="cb20-167" class="hljs-ln-code"><a href="#cb20-167"></a><span class="co">// Add the filtered intersection points to the map</span></span>
<span id="cb20-168" class="hljs-ln-code"><a href="#cb20-168"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(</span>
<span id="cb20-169" class="hljs-ln-code"><a href="#cb20-169"></a>             intersectionPoints<span class="op">,</span></span>
<span id="cb20-170" class="hljs-ln-code"><a href="#cb20-170"></a>             {<span class="dt">color</span><span class="op">:</span> <span class="st">'yellow'</span><span class="op">,</span><span class="dt">pointSize</span><span class="op">:</span> <span class="dv">10</span>}<span class="op">,</span></span>
<span id="cb20-171" class="hljs-ln-code"><a href="#cb20-171"></a>             <span class="st">'Filtered Intersection Points'</span></span>
<span id="cb20-172" class="hljs-ln-code"><a href="#cb20-172"></a>             )<span class="op">;</span></span>
<span id="cb20-173" class="hljs-ln-code"><a href="#cb20-173"></a></span>
<span id="cb20-174" class="hljs-ln-code"><a href="#cb20-174"></a><span class="co">// Display the filtered intersection points in red</span></span>
<span id="cb20-175" class="hljs-ln-code"><a href="#cb20-175"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(</span>
<span id="cb20-176" class="hljs-ln-code"><a href="#cb20-176"></a>            highDensityPoints<span class="op">,</span></span>
<span id="cb20-177" class="hljs-ln-code"><a href="#cb20-177"></a>            {<span class="dt">color</span><span class="op">:</span> <span class="st">'red'</span><span class="op">,</span> <span class="dt">pointSize</span><span class="op">:</span> <span class="dv">10</span>}<span class="op">,</span></span>
<span id="cb20-178" class="hljs-ln-code"><a href="#cb20-178"></a>            <span class="st">'High Density Intersection Points'</span></span>
<span id="cb20-179" class="hljs-ln-code"><a href="#cb20-179"></a>            )<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="footer footer-default">

</div>
</section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="walkthrough_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="walkthrough_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="walkthrough_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="walkthrough_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="walkthrough_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="walkthrough_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="walkthrough_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="walkthrough_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="walkthrough_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="walkthrough_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'smaller': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 950,

        height: 950,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn) {
        const config = {
          allowHTML: true,
          content: contentFn,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        };
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>